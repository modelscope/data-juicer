# nested_aggregator

Aggregates nested content from multiple samples into a single summary.

This operator uses a recursive summarization approach to aggregate content from multiple samples. It processes the input text, which is split into sub-documents, and generates a summary that maintains the average length of the original documents. The aggregation is performed using an API model, guided by system prompts and templates. The operator supports retrying the API call in case of errors and allows for customization of the summarization process through various parameters. The default system prompt and templates are provided in Chinese, but they can be customized. The operator uses a Hugging Face tokenizer to handle tokenization.

聚合来自多个样本的嵌套内容，生成单一摘要。

该算子使用递归汇总方法来聚合来自多个样本的内容。它处理被分割成子文档的输入文本，并生成一个保持原始文档平均长度的摘要。聚合过程使用 API 模型进行，由系统提示和模板指导。该算子支持在出错时重试 API 调用，并允许通过各种参数自定义汇总过程。默认的系统提示和模板以中文提供，但可以自定义。该算子使用 Hugging Face 分词器来处理分词。

Type 算子类型: **aggregator**

Tags 标签: cpu, api, text

## 🔧 Parameter Configuration 参数配置
| name 参数名 | type 类型 | default 默认值 | desc 说明 |
|--------|------|--------|------|
| `api_model` | <class 'str'> | `'gpt-4o'` | API model name. |
| `input_key` | <class 'str'> | `'event_description'` | The input key in the meta field of the samples. |
| `output_key` | <class 'str'> | `None` | The output key in the aggregation field in the |
| `max_token_num` | typing.Optional[typing.Annotated[int, Gt(gt=0)]] | `None` | The max token num of the total tokens of the |
| `api_endpoint` | typing.Optional[str] | `None` | URL endpoint for the API. |
| `response_path` | typing.Optional[str] | `None` | Path to extract content from the API response. |
| `system_prompt` | typing.Optional[str] | `None` | The system prompt. |
| `sub_doc_template` | typing.Optional[str] | `None` | The template for input text in each sample. |
| `input_template` | typing.Optional[str] | `None` | The input template. |
| `try_num` | typing.Annotated[int, Gt(gt=0)] | `3` | The number of retry attempts when there is an API |
| `model_params` | typing.Dict | `{}` | Parameters for initializing the API model. |
| `sampling_params` | typing.Dict | `{}` | Extra parameters passed to the API call. |
| `kwargs` |  | `''` | Extra keyword arguments. |

## 📊 Effect demonstration 效果演示
### test_default_aggregator
```python
NestedAggregator(api_model='qwen2.5-72b-instruct')
```

#### 📥 input data 输入数据
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> empty</div><div class='meta' style='margin-top:6px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; font-weight:bold; color:#555;'>__dj__meta__</td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>十年前，李相夷十五岁战胜西域天魔成为天下第一高手，十七岁建立四顾门，二十岁问鼎武林盟主，成为传奇人物。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>有人视李相夷为中原武林的希望，但也有人以战胜他为目标，包括魔教金鸳盟盟主笛飞声。笛飞声设计加害李相夷的师兄单孤刀，引得李相夷与之一战。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>在东海的一艘船上，李相夷独自一人对抗金鸳盟的高手，最终击败了大部分敌人。笛飞声突然出现，两人激战，李相夷在战斗中中毒，最终被笛飞声重伤，船只爆炸，李相夷沉入大海。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>十年后，李莲花在一个寒酸的莲花楼内醒来，表现出与李相夷截然不同的性格。他以神医的身份在小镇上行医，但生活贫困。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>小镇上的皮影戏摊讲述李相夷和笛飞声的故事，孩子们争论谁赢了。风火堂管事带着人来找李莲花，要求他救治一个“死人”。</td></tr></table></td></tr></table></div></div>

#### 📤 output data 输出数据
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> empty</div><div class='meta' style='margin-top:6px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; font-weight:bold; color:#555;'>__dj__meta__</td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>十年前，李相夷十五岁战胜西域天魔成为天下第一高手，十七岁建立四顾门，二十岁问鼎武林盟主，成为传奇人物。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>有人视李相夷为中原武林的希望，但也有人以战胜他为目标，包括魔教金鸳盟盟主笛飞声。笛飞声设计加害李相夷的师兄单孤刀，引得李相夷与之一战。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>在东海的一艘船上，李相夷独自一人对抗金鸳盟的高手，最终击败了大部分敌人。笛飞声突然出现，两人激战，李相夷在战斗中中毒，最终被笛飞声重伤，船只爆炸，李相夷沉入大海。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>十年后，李莲花在一个寒酸的莲花楼内醒来，表现出与李相夷截然不同的性格。他以神医的身份在小镇上行医，但生活贫困。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>小镇上的皮影戏摊讲述李相夷和笛飞声的故事，孩子们争论谁赢了。风火堂管事带着人来找李莲花，要求他救治一个“死人”。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; background-color:#ffffff !important; border-bottom:1px solid #eaecef !important; font-weight:bold; color:#555;'>__dj__batch_meta__</td></tr><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#ffffff !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 16px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#ffffff !important; border-bottom:1px solid #eaecef !important;'>李相夷年少成名，成为武林盟主，却在与笛飞声的决战中重伤沉海。十年后，李莲花在小镇上以神医身份行医，生活贫困，而关于李相夷的传说仍在民间流传。</td></tr></table></div></div>

#### ✨ explanation 解释
This example demonstrates the default behavior of the NestedAggregator operator. It takes a list of event descriptions and generates a summary that captures the key points from all the input texts. The output data includes the original event descriptions and an additional summary in the batch metadata, which provides a concise overview of the story. The summary is generated using the specified API model.
这个例子展示了NestedAggregator算子的默认行为。它接收一系列事件描述，并生成一个总结，概括所有输入文本的关键点。输出数据包括原始的事件描述和在批次元数据中添加的一个总结，该总结提供了故事的简要概述。总结是通过指定的API模型生成的。

### test_max_token_num_1
```python
NestedAggregator(api_model='qwen2.5-72b-instruct', max_token_num=2)
```

#### 📥 input data 输入数据
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> empty</div><div class='meta' style='margin-top:6px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; font-weight:bold; color:#555;'>__dj__meta__</td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>十年前，李相夷十五岁战胜西域天魔成为天下第一高手，十七岁建立四顾门，二十岁问鼎武林盟主，成为传奇人物。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>有人视李相夷为中原武林的希望，但也有人以战胜他为目标，包括魔教金鸳盟盟主笛飞声。笛飞声设计加害李相夷的师兄单孤刀，引得李相夷与之一战。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>在东海的一艘船上，李相夷独自一人对抗金鸳盟的高手，最终击败了大部分敌人。笛飞声突然出现，两人激战，李相夷在战斗中中毒，最终被笛飞声重伤，船只爆炸，李相夷沉入大海。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>十年后，李莲花在一个寒酸的莲花楼内醒来，表现出与李相夷截然不同的性格。他以神医的身份在小镇上行医，但生活贫困。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>小镇上的皮影戏摊讲述李相夷和笛飞声的故事，孩子们争论谁赢了。风火堂管事带着人来找李莲花，要求他救治一个“死人”。</td></tr></table></td></tr></table></div></div>

#### 📤 output data 输出数据
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> empty</div><div class='meta' style='margin-top:6px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; font-weight:bold; color:#555;'>__dj__meta__</td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>十年前，李相夷十五岁战胜西域天魔成为天下第一高手，十七岁建立四顾门，二十岁问鼎武林盟主，成为传奇人物。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>有人视李相夷为中原武林的希望，但也有人以战胜他为目标，包括魔教金鸳盟盟主笛飞声。笛飞声设计加害李相夷的师兄单孤刀，引得李相夷与之一战。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>在东海的一艘船上，李相夷独自一人对抗金鸳盟的高手，最终击败了大部分敌人。笛飞声突然出现，两人激战，李相夷在战斗中中毒，最终被笛飞声重伤，船只爆炸，李相夷沉入大海。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>十年后，李莲花在一个寒酸的莲花楼内醒来，表现出与李相夷截然不同的性格。他以神医的身份在小镇上行医，但生活贫困。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; padding-left: 16px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #eaecef !important;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 32px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#f8f9fa !important; border-bottom:1px solid #eaecef !important;'>小镇上的皮影戏摊讲述李相夷和笛飞声的故事，孩子们争论谁赢了。风火堂管事带着人来找李莲花，要求他救治一个“死人”。</td></tr></table></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; background-color:#ffffff !important; border-bottom:1px solid #eaecef !important; font-weight:bold; color:#555;'>__dj__batch_meta__</td></tr><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#ffffff !important; border-bottom:1px solid #eaecef !important; white-space:nowrap; padding-left: 16px;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 8px; background-color:#ffffff !important; border-bottom:1px solid #eaecef !important;'>李相夷十五岁胜天魔，十七岁创四顾门，二十岁成武林盟主，后被笛飞声重伤沉海，十年后以李莲花之名在莲花楼苏醒，行医度日。小镇皮影戏讲述其故事引发争议，李莲花被请去救治“死人”。</td></tr></table></div></div>

#### ✨ explanation 解释
This example shows how the NestedAggregator operator works with a very limited token budget (max_token_num=2). Due to the extremely low token limit, the generated summary is highly condensed, focusing only on the most critical information. The output data includes the original event descriptions and a very brief summary in the batch metadata, which highlights the main events in a few words. This edge case helps to understand the impact of token limits on the summary quality.
这个例子展示了NestedAggregator算子在非常有限的令牌预算（max_token_num=2）下的工作情况。由于令牌限制极低，生成的总结非常精简，仅关注最关键的信息。输出数据包括原始的事件描述和在批次元数据中添加的一个非常简短的总结，该总结用几句话突出了主要事件。这个边缘案例有助于理解令牌限制对总结质量的影响。


## 🔗 related links 相关链接
- [source code 源代码](../../../data_juicer/ops/aggregator/nested_aggregator.py)
- [unit test 单元测试](../../../tests/ops/aggregator/test_nested_aggregator.py)
- [Return operator list 返回算子列表](../../Operators.md)