# most_relevant_entities_aggregator

Extracts and ranks entities closely related to a given entity from provided texts.

The operator uses a language model API to identify and rank entities, filtering out entities of the same type as the given entity. The ranked list is sorted in descending order of importance. Input texts are aggregated and passed to the model, with an optional token limit. The output is parsed using a regular expression to extract the relevant entities. Results are stored in the batch metadata under the key 'most_relevant_entities'. The operator retries the API call up to a specified number of times in case of errors. The system prompt, input template, and output pattern can be customized.

ä»æä¾›çš„æ–‡æœ¬ä¸­æå–å¹¶æ’åºä¸ç»™å®šå®ä½“å¯†åˆ‡ç›¸å…³çš„å®ä½“ã€‚

è¯¥ç®—å­ä½¿ç”¨è¯­è¨€æ¨¡å‹ API æ¥è¯†åˆ«å’Œæ’åºå®ä½“ï¼Œè¿‡æ»¤æ‰ä¸ç»™å®šå®ä½“ç±»å‹ç›¸åŒçš„å®ä½“ã€‚æ’ååˆ—è¡¨æŒ‰é‡è¦æ€§é™åºæ’åˆ—ã€‚è¾“å…¥æ–‡æœ¬è¢«èšåˆå¹¶ä¼ é€’ç»™æ¨¡å‹ï¼Œå¯é€‰è®¾ç½® token é™åˆ¶ã€‚è¾“å‡ºä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è§£æä»¥æå–ç›¸å…³å®ä½“ã€‚ç»“æœå­˜å‚¨åœ¨æ‰¹å¤„ç†å…ƒæ•°æ®ä¸­çš„ 'most_relevant_entities' é”®ä¸‹ã€‚è¯¥ç®—å­åœ¨å‡ºé”™æ—¶æœ€å¤šé‡è¯•æŒ‡å®šæ¬¡æ•°çš„ API è°ƒç”¨ã€‚ç³»ç»Ÿæç¤ºã€è¾“å…¥æ¨¡æ¿å’Œè¾“å‡ºæ¨¡å¼å¯ä»¥è‡ªå®šä¹‰ã€‚

Type ç®—å­ç±»å‹: **aggregator**

Tags æ ‡ç­¾: cpu, api

## ğŸ”§ Parameter Configuration å‚æ•°é…ç½®
| name å‚æ•°å | type ç±»å‹ | default é»˜è®¤å€¼ | desc è¯´æ˜ |
|--------|------|--------|------|
| `api_model` | <class 'str'> | `'gpt-4o'` | API model name. |
| `entity` | <class 'str'> | `None` | The given entity. |
| `query_entity_type` | <class 'str'> | `None` | The type of queried relevant entities. |
| `input_key` | <class 'str'> | `'event_description'` | The input key in the meta field of the samples. It is "event_description" in default. |
| `output_key` | <class 'str'> | `'most_relevant_entities'` | The output key in the aggregation field of the samples. It is "most_relevant_entities" in default. |
| `max_token_num` | typing.Optional[typing.Annotated[int, Gt(gt=0)]] | `None` | The max token num of the total tokens of the sub documents. Without limitation if it is None. |
| `api_endpoint` | typing.Optional[str] | `None` | URL endpoint for the API. |
| `response_path` | typing.Optional[str] | `None` | Path to extract content from the API response. Defaults to 'choices.0.message.content'. |
| `system_prompt_template` | typing.Optional[str] | `None` | The system prompt template. |
| `input_template` | typing.Optional[str] | `None` | The input template. |
| `output_pattern` | typing.Optional[str] | `None` | The output pattern. |
| `try_num` | typing.Annotated[int, Gt(gt=0)] | `3` | The number of retry attempts when there is an API call error or output parsing error. |
| `model_params` | typing.Dict | `{}` | Parameters for initializing the API model. |
| `sampling_params` | typing.Dict | `{}` | Extra parameters passed to the API call. e.g {'temperature': 0.9, 'top_p': 0.95} |
| `kwargs` |  | `''` | Extra keyword arguments. |

## ğŸ“Š Effect demonstration æ•ˆæœæ¼”ç¤º
### test_default_aggregator
```python
MostRelevantEntitiesAggregator(api_model='qwen2.5-72b-instruct', entity='æè²èŠ±', query_entity_type='äººç‰©')
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> empty</div><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__meta__</th></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´å‰ï¼Œæç›¸å¤·åäº”å²æˆ˜èƒœè¥¿åŸŸå¤©é­”æˆä¸ºå¤©ä¸‹ç¬¬ä¸€é«˜æ‰‹ï¼Œåä¸ƒå²å»ºç«‹å››é¡¾é—¨ï¼ŒäºŒåå²é—®é¼æ­¦æ—ç›Ÿä¸»ï¼Œæˆä¸ºä¼ å¥‡äººç‰©ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>æœ‰äººè§†æç›¸å¤·ä¸ºä¸­åŸæ­¦æ—çš„å¸Œæœ›ï¼Œä½†ä¹Ÿæœ‰äººä»¥æˆ˜èƒœä»–ä¸ºç›®æ ‡ï¼ŒåŒ…æ‹¬é­”æ•™é‡‘é¸³ç›Ÿç›Ÿä¸»ç¬›é£å£°ã€‚ç¬›é£å£°è®¾è®¡åŠ å®³æç›¸å¤·çš„å¸ˆå…„å•å­¤åˆ€ï¼Œå¼•å¾—æç›¸å¤·ä¸ä¹‹ä¸€æˆ˜ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åœ¨ä¸œæµ·çš„ä¸€è‰˜èˆ¹ä¸Šï¼Œæç›¸å¤·ç‹¬è‡ªä¸€äººå¯¹æŠ—é‡‘é¸³ç›Ÿçš„é«˜æ‰‹ï¼Œæœ€ç»ˆå‡»è´¥äº†å¤§éƒ¨åˆ†æ•Œäººã€‚ç¬›é£å£°çªç„¶å‡ºç°ï¼Œä¸¤äººæ¿€æˆ˜ï¼Œæç›¸å¤·åœ¨æˆ˜æ–—ä¸­ä¸­æ¯’ï¼Œæœ€ç»ˆè¢«ç¬›é£å£°é‡ä¼¤ï¼Œèˆ¹åªçˆ†ç‚¸ï¼Œæç›¸å¤·æ²‰å…¥å¤§æµ·ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´åï¼Œæè²èŠ±åœ¨ä¸€ä¸ªå¯’é…¸çš„è²èŠ±æ¥¼å†…é†’æ¥ï¼Œè¡¨ç°å‡ºä¸æç›¸å¤·æˆªç„¶ä¸åŒçš„æ€§æ ¼ã€‚ä»–ä»¥ç¥åŒ»çš„èº«ä»½åœ¨å°é•‡ä¸Šè¡ŒåŒ»ï¼Œä½†ç”Ÿæ´»è´«å›°ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>å°é•‡ä¸Šçš„çš®å½±æˆæ‘Šè®²è¿°æç›¸å¤·å’Œç¬›é£å£°çš„æ•…äº‹ï¼Œå­©å­ä»¬äº‰è®ºè°èµ¢äº†ã€‚é£ç«å ‚ç®¡äº‹å¸¦ç€äººæ¥æ‰¾æè²èŠ±ï¼Œè¦æ±‚ä»–æ•‘æ²»ä¸€ä¸ªâ€œæ­»äººâ€ã€‚</td></tr></table></div></td></tr></table></div></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> empty</div><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__meta__</th></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´å‰ï¼Œæç›¸å¤·åäº”å²æˆ˜èƒœè¥¿åŸŸå¤©é­”æˆä¸ºå¤©ä¸‹ç¬¬ä¸€é«˜æ‰‹ï¼Œåä¸ƒå²å»ºç«‹å››é¡¾é—¨ï¼ŒäºŒåå²é—®é¼æ­¦æ—ç›Ÿä¸»ï¼Œæˆä¸ºä¼ å¥‡äººç‰©ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>æœ‰äººè§†æç›¸å¤·ä¸ºä¸­åŸæ­¦æ—çš„å¸Œæœ›ï¼Œä½†ä¹Ÿæœ‰äººä»¥æˆ˜èƒœä»–ä¸ºç›®æ ‡ï¼ŒåŒ…æ‹¬é­”æ•™é‡‘é¸³ç›Ÿç›Ÿä¸»ç¬›é£å£°ã€‚ç¬›é£å£°è®¾è®¡åŠ å®³æç›¸å¤·çš„å¸ˆå…„å•å­¤åˆ€ï¼Œå¼•å¾—æç›¸å¤·ä¸ä¹‹ä¸€æˆ˜ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åœ¨ä¸œæµ·çš„ä¸€è‰˜èˆ¹ä¸Šï¼Œæç›¸å¤·ç‹¬è‡ªä¸€äººå¯¹æŠ—é‡‘é¸³ç›Ÿçš„é«˜æ‰‹ï¼Œæœ€ç»ˆå‡»è´¥äº†å¤§éƒ¨åˆ†æ•Œäººã€‚ç¬›é£å£°çªç„¶å‡ºç°ï¼Œä¸¤äººæ¿€æˆ˜ï¼Œæç›¸å¤·åœ¨æˆ˜æ–—ä¸­ä¸­æ¯’ï¼Œæœ€ç»ˆè¢«ç¬›é£å£°é‡ä¼¤ï¼Œèˆ¹åªçˆ†ç‚¸ï¼Œæç›¸å¤·æ²‰å…¥å¤§æµ·ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´åï¼Œæè²èŠ±åœ¨ä¸€ä¸ªå¯’é…¸çš„è²èŠ±æ¥¼å†…é†’æ¥ï¼Œè¡¨ç°å‡ºä¸æç›¸å¤·æˆªç„¶ä¸åŒçš„æ€§æ ¼ã€‚ä»–ä»¥ç¥åŒ»çš„èº«ä»½åœ¨å°é•‡ä¸Šè¡ŒåŒ»ï¼Œä½†ç”Ÿæ´»è´«å›°ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>å°é•‡ä¸Šçš„çš®å½±æˆæ‘Šè®²è¿°æç›¸å¤·å’Œç¬›é£å£°çš„æ•…äº‹ï¼Œå­©å­ä»¬äº‰è®ºè°èµ¢äº†ã€‚é£ç«å ‚ç®¡äº‹å¸¦ç€äººæ¥æ‰¾æè²èŠ±ï¼Œè¦æ±‚ä»–æ•‘æ²»ä¸€ä¸ªâ€œæ­»äººâ€ã€‚</td></tr></table></div></td></tr><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__batch_meta__</th></tr><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>most_relevant_entities</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>[&#x27;ç¬›é£å£°&#x27;, &#x27;å•å­¤åˆ€&#x27;, &#x27;é£ç«å ‚ç®¡äº‹&#x27;]</td></tr></table></div></div>

#### âœ¨ explanation è§£é‡Š
This example demonstrates the typical use of the operator, where it extracts and ranks entities related to 'æè²èŠ±' (Li Lianhua) from a set of event descriptions. The operator uses a language model API to identify and rank these entities, such as 'ç¬›é£å£°', 'å•å­¤åˆ€', and 'é£ç«å ‚ç®¡äº‹'. These entities are then stored in the batch metadata under the key 'most_relevant_entities'.
æ­¤ç¤ºä¾‹å±•ç¤ºäº†ç®—å­çš„å…¸å‹ç”¨æ³•ï¼Œå³ä»ä¸€ç»„äº‹ä»¶æè¿°ä¸­æå–å¹¶æ’åˆ—ä¸'æè²èŠ±'ç›¸å…³çš„å®ä½“ã€‚ç®—å­ä½¿ç”¨è¯­è¨€æ¨¡å‹APIæ¥è¯†åˆ«å’Œæ’åˆ—è¿™äº›å®ä½“ï¼Œä¾‹å¦‚'ç¬›é£å£°'ã€'å•å­¤åˆ€'å’Œ'é£ç«å ‚ç®¡äº‹'ã€‚è¿™äº›å®ä½“éšåè¢«å­˜å‚¨åœ¨æ‰¹æ¬¡å…ƒæ•°æ®ä¸­çš„'most_relevant_entities'é”®ä¸‹ã€‚

### test_max_token_num
```python
MostRelevantEntitiesAggregator(api_model='qwen2.5-72b-instruct', entity='æè²èŠ±', query_entity_type='äººç‰©', max_token_num=40)
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> empty</div><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__meta__</th></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´å‰ï¼Œæç›¸å¤·åäº”å²æˆ˜èƒœè¥¿åŸŸå¤©é­”æˆä¸ºå¤©ä¸‹ç¬¬ä¸€é«˜æ‰‹ï¼Œåä¸ƒå²å»ºç«‹å››é¡¾é—¨ï¼ŒäºŒåå²é—®é¼æ­¦æ—ç›Ÿä¸»ï¼Œæˆä¸ºä¼ å¥‡äººç‰©ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>æœ‰äººè§†æç›¸å¤·ä¸ºä¸­åŸæ­¦æ—çš„å¸Œæœ›ï¼Œä½†ä¹Ÿæœ‰äººä»¥æˆ˜èƒœä»–ä¸ºç›®æ ‡ï¼ŒåŒ…æ‹¬é­”æ•™é‡‘é¸³ç›Ÿç›Ÿä¸»ç¬›é£å£°ã€‚ç¬›é£å£°è®¾è®¡åŠ å®³æç›¸å¤·çš„å¸ˆå…„å•å­¤åˆ€ï¼Œå¼•å¾—æç›¸å¤·ä¸ä¹‹ä¸€æˆ˜ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åœ¨ä¸œæµ·çš„ä¸€è‰˜èˆ¹ä¸Šï¼Œæç›¸å¤·ç‹¬è‡ªä¸€äººå¯¹æŠ—é‡‘é¸³ç›Ÿçš„é«˜æ‰‹ï¼Œæœ€ç»ˆå‡»è´¥äº†å¤§éƒ¨åˆ†æ•Œäººã€‚ç¬›é£å£°çªç„¶å‡ºç°ï¼Œä¸¤äººæ¿€æˆ˜ï¼Œæç›¸å¤·åœ¨æˆ˜æ–—ä¸­ä¸­æ¯’ï¼Œæœ€ç»ˆè¢«ç¬›é£å£°é‡ä¼¤ï¼Œèˆ¹åªçˆ†ç‚¸ï¼Œæç›¸å¤·æ²‰å…¥å¤§æµ·ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´åï¼Œæè²èŠ±åœ¨ä¸€ä¸ªå¯’é…¸çš„è²èŠ±æ¥¼å†…é†’æ¥ï¼Œè¡¨ç°å‡ºä¸æç›¸å¤·æˆªç„¶ä¸åŒçš„æ€§æ ¼ã€‚ä»–ä»¥ç¥åŒ»çš„èº«ä»½åœ¨å°é•‡ä¸Šè¡ŒåŒ»ï¼Œä½†ç”Ÿæ´»è´«å›°ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>å°é•‡ä¸Šçš„çš®å½±æˆæ‘Šè®²è¿°æç›¸å¤·å’Œç¬›é£å£°çš„æ•…äº‹ï¼Œå­©å­ä»¬äº‰è®ºè°èµ¢äº†ã€‚é£ç«å ‚ç®¡äº‹å¸¦ç€äººæ¥æ‰¾æè²èŠ±ï¼Œè¦æ±‚ä»–æ•‘æ²»ä¸€ä¸ªâ€œæ­»äººâ€ã€‚</td></tr></table></div></td></tr></table></div></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> empty</div><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__meta__</th></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´å‰ï¼Œæç›¸å¤·åäº”å²æˆ˜èƒœè¥¿åŸŸå¤©é­”æˆä¸ºå¤©ä¸‹ç¬¬ä¸€é«˜æ‰‹ï¼Œåä¸ƒå²å»ºç«‹å››é¡¾é—¨ï¼ŒäºŒåå²é—®é¼æ­¦æ—ç›Ÿä¸»ï¼Œæˆä¸ºä¼ å¥‡äººç‰©ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>æœ‰äººè§†æç›¸å¤·ä¸ºä¸­åŸæ­¦æ—çš„å¸Œæœ›ï¼Œä½†ä¹Ÿæœ‰äººä»¥æˆ˜èƒœä»–ä¸ºç›®æ ‡ï¼ŒåŒ…æ‹¬é­”æ•™é‡‘é¸³ç›Ÿç›Ÿä¸»ç¬›é£å£°ã€‚ç¬›é£å£°è®¾è®¡åŠ å®³æç›¸å¤·çš„å¸ˆå…„å•å­¤åˆ€ï¼Œå¼•å¾—æç›¸å¤·ä¸ä¹‹ä¸€æˆ˜ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åœ¨ä¸œæµ·çš„ä¸€è‰˜èˆ¹ä¸Šï¼Œæç›¸å¤·ç‹¬è‡ªä¸€äººå¯¹æŠ—é‡‘é¸³ç›Ÿçš„é«˜æ‰‹ï¼Œæœ€ç»ˆå‡»è´¥äº†å¤§éƒ¨åˆ†æ•Œäººã€‚ç¬›é£å£°çªç„¶å‡ºç°ï¼Œä¸¤äººæ¿€æˆ˜ï¼Œæç›¸å¤·åœ¨æˆ˜æ–—ä¸­ä¸­æ¯’ï¼Œæœ€ç»ˆè¢«ç¬›é£å£°é‡ä¼¤ï¼Œèˆ¹åªçˆ†ç‚¸ï¼Œæç›¸å¤·æ²‰å…¥å¤§æµ·ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´åï¼Œæè²èŠ±åœ¨ä¸€ä¸ªå¯’é…¸çš„è²èŠ±æ¥¼å†…é†’æ¥ï¼Œè¡¨ç°å‡ºä¸æç›¸å¤·æˆªç„¶ä¸åŒçš„æ€§æ ¼ã€‚ä»–ä»¥ç¥åŒ»çš„èº«ä»½åœ¨å°é•‡ä¸Šè¡ŒåŒ»ï¼Œä½†ç”Ÿæ´»è´«å›°ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>å°é•‡ä¸Šçš„çš®å½±æˆæ‘Šè®²è¿°æç›¸å¤·å’Œç¬›é£å£°çš„æ•…äº‹ï¼Œå­©å­ä»¬äº‰è®ºè°èµ¢äº†ã€‚é£ç«å ‚ç®¡äº‹å¸¦ç€äººæ¥æ‰¾æè²èŠ±ï¼Œè¦æ±‚ä»–æ•‘æ²»ä¸€ä¸ªâ€œæ­»äººâ€ã€‚</td></tr></table></div></td></tr><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__batch_meta__</th></tr><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>most_relevant_entities</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>[&#x27;è¥¿åŸŸå¤©é­”&#x27;, &#x27;å››é¡¾é—¨æˆå‘˜&#x27;, &#x27;æ­¦æ—ç›Ÿä¸»&#x27;]</td></tr></table></div></div>

#### âœ¨ explanation è§£é‡Š
This example shows an important edge case where the operator is configured with a maximum token limit (40 tokens). This limits the amount of text that can be processed by the language model API. As a result, the ranked list of relevant entities may differ due to the reduced input size. In this case, the output includes 'è¥¿åŸŸå¤©é­”', 'å››é¡¾é—¨æˆå‘˜', and 'æ­¦æ—ç›Ÿä¸»'.
æ­¤ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªé‡è¦çš„è¾¹ç¼˜æƒ…å†µï¼Œå…¶ä¸­ç®—å­é…ç½®äº†æœ€å¤§ä»¤ç‰Œé™åˆ¶ï¼ˆ40ä¸ªä»¤ç‰Œï¼‰ã€‚è¿™é™åˆ¶äº†è¯­è¨€æ¨¡å‹APIå¯ä»¥å¤„ç†çš„æ–‡æœ¬é‡ã€‚å› æ­¤ï¼Œç”±äºè¾“å…¥å¤§å°å‡å°‘ï¼Œç›¸å…³å®ä½“çš„æ’ååˆ—è¡¨å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¾“å‡ºåŒ…æ‹¬'è¥¿åŸŸå¤©é­”'ã€'å››é¡¾é—¨æˆå‘˜'å’Œ'æ­¦æ—ç›Ÿä¸»'ã€‚


## ğŸ”— related links ç›¸å…³é“¾æ¥
- [source code æºä»£ç ](../../../data_juicer/ops/aggregator/most_relevant_entities_aggregator.py)
- [unit test å•å…ƒæµ‹è¯•](../../../tests/ops/aggregator/test_most_relevant_entities_aggregator.py)
- [Return operator list è¿”å›ç®—å­åˆ—è¡¨](../../Operators.md)