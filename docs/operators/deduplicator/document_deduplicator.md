# document_deduplicator

Deduplicates samples at the document level using exact matching.

This operator computes an MD5 hash for each sample's text. It can optionally convert the text to lowercase and ignore non-alphabet characters, including whitespaces, digits, and punctuation. The deduplication is based on the computed hash values, where samples with identical hashes are considered duplicates. The `compute_hash` method adds a 'hash' key to each sample, storing its MD5 hash. During processing, the first occurrence of each unique hash is kept, and subsequent duplicates are filtered out. If the `show_num` parameter is set, the operator also returns a specified number of duplicate pairs for inspection.

ä½¿ç”¨ç²¾ç¡®åŒ¹é…åœ¨æ–‡æ¡£çº§åˆ«å»é‡æ ·æœ¬ã€‚

è¯¥ç®—å­è®¡ç®—æ¯ä¸ªæ ·æœ¬æ–‡æœ¬çš„MD5å“ˆå¸Œå€¼ã€‚å®ƒå¯ä»¥å¯é€‰åœ°å°†æ–‡æœ¬è½¬æ¢ä¸ºå°å†™å¹¶å¿½ç•¥éå­—æ¯å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€æ•°å­—å’Œæ ‡ç‚¹ç¬¦å·ã€‚å»é‡åŸºäºè®¡ç®—å‡ºçš„å“ˆå¸Œå€¼ï¼Œå…·æœ‰ç›¸åŒå“ˆå¸Œå€¼çš„æ ·æœ¬è¢«è§†ä¸ºé‡å¤ã€‚`compute_hash`æ–¹æ³•å‘æ¯ä¸ªæ ·æœ¬æ·»åŠ ä¸€ä¸ª'hash'é”®ï¼Œå­˜å‚¨å…¶MD5å“ˆå¸Œå€¼ã€‚åœ¨å¤„ç†è¿‡ç¨‹ä¸­ï¼Œä¿ç•™æ¯ä¸ªå”¯ä¸€å“ˆå¸Œå€¼çš„ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œåç»­é‡å¤é¡¹è¢«è¿‡æ»¤æ‰ã€‚å¦‚æœè®¾ç½®äº†`show_num`å‚æ•°ï¼Œç®—å­è¿˜ä¼šè¿”å›æŒ‡å®šæ•°é‡çš„é‡å¤å¯¹ä»¥ä¾›æ£€æŸ¥ã€‚

Type ç®—å­ç±»å‹: **deduplicator**

Tags æ ‡ç­¾: cpu, text

## ğŸ”§ Parameter Configuration å‚æ•°é…ç½®
| name å‚æ•°å | type ç±»å‹ | default é»˜è®¤å€¼ | desc è¯´æ˜ |
|--------|------|--------|------|
| `lowercase` | <class 'bool'> | `False` | Whether to convert sample text to lower case |
| `ignore_non_character` | <class 'bool'> | `False` | Whether to ignore non-alphabet characters, including whitespaces, digits, and punctuations |
| `args` |  | `''` | extra args |
| `kwargs` |  | `''` | extra args. |

## ğŸ“Š Effect demonstration æ•ˆæœæ¼”ç¤º
### test_english_deduplication
```python
DocumentDeduplicator(lowercase=False, ignore_non_character=False)
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Today is Sunday and it&#x27;s a happy day!</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Do you need a cup of coffee?</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Today is sunday and it&#x27;s a happy day!</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 4:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">This paper proposed a novel method on LLM pretraining.</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 5:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">This paper proposed a novel method on LLM pretraining.</pre></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Today is Sunday and it&#x27;s a happy day!</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Do you need a cup of coffee?</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Today is sunday and it&#x27;s a happy day!</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 4:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">This paper proposed a novel method on LLM pretraining.</pre></div>

#### âœ¨ explanation è§£é‡Š
The operator computes an MD5 hash for each sample's text without converting to lowercase or ignoring non-alphabet characters. It keeps the first occurrence of each unique hash and removes subsequent duplicates, resulting in a list where only one instance of 'This paper proposed a novel method on LLM pretraining.' is kept.
ç®—å­å¯¹æ¯ä¸ªæ ·æœ¬çš„æ–‡æœ¬è®¡ç®—MD5å“ˆå¸Œå€¼ï¼Œä¸è½¬æ¢ä¸ºå°å†™ä¹Ÿä¸å¿½ç•¥éå­—æ¯å­—ç¬¦ã€‚å®ƒä¿ç•™æ¯ä¸ªå”¯ä¸€å“ˆå¸Œå€¼çš„é¦–æ¬¡å‡ºç°ï¼Œå¹¶ç§»é™¤åç»­é‡å¤é¡¹ï¼Œç»“æœåˆ—è¡¨ä¸­åªä¿ç•™äº†ä¸€ä¸ª'This paper proposed a novel method on LLM pretraining.'å®ä¾‹ã€‚

### test_english_deduplication_with_params
```python
DocumentDeduplicator(lowercase=True, ignore_non_character=True)
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Today is Sunday and it&#x27;s a happy day!</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Do you need a cup of coffee?</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Today is sunday and it&#x27;s a happy day!</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 4:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Today is sunday and it&#x27;s a happy day?</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 5:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">This paper proposed a novel method on LLM pretraining.</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 6:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">This paper proposed a novel method on LLM pretraining.</pre></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Today is Sunday and it&#x27;s a happy day!</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Do you need a cup of coffee?</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">This paper proposed a novel method on LLM pretraining.</pre></div>

#### âœ¨ explanation è§£é‡Š
The operator computes an MD5 hash for each sample's text after converting it to lowercase and ignoring non-alphabet characters. This results in more aggressive deduplication, keeping only the first occurrence of each unique hash after processing, thus removing all but one instance of similar sentences like 'Today is sunday and it's a happy day!'.
ç®—å­åœ¨å°†æ–‡æœ¬è½¬æ¢ä¸ºå°å†™å¹¶å¿½ç•¥éå­—æ¯å­—ç¬¦åï¼Œå¯¹æ¯ä¸ªæ ·æœ¬çš„æ–‡æœ¬è®¡ç®—MD5å“ˆå¸Œå€¼ã€‚è¿™å¯¼è‡´äº†æ›´ç§¯æçš„å»é‡å¤„ç†ï¼Œä»…ä¿ç•™å¤„ç†åæ¯ä¸ªå”¯ä¸€å“ˆå¸Œå€¼çš„é¦–æ¬¡å‡ºç°ï¼Œä»è€Œåˆ é™¤äº†å¦‚'Today is sunday and it's a happy day!'è¿™æ ·çš„ç›¸ä¼¼å¥å­çš„æ‰€æœ‰ä½†ä¸€ä¸ªå®ä¾‹ã€‚


## ğŸ”— related links ç›¸å…³é“¾æ¥
- [source code æºä»£ç ](../../../data_juicer/ops/deduplicator/document_deduplicator.py)
- [unit test å•å…ƒæµ‹è¯•](../../../tests/ops/deduplicator/test_document_deduplicator.py)
- [Return operator list è¿”å›ç®—å­åˆ—è¡¨](../../Operators.md)