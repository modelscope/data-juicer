# image_tagging_mapper

Generates image tags for each image in the sample.

This operator processes images to generate descriptive tags. It uses a Hugging Face model to analyze the images and produce relevant tags. The tags are stored in the specified field, defaulting to 'image_tags'. If the tags are already present in the sample, the operator will not recompute them. For samples without images, an empty tag array is assigned. The generated tags are sorted by frequency and stored as a list of strings.

ä¸ºæ ·æœ¬ä¸­çš„æ¯å¼ å›¾åƒç”Ÿæˆæè¿°æ€§æ ‡ç­¾ã€‚

æ­¤ç®—å­å¤„ç†å›¾åƒä»¥ç”Ÿæˆæè¿°æ€§æ ‡ç­¾ã€‚å®ƒä½¿ç”¨ Hugging Face æ¨¡å‹åˆ†æå›¾åƒå¹¶ç”Ÿæˆç›¸å…³æ ‡ç­¾ã€‚æ ‡ç­¾å­˜å‚¨åœ¨æŒ‡å®šå­—æ®µä¸­ï¼Œé»˜è®¤ä¸º 'image_tags'ã€‚å¦‚æœæ ·æœ¬ä¸­å·²ç»å­˜åœ¨æ ‡ç­¾ï¼Œåˆ™ä¸ä¼šé‡æ–°è®¡ç®—ã€‚å¯¹äºæ²¡æœ‰å›¾åƒçš„æ ·æœ¬ï¼Œåˆ†é…ä¸€ä¸ªç©ºæ ‡ç­¾æ•°ç»„ã€‚ç”Ÿæˆçš„æ ‡ç­¾æŒ‰é¢‘ç‡æ’åºå¹¶ä½œä¸ºå­—ç¬¦ä¸²åˆ—è¡¨å­˜å‚¨ã€‚

Type ç®—å­ç±»å‹: **mapper**

Tags æ ‡ç­¾: cpu, image

## ğŸ”§ Parameter Configuration å‚æ•°é…ç½®
| name å‚æ•°å | type ç±»å‹ | default é»˜è®¤å€¼ | desc è¯´æ˜ |
|--------|------|--------|------|
| `tag_field_name` | <class 'str'> | `'image_tags'` | the field name to store the tags. It's "image_tags" in default. |
| `args` |  | `''` | extra args |
| `kwargs` |  | `''` | extra args |

## ğŸ“Š Effect demonstration æ•ˆæœæ¼”ç¤º
### test
```python
ImageTaggingMapper()
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> 1 image</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">img1.png:</div><div class="image-grid"><img src="../../../tests/ops/data/img1.png" width="160" style="margin:4px;"/></div></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> 1 image</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">img2.jpg:</div><div class="image-grid"><img src="../../../tests/ops/data/img2.jpg" width="160" style="margin:4px;"/></div></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> 1 image</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">img3.jpg:</div><div class="image-grid"><img src="../../../tests/ops/data/img3.jpg" width="160" style="margin:4px;"/></div></div></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> 1 image</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">img1.png:</div><div class="image-grid"><img src="../../../tests/ops/data/img1.png" width="160" style="margin:4px;"/></div></div><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__meta__</th></tr><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>image_tags</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>[[&#x27;bed&#x27;, &#x27;bedcover&#x27;, &#x27;bedroom&#x27;, &#x27;bedding&#x27;, &#x27;lamp&#x27;, &#x27;ceiling&#x27;, &#x27;chair&#x27;, &#x27;pillar&#x27;, &#x27;comfort&#x27;, &#x27;side table&#x27;, &#x27;floor&#x27;, &#x27;hardwood floor&#x27;, &#x27;headboard&#x27;, &#x27;linen&#x27;, &#x27;mattress&#x27;, &#x27;nightstand&#x27;, &#x27;picture frame&#x27;, &#x27;pillow&#x27;, &#x27;room&#x27;, &#x27;wall lamp&#x27;, &#x27;stool&#x27;, &#x27;white&#x27;, &#x27;window&#x27;, &#x27;wood floor&#x27;]]</td></tr></table></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> 1 image</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">img2.jpg:</div><div class="image-grid"><img src="../../../tests/ops/data/img2.jpg" width="160" style="margin:4px;"/></div></div><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__meta__</th></tr><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>image_tags</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>[[&#x27;advertisement&#x27;, &#x27;back&#x27;, &#x27;bus&#x27;, &#x27;car&#x27;, &#x27;city bus&#x27;, &#x27;city street&#x27;, &#x27;curb&#x27;, &#x27;decker bus&#x27;, &#x27;drive&#x27;, &#x27;license plate&#x27;, &#x27;road&#x27;, &#x27;street scene&#x27;, &#x27;tour bus&#x27;, &#x27;travel&#x27;, &#x27;white&#x27;]]</td></tr></table></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> 1 image</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">img3.jpg:</div><div class="image-grid"><img src="../../../tests/ops/data/img3.jpg" width="160" style="margin:4px;"/></div></div><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__meta__</th></tr><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>image_tags</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>[[&#x27;alley&#x27;, &#x27;black&#x27;, &#x27;building&#x27;, &#x27;catch&#x27;, &#x27;person&#x27;, &#x27;pavement&#x27;, &#x27;photo&#x27;, &#x27;rain&#x27;, &#x27;road&#x27;, &#x27;umbrella&#x27;, &#x27;walk&#x27;, &#x27;woman&#x27;]]</td></tr></table></div></div>

#### âœ¨ explanation è§£é‡Š
The ImageTaggingMapper operator analyzes each image in the input data and generates a list of descriptive tags. For example, it identifies 'bed', 'bedcover', 'bedroom', and other relevant objects in the first image. These tags are then stored in a new field called 'image_tags' within the 'meta' field of the output data. This allows for easy access to the generated tags for further processing or analysis.
ç®—å­ImageTaggingMapperä¼šåˆ†æè¾“å…¥æ•°æ®ä¸­çš„æ¯å¼ å›¾ç‰‡ï¼Œå¹¶ç”Ÿæˆæè¿°æ€§æ ‡ç­¾åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œå®ƒåœ¨ç¬¬ä¸€å¼ å›¾ç‰‡ä¸­è¯†åˆ«å‡º'åºŠ'ã€'åºŠç½©'ã€'å§å®¤'ç­‰ç›¸å…³çš„ç‰©ä½“ã€‚è¿™äº›æ ‡ç­¾ä¼šè¢«å­˜å‚¨åœ¨è¾“å‡ºæ•°æ®çš„'meta'å­—æ®µä¸­çš„'image_tags'æ–°å­—æ®µé‡Œã€‚è¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°è®¿é—®ç”Ÿæˆçš„æ ‡ç­¾ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥å¤„ç†æˆ–åˆ†æã€‚

### test_no_images
```python
ImageTaggingMapper()
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> empty</div><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>images</th></tr></table></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> 1 image</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">img2.jpg:</div><div class="image-grid"><img src="../../../tests/ops/data/img2.jpg" width="160" style="margin:4px;"/></div></div></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> empty</div><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>images</th></tr><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__meta__</th></tr><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>image_tags</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>[[]]</td></tr></table></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> 1 image</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">img2.jpg:</div><div class="image-grid"><img src="../../../tests/ops/data/img2.jpg" width="160" style="margin:4px;"/></div></div><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__meta__</th></tr><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>image_tags</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>[[&#x27;advertisement&#x27;, &#x27;back&#x27;, &#x27;bus&#x27;, &#x27;car&#x27;, &#x27;city bus&#x27;, &#x27;city street&#x27;, &#x27;curb&#x27;, &#x27;decker bus&#x27;, &#x27;drive&#x27;, &#x27;license plate&#x27;, &#x27;road&#x27;, &#x27;street scene&#x27;, &#x27;tour bus&#x27;, &#x27;travel&#x27;, &#x27;white&#x27;]]</td></tr></table></div></div>

#### âœ¨ explanation è§£é‡Š
In this example, the ImageTaggingMapper operator is applied to a dataset where one of the samples has no images. The operator correctly handles this case by assigning an empty tag array to the sample without images. For the sample with an image, the operator generates the appropriate tags as usual. This demonstrates that the operator can gracefully handle cases where some samples may not contain any images, ensuring that the output data structure remains consistent.
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒImageTaggingMapperç®—å­è¢«åº”ç”¨äºä¸€ä¸ªæ•°æ®é›†ä¸­ï¼Œå…¶ä¸­ä¸€ä¸ªæ ·æœ¬æ²¡æœ‰å›¾ç‰‡ã€‚ç®—å­æ­£ç¡®å¤„ç†è¿™ç§æƒ…å†µï¼Œä¸ºæ²¡æœ‰å›¾ç‰‡çš„æ ·æœ¬åˆ†é…äº†ä¸€ä¸ªç©ºçš„æ ‡ç­¾æ•°ç»„ã€‚å¯¹äºæœ‰å›¾ç‰‡çš„æ ·æœ¬ï¼Œç®—å­åƒå¾€å¸¸ä¸€æ ·ç”Ÿæˆé€‚å½“çš„æ ‡ç­¾ã€‚è¿™è¡¨æ˜ç®—å­å¯ä»¥ä¼˜é›…åœ°å¤„ç†æŸäº›æ ·æœ¬å¯èƒ½ä¸åŒ…å«ä»»ä½•å›¾ç‰‡çš„æƒ…å†µï¼Œç¡®ä¿è¾“å‡ºçš„æ•°æ®ç»“æ„ä¿æŒä¸€è‡´ã€‚


## ğŸ”— related links ç›¸å…³é“¾æ¥
- [source code æºä»£ç ](../../../data_juicer/ops/mapper/image_tagging_mapper.py)
- [unit test å•å…ƒæµ‹è¯•](../../../tests/ops/mapper/test_image_tagging_mapper.py)
- [Return operator list è¿”å›ç®—å­åˆ—è¡¨](../../Operators.md)