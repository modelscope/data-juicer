# video_split_by_duration_mapper

Splits videos into segments based on a specified duration.

This operator splits each video in the dataset into smaller segments, each with a fixed
duration. The last segment is discarded if its duration is less than the specified
minimum last split duration. The original sample can be kept or removed based on the
`keep_original_sample` parameter. The generated video files are saved in the specified
directory or, if not provided, in the same directory as the input files. The key metric
for this operation is the duration of each segment, which is character-based (seconds).

- Splits videos into segments of a specified duration.
- Discards the last segment if it is shorter than the minimum allowed duration.
- Keeps or removes the original sample based on the `keep_original_sample` parameter.
- Saves the generated video files in the specified directory or the input file's
directory.
- Uses the duration in seconds to determine the segment boundaries.

Type ç®—å­ç±»å‹: **mapper**

Tags æ ‡ç­¾: cpu, multimodal

## ğŸ”§ Parameter Configuration å‚æ•°é…ç½®
| name å‚æ•°å | type ç±»å‹ | default é»˜è®¤å€¼ | desc è¯´æ˜ |
|--------|------|--------|------|
| `split_duration` | <class 'float'> | `10` | duration of each video split in seconds. |
| `min_last_split_duration` | <class 'float'> | `0` | The minimum allowable duration in |
| `keep_original_sample` | <class 'bool'> | `True` | whether to keep the original sample. If |
| `save_dir` | <class 'str'> | `None` | The directory where generated video files will be stored. |
| `args` |  | `''` | extra args |
| `kwargs` |  | `''` | extra args |

## ğŸ“Š Effect demonstration æ•ˆæœæ¼”ç¤º
### test
```python
VideoSplitByDurationMapper(split_duration=10, keep_original_sample=False)
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text | 1 video</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt; ç™½è‰²çš„å°ç¾Šç«™åœ¨ä¸€æ—è®²è¯ã€‚æ—è¾¹è¿˜æœ‰ä¸¤åªç°è‰²çŒ«å’ªå’Œä¸€åªæ‹‰ç€ç°ç‹¼çš„çŒ«å’ªã€‚</pre><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video1.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video1.mp4" controls width="320" style="margin:4px;"></video></div></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text | 1 video</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt; èº«ç©¿ç™½è‰²ä¸Šè¡£çš„ç”·å­ï¼Œæ‹¿ç€ä¸€ä¸ªä¸œè¥¿ï¼Œæ‹æ‰“è‡ªå·±çš„èƒƒéƒ¨ã€‚&lt;|__dj__eoc|&gt;</pre><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video2.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video2.mp4" controls width="320" style="margin:4px;"></video></div></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text | 1 video</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt; ä¸¤ä¸ªé•¿å¤´å‘çš„å¥³å­æ­£ååœ¨ä¸€å¼ åœ†æ¡Œå‰è®²è¯äº’åŠ¨ã€‚ &lt;|__dj__eoc|&gt;</pre><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video3.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video3.mp4" controls width="320" style="margin:4px;"></video></div></div></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt;&lt;__dj__video&gt; ç™½è‰²çš„å°ç¾Šç«™åœ¨ä¸€æ—è®²è¯ã€‚æ—è¾¹è¿˜æœ‰ä¸¤åªç°è‰²çŒ«å’ªå’Œä¸€åªæ‹‰ç€ç°ç‹¼çš„çŒ«å’ªã€‚&lt;|__dj__eoc|&gt;</pre><details style='margin-top:6px;'><summary style='cursor:pointer;'>other key</summary><table style='border-collapse:collapse; margin-top:6px;'><tr><td style='padding:4px 8px; color:#555;'>split_frames_num</td><td style='padding:4px 8px;'>[2]</td></tr></table></details></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt;&lt;__dj__video&gt;&lt;__dj__video&gt; èº«ç©¿ç™½è‰²ä¸Šè¡£çš„ç”·å­ï¼Œæ‹¿ç€ä¸€ä¸ªä¸œè¥¿ï¼Œæ‹æ‰“è‡ªå·±çš„èƒƒéƒ¨ã€‚&lt;|__dj__eoc|&gt;</pre><details style='margin-top:6px;'><summary style='cursor:pointer;'>other key</summary><table style='border-collapse:collapse; margin-top:6px;'><tr><td style='padding:4px 8px; color:#555;'>split_frames_num</td><td style='padding:4px 8px;'>[3]</td></tr></table></details></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt;&lt;__dj__video&gt;&lt;__dj__video&gt;&lt;__dj__video&gt;&lt;__dj__video&gt; ä¸¤ä¸ªé•¿å¤´å‘çš„å¥³å­æ­£ååœ¨ä¸€å¼ åœ†æ¡Œå‰è®²è¯äº’åŠ¨ã€‚ &lt;|__dj__eoc|&gt;</pre><details style='margin-top:6px;'><summary style='cursor:pointer;'>other key</summary><table style='border-collapse:collapse; margin-top:6px;'><tr><td style='padding:4px 8px; color:#555;'>split_frames_num</td><td style='padding:4px 8px;'>[5]</td></tr></table></details></div>

#### âœ¨ explanation è§£é‡Š
This example demonstrates the basic functionality of the VideoSplitByDurationMapper. The operator splits each video into segments, each 10 seconds long. The original samples are not kept, and the output shows the number of segments created for each video. For instance, the first video is split into 2 segments, while the third video is split into 5 segments.
è¿™ä¸ªä¾‹å­å±•ç¤ºäº†VideoSplitByDurationMapperçš„åŸºæœ¬åŠŸèƒ½ã€‚ç®—å­å°†æ¯ä¸ªè§†é¢‘åˆ†å‰²æˆ10ç§’ä¸€æ®µçš„ç‰‡æ®µã€‚åŸå§‹æ ·æœ¬æ²¡æœ‰ä¿ç•™ï¼Œè¾“å‡ºæ˜¾ç¤ºäº†æ¯ä¸ªè§†é¢‘åˆ›å»ºçš„ç‰‡æ®µæ•°é‡ã€‚ä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªè§†é¢‘è¢«åˆ†å‰²æˆ2ä¸ªç‰‡æ®µï¼Œè€Œç¬¬ä¸‰ä¸ªè§†é¢‘è¢«åˆ†å‰²æˆ5ä¸ªç‰‡æ®µã€‚

### test_min_last_split_duration
```python
VideoSplitByDurationMapper(split_duration=10, min_last_split_duration=3, keep_original_sample=False)
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text | 1 video</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt; ç™½è‰²çš„å°ç¾Šç«™åœ¨ä¸€æ—è®²è¯ã€‚æ—è¾¹è¿˜æœ‰ä¸¤åªç°è‰²çŒ«å’ªå’Œä¸€åªæ‹‰ç€ç°ç‹¼çš„çŒ«å’ªã€‚</pre><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video1.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video1.mp4" controls width="320" style="margin:4px;"></video></div></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text | 1 video</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt; èº«ç©¿ç™½è‰²ä¸Šè¡£çš„ç”·å­ï¼Œæ‹¿ç€ä¸€ä¸ªä¸œè¥¿ï¼Œæ‹æ‰“è‡ªå·±çš„èƒƒéƒ¨ã€‚&lt;|__dj__eoc|&gt;</pre><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video2.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video2.mp4" controls width="320" style="margin:4px;"></video></div></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text | 1 video</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt; ä¸¤ä¸ªé•¿å¤´å‘çš„å¥³å­æ­£ååœ¨ä¸€å¼ åœ†æ¡Œå‰è®²è¯äº’åŠ¨ã€‚ &lt;|__dj__eoc|&gt;</pre><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video3.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video3.mp4" controls width="320" style="margin:4px;"></video></div></div></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt; ç™½è‰²çš„å°ç¾Šç«™åœ¨ä¸€æ—è®²è¯ã€‚æ—è¾¹è¿˜æœ‰ä¸¤åªç°è‰²çŒ«å’ªå’Œä¸€åªæ‹‰ç€ç°ç‹¼çš„çŒ«å’ªã€‚&lt;|__dj__eoc|&gt;</pre><details style='margin-top:6px;'><summary style='cursor:pointer;'>other key</summary><table style='border-collapse:collapse; margin-top:6px;'><tr><td style='padding:4px 8px; color:#555;'>split_frames_num</td><td style='padding:4px 8px;'>[1]</td></tr></table></details></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt;&lt;__dj__video&gt;&lt;__dj__video&gt; èº«ç©¿ç™½è‰²ä¸Šè¡£çš„ç”·å­ï¼Œæ‹¿ç€ä¸€ä¸ªä¸œè¥¿ï¼Œæ‹æ‰“è‡ªå·±çš„èƒƒéƒ¨ã€‚&lt;|__dj__eoc|&gt;</pre><details style='margin-top:6px;'><summary style='cursor:pointer;'>other key</summary><table style='border-collapse:collapse; margin-top:6px;'><tr><td style='padding:4px 8px; color:#555;'>split_frames_num</td><td style='padding:4px 8px;'>[3]</td></tr></table></details></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt;&lt;__dj__video&gt;&lt;__dj__video&gt;&lt;__dj__video&gt;&lt;__dj__video&gt; ä¸¤ä¸ªé•¿å¤´å‘çš„å¥³å­æ­£ååœ¨ä¸€å¼ åœ†æ¡Œå‰è®²è¯äº’åŠ¨ã€‚ &lt;|__dj__eoc|&gt;</pre><details style='margin-top:6px;'><summary style='cursor:pointer;'>other key</summary><table style='border-collapse:collapse; margin-top:6px;'><tr><td style='padding:4px 8px; color:#555;'>split_frames_num</td><td style='padding:4px 8px;'>[5]</td></tr></table></details></div>

#### âœ¨ explanation è§£é‡Š
This example illustrates an important edge case where the last segment of a video is discarded if its duration is less than the specified minimum last split duration (3 seconds in this case). The operator still splits videos into 10-second segments, but any final segment shorter than 3 seconds is removed. This ensures that all resulting segments meet the minimum duration requirement. For example, the first video only has one segment because the last part is too short to be included.
è¿™ä¸ªä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªé‡è¦çš„è¾¹ç¼˜æƒ…å†µï¼Œå³å¦‚æœè§†é¢‘çš„æœ€åä¸€æ®µæ—¶é•¿å°äºæŒ‡å®šçš„æœ€å°æœ€åä¸€æ®µæ—¶é•¿ï¼ˆæœ¬ä¾‹ä¸­ä¸º3ç§’ï¼‰ï¼Œåˆ™è¯¥æ®µä¼šè¢«ä¸¢å¼ƒã€‚ç®—å­ä»ç„¶å°†è§†é¢‘åˆ†å‰²æˆ10ç§’ä¸€æ®µçš„ç‰‡æ®µï¼Œä½†ä»»ä½•çŸ­äº3ç§’çš„æœ€åä¸€æ®µéƒ½ä¼šè¢«ç§»é™¤ã€‚è¿™ç¡®ä¿äº†æ‰€æœ‰ç”Ÿæˆçš„ç‰‡æ®µéƒ½æ»¡è¶³æœ€å°æ—¶é•¿è¦æ±‚ã€‚ä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªè§†é¢‘åªæœ‰ä¸€ä¸ªç‰‡æ®µï¼Œå› ä¸ºæœ€åä¸€éƒ¨åˆ†å¤ªçŸ­è€Œæ— æ³•åŒ…å«åœ¨å†…ã€‚


## ğŸ”— related links ç›¸å…³é“¾æ¥
- [source code æºä»£ç ](../../../data_juicer/ops/mapper/video_split_by_duration_mapper.py)
- [unit test å•å…ƒæµ‹è¯•](../../../tests/ops/mapper/test_video_split_by_duration_mapper.py)
- [Return operator list è¿”å›ç®—å­åˆ—è¡¨](../../Operators.md)