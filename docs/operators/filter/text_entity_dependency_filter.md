# text_entity_dependency_filter

Identify and filter text samples based on entity dependencies.

This operator uses a spaCy model to detect entities in the text and evaluates their dependency relationships. It filters out samples where entities have fewer than a specified number of dependency edges. The key metric is 'num_dependency_edges', which counts the number of edges for each entity in the dependency tree. Samples with no detected entities are omitted. The operator supports 'any' or 'all' strategies: 'any' keeps samples if at least one entity meets the dependency threshold, while 'all' requires all entities to meet the threshold. Supported languages are English ('en') and Chinese ('zh').

æ ¹æ®å®ä½“ä¾èµ–å…³ç³»è¯†åˆ«å¹¶è¿‡æ»¤æ–‡æœ¬æ ·æœ¬ã€‚

è¯¥ç®—å­ä½¿ç”¨spaCyæ¨¡å‹æ£€æµ‹æ–‡æœ¬ä¸­çš„å®ä½“ï¼Œå¹¶è¯„ä¼°å®ƒä»¬çš„ä¾èµ–å…³ç³»ã€‚å®ƒä¼šè¿‡æ»¤æ‰å®ä½“ä¾èµ–è¾¹å°‘äºæŒ‡å®šæ•°é‡çš„æ ·æœ¬ã€‚å…³é”®æŒ‡æ ‡æ˜¯'num_dependency_edges'ï¼Œå®ƒè®¡ç®—æ¯ä¸ªå®ä½“åœ¨ä¾èµ–æ ‘ä¸­çš„è¾¹æ•°ã€‚æ²¡æœ‰æ£€æµ‹åˆ°å®ä½“çš„æ ·æœ¬å°†è¢«å¿½ç•¥ã€‚è¯¥ç®—å­æ”¯æŒ'any'æˆ–'all'ç­–ç•¥ï¼š'any'ç­–ç•¥ä¼šåœ¨è‡³å°‘ä¸€ä¸ªå®ä½“æ»¡è¶³ä¾èµ–é˜ˆå€¼æ—¶ä¿ç•™æ ·æœ¬ï¼Œè€Œ'all'ç­–ç•¥è¦æ±‚æ‰€æœ‰å®ä½“éƒ½æ»¡è¶³é˜ˆå€¼ã€‚æ”¯æŒçš„è¯­è¨€æ˜¯è‹±è¯­ï¼ˆ'en'ï¼‰å’Œä¸­æ–‡ï¼ˆ'zh'ï¼‰ã€‚

Type ç®—å­ç±»å‹: **filter**

Tags æ ‡ç­¾: cpu, text

## ğŸ”§ Parameter Configuration å‚æ•°é…ç½®
| name å‚æ•°å | type ç±»å‹ | default é»˜è®¤å€¼ | desc è¯´æ˜ |
|--------|------|--------|------|
| `lang` | <class 'str'> | `'en'` | language of the text in the samples. 'en' for detection of entities in English and 'zh' for detection of entities in Chinese. |
| `min_dependency_num` | <class 'int'> | `1` | The min token number in the filtering. Objects is independent if their number of edges in the dependency tree is below this parameter. |
| `any_or_all` | <class 'str'> | `'all'` | keep this sample with 'any' or 'all' strategy. 'any': keep this sample if any object is dependent. 'all': keep this sample only if all images are dependent. |
| `args` |  | `''` |  |
| `kwargs` |  | `''` |  |

## ğŸ“Š Effect demonstration æ•ˆæœæ¼”ç¤º
### test_en_text_case
```python
TextEntityDependencyFilter(lang='en', any_or_all='any')
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">She is smiling.</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Tom is playing piano.</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">piano.</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 4:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">a green tree</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 5:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">tree</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 6:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">book. mountain. star. potato</pre></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">She is smiling.</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Tom is playing piano.</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">a green tree</pre></div>

#### âœ¨ explanation è§£é‡Š
The operator filters English text samples based on the dependency relationships of detected entities, keeping those with at least one entity having a sufficient number of dependency edges. Samples without any detected entities are removed.
è¯¥ç®—å­åŸºäºæ£€æµ‹åˆ°çš„å®ä½“çš„ä¾å­˜å…³ç³»è¿‡æ»¤è‹±æ–‡æ–‡æœ¬æ ·æœ¬ï¼Œä¿ç•™è‡³å°‘æœ‰ä¸€ä¸ªå®ä½“å…·æœ‰è¶³å¤Ÿæ•°é‡çš„ä¾å­˜è¾¹çš„æ ·æœ¬ã€‚æ²¡æœ‰æ£€æµ‹åˆ°ä»»ä½•å®ä½“çš„æ ·æœ¬è¢«ç§»é™¤ã€‚

### test_zh_text_case
```python
TextEntityDependencyFilter(lang='zh', any_or_all='all')
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">å¥¹åœ¨ç¬‘</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">æ¯è—¤è€æ ‘æ˜é¸¦</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">ä¸Šä¸Šä¸‹ä¸‹å·¦å·¦å³å³</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 4:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">ä¸€åªä¼šä¸Šæ ‘çš„çŒ«</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 5:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">çŒ«</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 6:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">ä¹¦ã€‚å±±ã€‚æ˜Ÿæ˜Ÿã€‚åœŸè±†ã€‚</pre></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">å¥¹åœ¨ç¬‘</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">æ¯è—¤è€æ ‘æ˜é¸¦</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">ä¸€åªä¼šä¸Šæ ‘çš„çŒ«</pre></div>

#### âœ¨ explanation è§£é‡Š
The operator filters Chinese text samples, requiring all detected entities to have a sufficient number of dependency edges. Samples that do not meet this criterion for all entities or have no entities are filtered out.
è¯¥ç®—å­è¿‡æ»¤ä¸­æ–‡æ–‡æœ¬æ ·æœ¬ï¼Œè¦æ±‚æ‰€æœ‰æ£€æµ‹åˆ°çš„å®ä½“éƒ½å…·æœ‰è¶³å¤Ÿæ•°é‡çš„ä¾å­˜è¾¹ã€‚ä¸æ»¡è¶³æ­¤æ ‡å‡†çš„æ‰€æœ‰å®ä½“æˆ–æ²¡æœ‰ä»»ä½•å®ä½“çš„æ ·æœ¬å°†è¢«è¿‡æ»¤æ‰ã€‚


## ğŸ”— related links ç›¸å…³é“¾æ¥
- [source code æºä»£ç ](../../../data_juicer/ops/filter/text_entity_dependency_filter.py)
- [unit test å•å…ƒæµ‹è¯•](../../../tests/ops/filter/test_text_entity_dependency_filter.py)
- [Return operator list è¿”å›ç®—å­åˆ—è¡¨](../../Operators.md)