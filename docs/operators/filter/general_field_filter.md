# general_field_filter

Filter to keep samples based on a general field filter condition.

The filter condition is a string that can include logical operators (and/or) and chain comparisons. For example: "10 < num <= 30 and text != 'nothing here' and __dj__meta__.a == 3". The condition is evaluated for each sample, and only samples that meet the condition are kept. The result of the filter condition is stored in the sample's stats under the key 'general_field_filter_condition'. If the filter condition is empty or already computed, the sample is not re-evaluated.

åŸºäºé€šç”¨å­—æ®µè¿‡æ»¤æ¡ä»¶æ¥ä¿ç•™æ ·æœ¬ã€‚

è¿‡æ»¤æ¡ä»¶æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥åŒ…å«é€»è¾‘è¿ç®—ç¬¦ï¼ˆand/orï¼‰å’Œé“¾å¼æ¯”è¾ƒã€‚ä¾‹å¦‚ï¼š"10 < num <= 30 and text != 'nothing here' and __dj__meta__.a == 3"ã€‚è¯¥æ¡ä»¶ä¼šå¯¹æ¯ä¸ªæ ·æœ¬è¿›è¡Œè¯„ä¼°ï¼Œåªæœ‰æ»¡è¶³æ¡ä»¶çš„æ ·æœ¬æ‰ä¼šè¢«ä¿ç•™ã€‚è¿‡æ»¤æ¡ä»¶çš„ç»“æœå­˜å‚¨åœ¨æ ·æœ¬çš„ stats å­—æ®µä¸­ï¼Œé”®åä¸º 'general_field_filter_condition'ã€‚å¦‚æœè¿‡æ»¤æ¡ä»¶ä¸ºç©ºæˆ–å·²ç»è®¡ç®—è¿‡ï¼Œåˆ™ä¸ä¼šé‡æ–°è¯„ä¼°æ ·æœ¬ã€‚

Type ç®—å­ç±»å‹: **filter**

Tags æ ‡ç­¾: cpu

## ğŸ”§ Parameter Configuration å‚æ•°é…ç½®
| name å‚æ•°å | type ç±»å‹ | default é»˜è®¤å€¼ | desc è¯´æ˜ |
|--------|------|--------|------|
| `filter_condition` | <class 'str'> | `''` | The filter condition as a string. It can include logical operators (and/or) and chain comparisons. For example: "10 < num <= 30 and text != 'nothing here' and __dj__meta__.a == 3". |
| `args` |  | `''` |  |
| `kwargs` |  | `''` |  |

## ğŸ“Š Effect demonstration æ•ˆæœæ¼”ç¤º
### test_simple_comparison
```python
GeneralFieldFilter(filter_condition='10 < num < 20')
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">sample1</pre><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:8px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>num</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>5</td></tr></table></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">sample2</pre><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:8px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>num</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>15</td></tr></table></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">sample3</pre><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:8px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>num</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>25</td></tr></table></div></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">sample2</pre><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:8px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>num</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>15</td></tr><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__stats__</th></tr><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>general_field_filter_condition</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>True</td></tr></table></div></div>

#### âœ¨ explanation è§£é‡Š
This example demonstrates the operator's ability to filter data based on a simple comparison. The operator checks if the 'num' field is between 10 and 20. Only the sample with 'num' equal to 15 meets this condition, so it is kept in the output. The output also includes an additional '__dj__stats__' field indicating that the condition was met.
è¿™ä¸ªä¾‹å­å±•ç¤ºäº†ç®—å­åŸºäºç®€å•æ¯”è¾ƒæ¥è¿‡æ»¤æ•°æ®çš„èƒ½åŠ›ã€‚ç®—å­æ£€æŸ¥'num'å­—æ®µæ˜¯å¦åœ¨10åˆ°20ä¹‹é—´ã€‚åªæœ‰'num'ç­‰äº15çš„æ ·æœ¬æ»¡è¶³è¿™ä¸ªæ¡ä»¶ï¼Œå› æ­¤å®ƒè¢«ä¿ç•™åœ¨è¾“å‡ºä¸­ã€‚è¾“å‡ºè¿˜åŒ…æ‹¬ä¸€ä¸ªé¢å¤–çš„'__dj__stats__'å­—æ®µï¼Œè¡¨ç¤ºæ¡ä»¶å·²è¢«æ»¡è¶³ã€‚

### test_field_missing
```python
GeneralFieldFilter(filter_condition='num <= 5')
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">sample1</pre><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:8px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>num</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>5</td></tr></table></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">sample2</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">sample3</pre><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:8px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>num</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>25</td></tr></table></div></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">sample1</pre><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:8px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>num</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>5</td></tr><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__stats__</th></tr><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>general_field_filter_condition</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>True</td></tr></table></div></div>

#### âœ¨ explanation è§£é‡Š
This example shows how the operator handles missing fields. The filter condition checks if 'num' is less than or equal to 5. If the 'num' field is missing, the sample is automatically excluded. In this case, only the first sample has a 'num' value of 5 and is kept. The output also includes an additional '__dj__stats__' field indicating that the condition was met.
è¿™ä¸ªä¾‹å­å±•ç¤ºäº†ç®—å­å¦‚ä½•å¤„ç†ç¼ºå¤±çš„å­—æ®µã€‚è¿‡æ»¤æ¡ä»¶æ£€æŸ¥'num'æ˜¯å¦å°äºæˆ–ç­‰äº5ã€‚å¦‚æœ'num'å­—æ®µç¼ºå¤±ï¼Œæ ·æœ¬å°†è‡ªåŠ¨è¢«æ’é™¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªæ ·æœ¬çš„'num'å€¼ä¸º5å¹¶è¢«ä¿ç•™ã€‚è¾“å‡ºè¿˜åŒ…æ‹¬ä¸€ä¸ªé¢å¤–çš„'__dj__stats__'å­—æ®µï¼Œè¡¨ç¤ºæ¡ä»¶å·²è¢«æ»¡è¶³ã€‚


## ğŸ”— related links ç›¸å…³é“¾æ¥
- [source code æºä»£ç ](../../../data_juicer/ops/filter/general_field_filter.py)
- [unit test å•å…ƒæµ‹è¯•](../../../tests/ops/filter/test_general_field_filter.py)
- [Return operator list è¿”å›ç®—å­åˆ—è¡¨](../../Operators.md)