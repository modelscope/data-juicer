# video_aesthetics_filter

Filter to keep data samples with aesthetics scores for specified frames in the videos within a specific range.

This operator evaluates the aesthetic quality of video frames using a Hugging Face model. It keeps samples where the aesthetics scores of the specified frames fall within a given range. The key metric, 'video_frames_aesthetics_score', is computed by averaging, taking the max, or min of the frame scores, depending on the reduce mode. Frame sampling can be done uniformly or by extracting all keyframes. The filter applies a 'any' or 'all' strategy to decide if a sample should be kept based on the scores of multiple videos.

ç”¨äºä¿ç•™è§†é¢‘ä¸­æŒ‡å®šå¸§çš„ç¾å­¦è¯„åˆ†åœ¨ç‰¹å®šèŒƒå›´å†…çš„æ•°æ®æ ·æœ¬çš„è¿‡æ»¤å™¨ã€‚

è¯¥ç®—å­ä½¿ç”¨Hugging Faceæ¨¡å‹è¯„ä¼°è§†é¢‘å¸§çš„ç¾å­¦è´¨é‡ã€‚å®ƒä¿ç•™æŒ‡å®šå¸§çš„ç¾å­¦è¯„åˆ†åœ¨ç»™å®šèŒƒå›´å†…çš„æ ·æœ¬ã€‚å…³é”®æŒ‡æ ‡'video_frames_aesthetics_score'é€šè¿‡å¹³å‡ã€å–æœ€å¤§å€¼æˆ–æœ€å°å€¼çš„æ–¹å¼è®¡ç®—å¸§è¯„åˆ†ï¼Œå…·ä½“å–å†³äºå½’çº¦æ¨¡å¼ã€‚å¸§é‡‡æ ·å¯ä»¥å‡åŒ€è¿›è¡Œæˆ–æå–æ‰€æœ‰å…³é”®å¸§ã€‚è¯¥è¿‡æ»¤å™¨åº”ç”¨'any'æˆ–'all'ç­–ç•¥æ¥å†³å®šæ˜¯å¦æ ¹æ®å¤šä¸ªè§†é¢‘çš„è¯„åˆ†ä¿ç•™æ ·æœ¬ã€‚

Type ç®—å­ç±»å‹: **filter**

Tags æ ‡ç­¾: cpu, hf, video

## ğŸ”§ Parameter Configuration å‚æ•°é…ç½®
| name å‚æ•°å | type ç±»å‹ | default é»˜è®¤å€¼ | desc è¯´æ˜ |
|--------|------|--------|------|
| `hf_scorer_model` | <class 'str'> | `''` | Huggingface model name for the aesthetics predictor. By default, we will use 'shunk031/aesthetics-predictor-v2-sac-logos-ava1-l14-linearMSE', refer to pypi.org/project/simple-aesthetics-predictor |
| `trust_remote_code` | <class 'bool'> | `False` | whether to trust the remote code of HF models. |
| `min_score` | <class 'float'> | `0.4` | Min score for the predicted aesthetics in a video. |
| `max_score` | <class 'float'> | `1.0` | Max score for the predicted aesthetics in a video. |
| `frame_sampling_method` | <class 'str'> | `'uniform'` | sampling method of extracting frame images from the videos. Should be one of ["all_keyframes", "uniform"]. The former one extracts all key frames and the latter one extract specified number of frames uniformly from the video. Default: "uniform" with frame_num=3, considering that the number of keyframes can be large while their difference is usually small in terms of their aesthetics. |
| `frame_num` | typing.Annotated[int, Gt(gt=0)] | `3` | the number of frames to be extracted uniformly from the video. Only works when frame_sampling_method is "uniform". If it's 1, only the middle frame will be extracted. If it's 2, only the first and the last frames will be extracted. If it's larger than 2, in addition to the first and the last frames, other frames will be extracted uniformly within the video duration. |
| `any_or_all` | <class 'str'> | `'any'` | Keep this sample with 'any' or 'all' strategy of all videos. 'any': keep this sample if any videos meet the condition. 'all': keep this sample only if all videos meet the condition. |
| `reduce_mode` | <class 'str'> | `'avg'` | reduce mode when one sample corresponds to multiple frames, must be one of ['avg','max', 'min']. 'avg': Take the average of multiple values 'max': Take the max of multiple values 'min': Take the min of multiple values |
| `args` |  | `''` | Extra positional arguments. |
| `kwargs` |  | `''` | Extra keyword arguments. |

## ğŸ“Š Effect demonstration æ•ˆæœæ¼”ç¤º
### test_default_filter
```python
VideoAestheticsFilter('shunk031/aesthetics-predictor-v2-sac-logos-ava1-l14-linearMSE')
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text | 1 video</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt; [[q]]: Can you summarize what the girls are doing in the video?
&quot;, &quot;[[a]]: Sure. The video shows a girl brushing the hair of another girl who keeps moving her face around while the first girl keeps brushing the hair.&lt;|__dj__eoc|&gt;</pre><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video4.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video4.mp4" controls width="320" style="margin:4px;"></video></div></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text | 1 video</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt; ç™½è‰²çš„å°ç¾Šç«™åœ¨ä¸€æ—è®²è¯ã€‚æ—è¾¹è¿˜æœ‰ä¸¤åªç°è‰²çŒ«å’ªå’Œä¸€åªæ‹‰ç€ç°ç‹¼çš„çŒ«å’ª&lt;|__dj__eoc|&gt;</pre><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video1.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video1.mp4" controls width="320" style="margin:4px;"></video></div></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text | 1 video</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">ä¸¤ä¸ªé•¿å¤´å‘çš„å¥³å­æ­£ååœ¨ä¸€å¼ åœ†æ¡Œå‰è®²è¯äº’åŠ¨ã€‚ &lt;__dj__video&gt; &lt;|__dj__eoc|&gt;</pre><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video3.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video3.mp4" controls width="320" style="margin:4px;"></video></div></div></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> 1 video</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video4.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video4.mp4" controls width="320" style="margin:4px;"></video></div></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> 1 video</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video1.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video1.mp4" controls width="320" style="margin:4px;"></video></div></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> 1 video</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video3.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video3.mp4" controls width="320" style="margin:4px;"></video></div></div></div>

#### âœ¨ explanation è§£é‡Š
The VideoAestheticsFilter operator evaluates the aesthetic quality of video frames using a Hugging Face model. In this example, all videos are kept because no specific score range is set. The output data shows only the 'videos' field, which means the text and other fields have been removed for simplicity.
ç®—å­VideoAestheticsFilterä½¿ç”¨Hugging Faceæ¨¡å‹è¯„ä¼°è§†é¢‘å¸§çš„ç¾è§‚åº¦ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±äºæ²¡æœ‰è®¾ç½®ç‰¹å®šçš„åˆ†æ•°èŒƒå›´ï¼Œæ‰€æœ‰è§†é¢‘éƒ½è¢«ä¿ç•™ã€‚è¾“å‡ºæ•°æ®åªæ˜¾ç¤ºäº†'videos'å­—æ®µï¼Œè¿™æ„å‘³ç€æ–‡æœ¬å’Œå…¶ä»–å­—æ®µä¸ºäº†ç®€åŒ–è€Œè¢«ç§»é™¤ã€‚

### test_filter_large_score_videos
```python
VideoAestheticsFilter('shunk031/aesthetics-predictor-v2-sac-logos-ava1-l14-linearMSE', max_score=0.45)
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text | 1 video</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt; [[q]]: Can you summarize what the girls are doing in the video?
&quot;, &quot;[[a]]: Sure. The video shows a girl brushing the hair of another girl who keeps moving her face around while the first girl keeps brushing the hair.&lt;|__dj__eoc|&gt;</pre><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video4.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video4.mp4" controls width="320" style="margin:4px;"></video></div></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text | 1 video</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">&lt;__dj__video&gt; ç™½è‰²çš„å°ç¾Šç«™åœ¨ä¸€æ—è®²è¯ã€‚æ—è¾¹è¿˜æœ‰ä¸¤åªç°è‰²çŒ«å’ªå’Œä¸€åªæ‹‰ç€ç°ç‹¼çš„çŒ«å’ª&lt;|__dj__eoc|&gt;</pre><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video1.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video1.mp4" controls width="320" style="margin:4px;"></video></div></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text | 1 video</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">ä¸¤ä¸ªé•¿å¤´å‘çš„å¥³å­æ­£ååœ¨ä¸€å¼ åœ†æ¡Œå‰è®²è¯äº’åŠ¨ã€‚ &lt;__dj__video&gt; &lt;|__dj__eoc|&gt;</pre><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video3.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video3.mp4" controls width="320" style="margin:4px;"></video></div></div></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> 1 video</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video4.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video4.mp4" controls width="320" style="margin:4px;"></video></div></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> 1 video</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video1.mp4:</div><div class="video-grid"><video src="../../../tests/ops/data/video1.mp4" controls width="320" style="margin:4px;"></video></div></div></div>

#### âœ¨ explanation è§£é‡Š
This example uses the VideoAestheticsFilter with a maximum score of 0.45. It keeps only the videos with an aesthetics score below or equal to 0.45. Videos with higher scores are filtered out. The output data contains only the 'videos' field, with other fields removed for clarity.
è¿™ä¸ªä¾‹å­ä½¿ç”¨äº†æœ€å¤§åˆ†æ•°ä¸º0.45çš„VideoAestheticsFilterã€‚å®ƒåªä¿ç•™ç¾è§‚åº¦åˆ†æ•°å°äºæˆ–ç­‰äº0.45çš„è§†é¢‘ã€‚åˆ†æ•°é«˜äº0.45çš„è§†é¢‘è¢«è¿‡æ»¤æ‰ã€‚è¾“å‡ºæ•°æ®ä»…åŒ…å«'videos'å­—æ®µï¼Œå…¶ä»–å­—æ®µä¸ºäº†æ¸…æ™°èµ·è§å·²è¢«ç§»é™¤ã€‚


## ğŸ”— related links ç›¸å…³é“¾æ¥
- [source code æºä»£ç ](../../../data_juicer/ops/filter/video_aesthetics_filter.py)
- [unit test å•å…ƒæµ‹è¯•](../../../tests/ops/filter/test_video_aesthetics_filter.py)
- [Return operator list è¿”å›ç®—å­åˆ—è¡¨](../../Operators.md)