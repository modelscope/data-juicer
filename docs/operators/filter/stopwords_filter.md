# stopwords_filter

Filter to keep samples with stopword ratio within a specified range.

This operator calculates the ratio of stopwords in a sample and keeps samples where this ratio is between the specified minimum and maximum values. The stopword ratio is computed as the number of stopwords divided by the total number of words. If the `tokenization` parameter is set, a Hugging Face tokenizer is used to tokenize the text. The stopwords are loaded from a directory, and if the language is set to "all", it merges stopwords from all available languages. The key metric is `stopwords_ratio`, which is character-based by default. The operator also supports word augmentation for specific languages.

ç”¨äºä¿ç•™åœç”¨è¯æ¯”ç‡åœ¨æŒ‡å®šèŒƒå›´å†…çš„æ ·æœ¬çš„è¿‡æ»¤å™¨ã€‚

è¯¥ç®—å­è®¡ç®—æ ·æœ¬ä¸­åœç”¨è¯çš„æ¯”ä¾‹ï¼Œå¹¶ä¿ç•™è¯¥æ¯”ä¾‹åœ¨æŒ‡å®šæœ€å°å€¼å’Œæœ€å¤§å€¼èŒƒå›´å†…çš„æ ·æœ¬ã€‚åœç”¨è¯æ¯”ç‡è®¡ç®—ä¸ºåœç”¨è¯æ•°é‡é™¤ä»¥æ€»è¯æ•°ã€‚å¦‚æœè®¾ç½®äº† `tokenization` å‚æ•°ï¼Œåˆ™ä½¿ç”¨ Hugging Face åˆ†è¯å™¨å¯¹æ–‡æœ¬è¿›è¡Œåˆ†è¯ã€‚åœç”¨è¯ä»ä¸€ä¸ªç›®å½•ä¸­åŠ è½½ï¼Œå¦‚æœè¯­è¨€è®¾ç½®ä¸º "all"ï¼Œåˆ™åˆå¹¶æ‰€æœ‰å¯ç”¨è¯­è¨€çš„åœç”¨è¯ã€‚å…³é”®æŒ‡æ ‡æ˜¯ `stopwords_ratio`ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯åŸºäºå­—ç¬¦çš„ã€‚è¯¥ç®—å­è¿˜æ”¯æŒç‰¹å®šè¯­è¨€çš„è¯å¢å¼ºã€‚

Type ç®—å­ç±»å‹: **filter**

Tags æ ‡ç­¾: cpu, text

## ğŸ”§ Parameter Configuration å‚æ•°é…ç½®
| name å‚æ•°å | type ç±»å‹ | default é»˜è®¤å€¼ | desc è¯´æ˜ |
|--------|------|--------|------|
| `lang` | <class 'str'> | `'en'` | Consider stopwords in what language. If lang == "all", we will adopt the one merged from all the available languages |
| `tokenization` | <class 'bool'> | `False` | whether to use model to tokenize documents |
| `min_ratio` | <class 'float'> | `0.3` | The min filter ratio in this op. |
| `max_ratio` | <class 'float'> | `1.0` | The max filter ratio in this op. |
| `stopwords_dir` | <class 'str'> | `'/home/cmgzn/.cache/data_juicer/assets'` | The directory storing the stopwords file(s) whose name includes "stopwords" and in json format |
| `use_words_aug` | <class 'bool'> | `False` | Whether to augment words, especially for Chinese and Vietnamese |
| `words_aug_group_sizes` | typing.List[typing.Annotated[int, Gt(gt=0)]] | `[2]` | The group size of words to augment |
| `words_aug_join_char` | <class 'str'> | `''` | The join char between words to augment |
| `args` |  | `''` | extra args |
| `kwargs` |  | `''` | extra args |

## ğŸ“Š Effect demonstration æ•ˆæœæ¼”ç¤º
### test_en_case
```python
StopWordsFilter(lang='en', min_ratio=0.3)
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Today is Sunday and it&#x27;s a happy day!</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Today is Sund Sund Sund Sund Sunda and it&#x27;s a happy day!</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">a v s e c s f e f g a qkc</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 4:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">ï¼Œã€‚ã€â€â€â€œÂ«Â»ï¼‘ã€ã€Œã€Šã€‹Â´âˆ¶ï¼šï¼Ÿï¼ï¼ˆï¼‰ï¼›â€“â€”ï¼ï½â€™â€¦â”ã€ˆã€‰ã€ã€‘ï¼…â–º</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 5:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Do you need a cup of coffee?</pre></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Today is Sunday and it&#x27;s a happy day!</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Today is Sund Sund Sund Sund Sunda and it&#x27;s a happy day!</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">Do you need a cup of coffee?</pre></div>

#### âœ¨ explanation è§£é‡Š
The operator filters out samples where the ratio of English stopwords to total words is less than 0.3. The first, second, and last samples have a sufficient stopword ratio to be kept, while the third sample, being mostly nonsensical, and the fourth, containing only symbols, are removed due to insufficient stopword ratios.
è¯¥ç®—å­ä¼šè¿‡æ»¤æ‰è‹±æ–‡åœç”¨è¯æ¯”ä¾‹å°äº0.3çš„æ ·æœ¬ã€‚ç¬¬ä¸€ä¸ªã€ç¬¬äºŒä¸ªå’Œæœ€åä¸€ä¸ªæ ·æœ¬çš„åœç”¨è¯æ¯”ä¾‹è¶³å¤Ÿé«˜ï¼Œå› æ­¤è¢«ä¿ç•™ï¼›è€Œç¬¬ä¸‰ä¸ªæ ·æœ¬ç”±äºå¤§éƒ¨åˆ†æ˜¯æ— æ„ä¹‰çš„å†…å®¹ï¼Œç¬¬å››ä¸ªæ ·æœ¬ä»…åŒ…å«ç¬¦å·ï¼Œå®ƒä»¬çš„åœç”¨è¯æ¯”ä¾‹ä¸è¶³ï¼Œå› æ­¤è¢«ç§»é™¤ã€‚

### test_zh_case
```python
StopWordsFilter(lang='zh', tokenization=True, min_ratio=0.2, use_words_aug=True)
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">ä½ å¥½ï¼Œè¯·é—®ä½ æ˜¯è°</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€å æ¯”ã€ä»£ç </pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">åŸºäºå‰ä¸€æ­¥ç»“æœï¼Œåœ¨åŒä¸€ä¸ªèšç±»ä¸­æ‰¾å‡ºé‚£äº›è¿‡é•¿æ–‡æ¡£ä¸ºå‡æ­£ä¾‹ï¼Œæš‚ä¸è¿›è¡Œæ»¤é™¤</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 4:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">ä½¿ç”¨ç‰‡æ®µåˆ†è¯å™¨å¯¹æ¯ä¸ªé¡µé¢è¿›è¡Œåˆ†è¯ï¼Œä½¿ç”¨è¯­è¨€æ¨¡å‹è®¡ç®—æ¯ä¸ªæ®µè½çš„å›°æƒ‘åº¦å¾—åˆ†ï¼Œç”±æ­¤è¿‡æ»¤ä½è´¨é‡æ–‡æœ¬</pre></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">ä½ å¥½ï¼Œè¯·é—®ä½ æ˜¯è°</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">åŸºäºå‰ä¸€æ­¥ç»“æœï¼Œåœ¨åŒä¸€ä¸ªèšç±»ä¸­æ‰¾å‡ºé‚£äº›è¿‡é•¿æ–‡æ¡£ä¸ºå‡æ­£ä¾‹ï¼Œæš‚ä¸è¿›è¡Œæ»¤é™¤</pre></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> text</div><pre style="padding:6px; background:#f6f8fa; border-radius:4px; overflow-x:auto; white-space:pre; word-wrap:normal;">ä½¿ç”¨ç‰‡æ®µåˆ†è¯å™¨å¯¹æ¯ä¸ªé¡µé¢è¿›è¡Œåˆ†è¯ï¼Œä½¿ç”¨è¯­è¨€æ¨¡å‹è®¡ç®—æ¯ä¸ªæ®µè½çš„å›°æƒ‘åº¦å¾—åˆ†ï¼Œç”±æ­¤è¿‡æ»¤ä½è´¨é‡æ–‡æœ¬</pre></div>

#### âœ¨ explanation è§£é‡Š
This operator retains Chinese text samples with a stopword ratio greater than 0.2 after tokenization. It also uses word augmentation for specific languages. The first, third, and fourth samples meet the criteria, as their stopword ratios exceed the threshold. The second sample, which primarily consists of non-stopwords like 'letters, numbers, underscores, proportion, code', does not meet the minimum stopword ratio and is thus excluded.
è¯¥ç®—å­åœ¨åˆ†è¯åä¿ç•™åœç”¨è¯æ¯”ä¾‹å¤§äº0.2çš„ä¸­æ–‡æ–‡æœ¬æ ·æœ¬ï¼Œå¹¶å¯¹ç‰¹å®šè¯­è¨€ä½¿ç”¨è¯æ±‡å¢å¼ºã€‚ç¬¬ä¸€ä¸ªã€ç¬¬ä¸‰ä¸ªå’Œç¬¬å››ä¸ªæ ·æœ¬ç¬¦åˆæ ‡å‡†ï¼Œå› ä¸ºå®ƒä»¬çš„åœç”¨è¯æ¯”ä¾‹è¶…è¿‡äº†é˜ˆå€¼ã€‚ç¬¬äºŒä¸ªæ ·æœ¬ä¸»è¦ç”±éåœç”¨è¯å¦‚'å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€å æ¯”ã€ä»£ç 'ç»„æˆï¼Œæœªè¾¾åˆ°æœ€ä½åœç”¨è¯æ¯”ä¾‹è¦æ±‚ï¼Œå› æ­¤è¢«æ’é™¤ã€‚


## ğŸ”— related links ç›¸å…³é“¾æ¥
- [source code æºä»£ç ](../../../data_juicer/ops/filter/stopwords_filter.py)
- [unit test å•å…ƒæµ‹è¯•](../../../tests/ops/filter/test_stopwords_filter.py)
- [Return operator list è¿”å›ç®—å­åˆ—è¡¨](../../Operators.md)