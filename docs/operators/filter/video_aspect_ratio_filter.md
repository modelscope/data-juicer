# video_aspect_ratio_filter

Filter to keep samples with video aspect ratio within a specific range.

This operator filters samples based on the aspect ratios of their videos. It keeps samples where the video aspect ratios fall within a specified range. The aspect ratio is calculated as the width divided by the height (W / H). The operator supports two strategies for keeping samples: 'any' and 'all'. In 'any' mode, a sample is kept if at least one video meets the aspect ratio condition. In 'all' mode, all videos in the sample must meet the condition for the sample to be kept. The aspect ratios are computed and stored in the 'video_aspect_ratios' field of the sample's stats.

ç”¨äºä¿ç•™è§†é¢‘å®½é«˜æ¯”åœ¨ç‰¹å®šèŒƒå›´å†…çš„æ ·æœ¬çš„è¿‡æ»¤å™¨ã€‚

è¯¥ç®—å­æ ¹æ®è§†é¢‘çš„å®½é«˜æ¯”è¿‡æ»¤æ ·æœ¬ã€‚å®ƒä¿ç•™è§†é¢‘å®½é«˜æ¯”åœ¨æŒ‡å®šèŒƒå›´å†…çš„æ ·æœ¬ã€‚å®½é«˜æ¯”è®¡ç®—ä¸ºå®½åº¦é™¤ä»¥é«˜åº¦ï¼ˆW / Hï¼‰ã€‚è¯¥ç®—å­æ”¯æŒä¸¤ç§ä¿ç•™æ ·æœ¬çš„ç­–ç•¥ï¼š'any' å’Œ 'all'ã€‚åœ¨ 'any' æ¨¡å¼ä¸‹ï¼Œå¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªè§†é¢‘æ»¡è¶³å®½é«˜æ¯”æ¡ä»¶ï¼Œåˆ™ä¿ç•™è¯¥æ ·æœ¬ã€‚åœ¨ 'all' æ¨¡å¼ä¸‹ï¼Œæ ·æœ¬ä¸­çš„æ‰€æœ‰è§†é¢‘éƒ½å¿…é¡»æ»¡è¶³æ¡ä»¶æ‰èƒ½ä¿ç•™è¯¥æ ·æœ¬ã€‚å®½é«˜æ¯”è¢«è®¡ç®—å¹¶å­˜å‚¨åœ¨æ ·æœ¬çš„ stats ä¸­çš„ 'video_aspect_ratios' å­—æ®µä¸­ã€‚

Type ç®—å­ç±»å‹: **filter**

Tags æ ‡ç­¾: cpu, video

## ğŸ”§ Parameter Configuration å‚æ•°é…ç½®
| name å‚æ•°å | type ç±»å‹ | default é»˜è®¤å€¼ | desc è¯´æ˜ |
|--------|------|--------|------|
| `min_ratio` | <class 'str'> | `'9/21'` | The minimum aspect ratio to keep samples, supported format is a string, such as "9:21" or "9/21". |
| `max_ratio` | <class 'str'> | `'21/9'` | The maximum aspect ratio to keep samples, supported format is a string, such as "21:9" or "21/9". |
| `any_or_all` | <class 'str'> | `'any'` | keep this sample with 'any' or 'all' strategy of all videos. 'any': keep this sample if any videos meet the condition. 'all': keep this sample only if all videos meet the condition. |
| `args` |  | `''` | extra args |
| `kwargs` |  | `''` | extra args |

## ğŸ“Š Effect demonstration æ•ˆæœæ¼”ç¤º
### test_any
```python
VideoAspectRatioFilter(min_ratio='3/4', max_ratio='16/9', any_or_all='any')
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> 2 videos</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video1.mp4 +1 more:</div><div class="video-grid"><video src="../../../tests/ops/data/video1.mp4" controls width="320" style="margin:4px;"></video></div><details style='margin:6px 0;'><summary style='cursor:pointer; color:#0366d6;'>Show 1 more videos å±•å¼€æ›´å¤šè§†é¢‘</summary><div class="video-grid"><video src="../../../tests/ops/data/video2.mp4" controls width="320" style="margin:4px;"></video></div></details></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> 2 videos</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video2.mp4 +1 more:</div><div class="video-grid"><video src="../../../tests/ops/data/video2.mp4" controls width="320" style="margin:4px;"></video></div><details style='margin:6px 0;'><summary style='cursor:pointer; color:#0366d6;'>Show 1 more videos å±•å¼€æ›´å¤šè§†é¢‘</summary><div class="video-grid"><video src="../../../tests/ops/data/video3.mp4" controls width="320" style="margin:4px;"></video></div></details></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> 2 videos</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video1.mp4 +1 more:</div><div class="video-grid"><video src="../../../tests/ops/data/video1.mp4" controls width="320" style="margin:4px;"></video></div><details style='margin:6px 0;'><summary style='cursor:pointer; color:#0366d6;'>Show 1 more videos å±•å¼€æ›´å¤šè§†é¢‘</summary><div class="video-grid"><video src="../../../tests/ops/data/video3.mp4" controls width="320" style="margin:4px;"></video></div></details></div></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> 2 videos</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video1.mp4 +1 more:</div><div class="video-grid"><video src="../../../tests/ops/data/video1.mp4" controls width="320" style="margin:4px;"></video></div><details style='margin:6px 0;'><summary style='cursor:pointer; color:#0366d6;'>Show 1 more videos å±•å¼€æ›´å¤šè§†é¢‘</summary><div class="video-grid"><video src="../../../tests/ops/data/video2.mp4" controls width="320" style="margin:4px;"></video></div></details></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> 2 videos</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video2.mp4 +1 more:</div><div class="video-grid"><video src="../../../tests/ops/data/video2.mp4" controls width="320" style="margin:4px;"></video></div><details style='margin:6px 0;'><summary style='cursor:pointer; color:#0366d6;'>Show 1 more videos å±•å¼€æ›´å¤šè§†é¢‘</summary><div class="video-grid"><video src="../../../tests/ops/data/video3.mp4" controls width="320" style="margin:4px;"></video></div></details></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> 2 videos</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video1.mp4 +1 more:</div><div class="video-grid"><video src="../../../tests/ops/data/video1.mp4" controls width="320" style="margin:4px;"></video></div><details style='margin:6px 0;'><summary style='cursor:pointer; color:#0366d6;'>Show 1 more videos å±•å¼€æ›´å¤šè§†é¢‘</summary><div class="video-grid"><video src="../../../tests/ops/data/video3.mp4" controls width="320" style="margin:4px;"></video></div></details></div></div>

#### âœ¨ explanation è§£é‡Š
The operator filters samples to keep those with at least one video having an aspect ratio between 3/4 and 16/9. All samples in the input list are kept because each contains at least one video meeting the aspect ratio condition.
ç®—å­è¿‡æ»¤æ ·æœ¬ï¼Œä¿ç•™è‡³å°‘æœ‰ä¸€ä¸ªè§†é¢‘çš„å®½é«˜æ¯”åœ¨3/4åˆ°16/9ä¹‹é—´çš„æ ·æœ¬ã€‚è¾“å…¥åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ ·æœ¬éƒ½è¢«ä¿ç•™ï¼Œå› ä¸ºæ¯ä¸ªæ ·æœ¬éƒ½åŒ…å«è‡³å°‘ä¸€ä¸ªæ»¡è¶³å®½é«˜æ¯”æ¡ä»¶çš„è§†é¢‘ã€‚

### test_all
```python
VideoAspectRatioFilter(min_ratio='3/4', max_ratio='16/9', any_or_all='all')
```

#### ğŸ“¥ input data è¾“å…¥æ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> 2 videos</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video1.mp4 +1 more:</div><div class="video-grid"><video src="../../../tests/ops/data/video1.mp4" controls width="320" style="margin:4px;"></video></div><details style='margin:6px 0;'><summary style='cursor:pointer; color:#0366d6;'>Show 1 more videos å±•å¼€æ›´å¤šè§†é¢‘</summary><div class="video-grid"><video src="../../../tests/ops/data/video2.mp4" controls width="320" style="margin:4px;"></video></div></details></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 2:</strong> 2 videos</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video2.mp4 +1 more:</div><div class="video-grid"><video src="../../../tests/ops/data/video2.mp4" controls width="320" style="margin:4px;"></video></div><details style='margin:6px 0;'><summary style='cursor:pointer; color:#0366d6;'>Show 1 more videos å±•å¼€æ›´å¤šè§†é¢‘</summary><div class="video-grid"><video src="../../../tests/ops/data/video3.mp4" controls width="320" style="margin:4px;"></video></div></details></div></div><div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 3:</strong> 2 videos</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video1.mp4 +1 more:</div><div class="video-grid"><video src="../../../tests/ops/data/video1.mp4" controls width="320" style="margin:4px;"></video></div><details style='margin:6px 0;'><summary style='cursor:pointer; color:#0366d6;'>Show 1 more videos å±•å¼€æ›´å¤šè§†é¢‘</summary><div class="video-grid"><video src="../../../tests/ops/data/video3.mp4" controls width="320" style="margin:4px;"></video></div></details></div></div>

#### ğŸ“¤ output data è¾“å‡ºæ•°æ®
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> 2 videos</div><div class="media-section" style="margin-bottom:8px;"><div class="media-label" style="font-size:0.85em; color:#666; margin-bottom:4px; font-weight:500;">video1.mp4 +1 more:</div><div class="video-grid"><video src="../../../tests/ops/data/video1.mp4" controls width="320" style="margin:4px;"></video></div><details style='margin:6px 0;'><summary style='cursor:pointer; color:#0366d6;'>Show 1 more videos å±•å¼€æ›´å¤šè§†é¢‘</summary><div class="video-grid"><video src="../../../tests/ops/data/video2.mp4" controls width="320" style="margin:4px;"></video></div></details></div></div>

#### âœ¨ explanation è§£é‡Š
The operator filters samples to only keep those where all videos have an aspect ratio between 3/4 and 16/9. Only the first sample is kept, as it is the only one where both videos meet the aspect ratio condition; other samples are removed because they contain a video that does not meet the criteria.
ç®—å­è¿‡æ»¤æ ·æœ¬ï¼Œåªä¿ç•™æ‰€æœ‰è§†é¢‘çš„å®½é«˜æ¯”éƒ½åœ¨3/4åˆ°16/9ä¹‹é—´çš„æ ·æœ¬ã€‚åªæœ‰ç¬¬ä¸€ä¸ªæ ·æœ¬è¢«ä¿ç•™ï¼Œå› ä¸ºè¿™æ˜¯å”¯ä¸€ä¸€ä¸ªä¸¤ä¸ªè§†é¢‘éƒ½æ»¡è¶³å®½é«˜æ¯”æ¡ä»¶çš„æ ·æœ¬ï¼›å…¶ä»–æ ·æœ¬è¢«ç§»é™¤ï¼Œå› ä¸ºå®ƒä»¬åŒ…å«ä¸æ»¡è¶³æ¡ä»¶çš„è§†é¢‘ã€‚


## ğŸ”— related links ç›¸å…³é“¾æ¥
- [source code æºä»£ç ](../../../data_juicer/ops/filter/video_aspect_ratio_filter.py)
- [unit test å•å…ƒæµ‹è¯•](../../../tests/ops/filter/test_video_aspect_ratio_filter.py)
- [Return operator list è¿”å›ç®—å­åˆ—è¡¨](../../Operators.md)