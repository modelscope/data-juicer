<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../../genindex.html"><link rel="search" title="Search" href="../../../search.html">

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>nested_aggregator - Data Juicer</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sidebar-menu.css?v=aecff795" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    


    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">Data Juicer</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  <span class="sidebar-brand-text">Data Juicer</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/DJ-Cookbook.html">DJ-Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/Installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/QuickStart.html">Quick Start</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Operators.html">Operator Schemas ç®—å­æè¦</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../RecipeGallery.html">Data Recipe Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DatasetCfg.html">Dataset Configuration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../BadDataExhibition.html">â€œBadâ€ Data Exhibition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DJ_SORA.html">DJ-SORA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DJ_agent.html">DataJuicer-Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DJ_service.html">DJ_service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DeveloperGuide.html">How-to Guide for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Distributed.html">Distributed Data Processing in Data-Juicer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Sandbox.html">Sandbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../awesome_llm_data.html">Awesome Data-Model Co-Development of MLLMs </a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">demos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../demos/README.html">Demos</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/distributed_deduplication/README.html">Distributed Fuzzy Deduplication Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/evaluator/README.html">Auto Evaluation Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/evaluator/gpt_eval/README.html">GPT EVAL: Evaluate your model with OpenAI API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/evaluator/recorder/README.html">Evaluation Results Recorder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/fmt_conversion/README.html">Format Conversion Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/fmt_conversion/multimodal/README.html">Multimodal Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/fmt_conversion/post_tuning_dialog/README.html">Post Tuning Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/hpo/README.html">Hyper-parameter Optimization for Data Recipe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/humanops/README.html">Label Studio Service Utility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/mm_eval/inception_metrics/README.html">Metrics for video generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/mm_eval/vbench_metrics/README.html">VBench metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/postprocess/README.html">Postprocess tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/preprocess/README.html">Preprocess Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/quality_classifier/README.html">Data Scoring</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">thirdparty</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../thirdparty/LLM_ecosystems/README.html">LLM Ecosystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../thirdparty/models/README.html">Third-party Model Library</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api.html">API Reference</a><input aria-label="Toggle navigation of API Reference" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/data_juicer.core.html">data_juicer.core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/data_juicer.ops.html">data_juicer.ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/data_juicer.ops.filter.html">data_juicer.ops.filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/data_juicer.ops.mapper.html">data_juicer.ops.mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/data_juicer.ops.deduplicator.html">data_juicer.ops.deduplicator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/data_juicer.ops.selector.html">data_juicer.ops.selector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/data_juicer.ops.common.html">data_juicer.ops.common</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/data_juicer.analysis.html">data_juicer.analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/data_juicer.config.html">data_juicer.config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/data_juicer.format.html">data_juicer.format</a></li>
</ul>
</li>
</ul>

</div></div><div class="sidebar-bottom-menu">
  <div class="current-info">
    <span class="current-lang">en</span>|<span class="current-version">main</span>
  </div>
  <div class="dropdown-panel">
    
    <div class="section">
      <dt>Language</dt>
      <dd>
        
        <a href="../../../../../en/main/docs/operators/aggregator/nested_aggregator.html"
          class="active" >
          English
        </a>
        
        <a href="../../../../../zh_CN/main/docs/operators/aggregator/nested_aggregator.html"
          >
          ç®€ä½“ä¸­æ–‡
        </a>
        
      </dd>
    </div>
    

    
    <div class="section version">
      <dt>Version</dt>
      <dd>
        
        <a href="../../../../main/docs/operators/aggregator/nested_aggregator.html" class="active" >
          main
        </a>
        
        <a href="../../../../v1.4.3/docs/operators/aggregator/nested_aggregator.html" >
          v1.4.3
        </a>
        
        <a href="../../../../v1.4.2/docs/operators/aggregator/nested_aggregator.html" >
          v1.4.2
        </a>
        
        <a href="../../../../v1.4.1/docs/operators/aggregator/nested_aggregator.html" >
          v1.4.1
        </a>
        
        <a href="../../../../v1.4.0/docs/operators/aggregator/nested_aggregator.html" >
          v1.4.0
        </a>
        
      </dd>
    </div>
    
  </div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../../_sources/docs/operators/aggregator/nested_aggregator.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="nested-aggregator">
<h1>nested_aggregator<a class="headerlink" href="#nested-aggregator" title="Link to this heading">Â¶</a></h1>
<p>Aggregates nested content from multiple samples into a single summary.</p>
<p>This operator uses a recursive summarization approach to aggregate content from multiple samples. It processes the input text, which is split into sub-documents, and generates a summary that maintains the average length of the original documents. The aggregation is performed using an API model, guided by system prompts and templates. The operator supports retrying the API call in case of errors and allows for customization of the summarization process through various parameters. The default system prompt and templates are provided in Chinese, but they can be customized. The operator uses a Hugging Face tokenizer to handle tokenization.</p>
<p>èšåˆæ¥è‡ªå¤šä¸ªæ ·æœ¬çš„åµŒå¥—å†…å®¹ï¼Œç”Ÿæˆå•ä¸€æ‘˜è¦ã€‚</p>
<p>è¯¥ç®—å­ä½¿ç”¨é€’å½’æ±‡æ€»æ–¹æ³•æ¥èšåˆæ¥è‡ªå¤šä¸ªæ ·æœ¬çš„å†…å®¹ã€‚å®ƒå¤„ç†è¢«åˆ†å‰²æˆå­æ–‡æ¡£çš„è¾“å…¥æ–‡æœ¬ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªä¿æŒåŸå§‹æ–‡æ¡£å¹³å‡é•¿åº¦çš„æ‘˜è¦ã€‚èšåˆè¿‡ç¨‹ä½¿ç”¨ API æ¨¡å‹è¿›è¡Œï¼Œç”±ç³»ç»Ÿæç¤ºå’Œæ¨¡æ¿æŒ‡å¯¼ã€‚è¯¥ç®—å­æ”¯æŒåœ¨å‡ºé”™æ—¶é‡è¯• API è°ƒç”¨ï¼Œå¹¶å…è®¸é€šè¿‡å„ç§å‚æ•°è‡ªå®šä¹‰æ±‡æ€»è¿‡ç¨‹ã€‚é»˜è®¤çš„ç³»ç»Ÿæç¤ºå’Œæ¨¡æ¿ä»¥ä¸­æ–‡æä¾›ï¼Œä½†å¯ä»¥è‡ªå®šä¹‰ã€‚è¯¥ç®—å­ä½¿ç”¨ Hugging Face åˆ†è¯å™¨æ¥å¤„ç†åˆ†è¯ã€‚</p>
<p>Type ç®—å­ç±»å‹: <strong>aggregator</strong></p>
<p>Tags æ ‡ç­¾: cpu, api, text</p>
<section id="parameter-configuration">
<h2>ğŸ”§ Parameter Configuration å‚æ•°é…ç½®<a class="headerlink" href="#parameter-configuration" title="Link to this heading">Â¶</a></h2>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>name å‚æ•°å</p></th>
<th class="head"><p>type ç±»å‹</p></th>
<th class="head"><p>default é»˜è®¤å€¼</p></th>
<th class="head"><p>desc è¯´æ˜</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">api_model</span></code></p></td>
<td><p>&lt;class â€˜strâ€™&gt;</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'gpt-4o'</span></code></p></td>
<td><p>API model name.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">input_key</span></code></p></td>
<td><p>&lt;class â€˜strâ€™&gt;</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'event_description'</span></code></p></td>
<td><p>The input key in the meta field of the samples. It is â€œevent_descriptionâ€ in default.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">output_key</span></code></p></td>
<td><p>&lt;class â€˜strâ€™&gt;</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>The output key in the aggregation field in the samples. It is same as the input_key in default.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">max_token_num</span></code></p></td>
<td><p>typing.Optional[typing.Annotated[int, Gt(gt=0)]]</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>The max token num of the total tokens of the sub documents. Without limitation if it is None.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">api_endpoint</span></code></p></td>
<td><p>typing.Optional[str]</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>URL endpoint for the API.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">response_path</span></code></p></td>
<td><p>typing.Optional[str]</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Path to extract content from the API response. Defaults to â€˜choices.0.message.contentâ€™.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">system_prompt</span></code></p></td>
<td><p>typing.Optional[str]</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>The system prompt.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sub_doc_template</span></code></p></td>
<td><p>typing.Optional[str]</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>The template for input text in each sample.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">input_template</span></code></p></td>
<td><p>typing.Optional[str]</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>The input template.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">try_num</span></code></p></td>
<td><p>typing.Annotated[int, Gt(gt=0)]</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">3</span></code></p></td>
<td><p>The number of retry attempts when there is an API call error or output parsing error.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">model_params</span></code></p></td>
<td><p>typing.Dict</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">{}</span></code></p></td>
<td><p>Parameters for initializing the API model.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sampling_params</span></code></p></td>
<td><p>typing.Dict</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">{}</span></code></p></td>
<td><p>Extra parameters passed to the API call. e.g {â€˜temperatureâ€™: 0.9, â€˜top_pâ€™: 0.95}</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">kwargs</span></code></p></td>
<td><p></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">''</span></code></p></td>
<td><p>Extra keyword arguments.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="effect-demonstration">
<h2>ğŸ“Š Effect demonstration æ•ˆæœæ¼”ç¤º<a class="headerlink" href="#effect-demonstration" title="Link to this heading">Â¶</a></h2>
<section id="test-default-aggregator">
<h3>test_default_aggregator<a class="headerlink" href="#test-default-aggregator" title="Link to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NestedAggregator</span><span class="p">(</span><span class="n">api_model</span><span class="o">=</span><span class="s1">&#39;qwen2.5-72b-instruct&#39;</span><span class="p">)</span>
</pre></div>
</div>
<section id="input-data">
<h4>ğŸ“¥ input data è¾“å…¥æ•°æ®<a class="headerlink" href="#input-data" title="Link to this heading">Â¶</a></h4>
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> empty</div><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__meta__</th></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´å‰ï¼Œæç›¸å¤·åäº”å²æˆ˜èƒœè¥¿åŸŸå¤©é­”æˆä¸ºå¤©ä¸‹ç¬¬ä¸€é«˜æ‰‹ï¼Œåä¸ƒå²å»ºç«‹å››é¡¾é—¨ï¼ŒäºŒåå²é—®é¼æ­¦æ—ç›Ÿä¸»ï¼Œæˆä¸ºä¼ å¥‡äººç‰©ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>æœ‰äººè§†æç›¸å¤·ä¸ºä¸­åŸæ­¦æ—çš„å¸Œæœ›ï¼Œä½†ä¹Ÿæœ‰äººä»¥æˆ˜èƒœä»–ä¸ºç›®æ ‡ï¼ŒåŒ…æ‹¬é­”æ•™é‡‘é¸³ç›Ÿç›Ÿä¸»ç¬›é£å£°ã€‚ç¬›é£å£°è®¾è®¡åŠ å®³æç›¸å¤·çš„å¸ˆå…„å•å­¤åˆ€ï¼Œå¼•å¾—æç›¸å¤·ä¸ä¹‹ä¸€æˆ˜ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åœ¨ä¸œæµ·çš„ä¸€è‰˜èˆ¹ä¸Šï¼Œæç›¸å¤·ç‹¬è‡ªä¸€äººå¯¹æŠ—é‡‘é¸³ç›Ÿçš„é«˜æ‰‹ï¼Œæœ€ç»ˆå‡»è´¥äº†å¤§éƒ¨åˆ†æ•Œäººã€‚ç¬›é£å£°çªç„¶å‡ºç°ï¼Œä¸¤äººæ¿€æˆ˜ï¼Œæç›¸å¤·åœ¨æˆ˜æ–—ä¸­ä¸­æ¯’ï¼Œæœ€ç»ˆè¢«ç¬›é£å£°é‡ä¼¤ï¼Œèˆ¹åªçˆ†ç‚¸ï¼Œæç›¸å¤·æ²‰å…¥å¤§æµ·ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´åï¼Œæè²èŠ±åœ¨ä¸€ä¸ªå¯’é…¸çš„è²èŠ±æ¥¼å†…é†’æ¥ï¼Œè¡¨ç°å‡ºä¸æç›¸å¤·æˆªç„¶ä¸åŒçš„æ€§æ ¼ã€‚ä»–ä»¥ç¥åŒ»çš„èº«ä»½åœ¨å°é•‡ä¸Šè¡ŒåŒ»ï¼Œä½†ç”Ÿæ´»è´«å›°ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>å°é•‡ä¸Šçš„çš®å½±æˆæ‘Šè®²è¿°æç›¸å¤·å’Œç¬›é£å£°çš„æ•…äº‹ï¼Œå­©å­ä»¬äº‰è®ºè°èµ¢äº†ã€‚é£ç«å ‚ç®¡äº‹å¸¦ç€äººæ¥æ‰¾æè²èŠ±ï¼Œè¦æ±‚ä»–æ•‘æ²»ä¸€ä¸ªâ€œæ­»äººâ€ã€‚</td></tr></table></div></td></tr></table></div></div>
</section>
<section id="output-data">
<h4>ğŸ“¤ output data è¾“å‡ºæ•°æ®<a class="headerlink" href="#output-data" title="Link to this heading">Â¶</a></h4>
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> empty</div><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__meta__</th></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´å‰ï¼Œæç›¸å¤·åäº”å²æˆ˜èƒœè¥¿åŸŸå¤©é­”æˆä¸ºå¤©ä¸‹ç¬¬ä¸€é«˜æ‰‹ï¼Œåä¸ƒå²å»ºç«‹å››é¡¾é—¨ï¼ŒäºŒåå²é—®é¼æ­¦æ—ç›Ÿä¸»ï¼Œæˆä¸ºä¼ å¥‡äººç‰©ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>æœ‰äººè§†æç›¸å¤·ä¸ºä¸­åŸæ­¦æ—çš„å¸Œæœ›ï¼Œä½†ä¹Ÿæœ‰äººä»¥æˆ˜èƒœä»–ä¸ºç›®æ ‡ï¼ŒåŒ…æ‹¬é­”æ•™é‡‘é¸³ç›Ÿç›Ÿä¸»ç¬›é£å£°ã€‚ç¬›é£å£°è®¾è®¡åŠ å®³æç›¸å¤·çš„å¸ˆå…„å•å­¤åˆ€ï¼Œå¼•å¾—æç›¸å¤·ä¸ä¹‹ä¸€æˆ˜ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åœ¨ä¸œæµ·çš„ä¸€è‰˜èˆ¹ä¸Šï¼Œæç›¸å¤·ç‹¬è‡ªä¸€äººå¯¹æŠ—é‡‘é¸³ç›Ÿçš„é«˜æ‰‹ï¼Œæœ€ç»ˆå‡»è´¥äº†å¤§éƒ¨åˆ†æ•Œäººã€‚ç¬›é£å£°çªç„¶å‡ºç°ï¼Œä¸¤äººæ¿€æˆ˜ï¼Œæç›¸å¤·åœ¨æˆ˜æ–—ä¸­ä¸­æ¯’ï¼Œæœ€ç»ˆè¢«ç¬›é£å£°é‡ä¼¤ï¼Œèˆ¹åªçˆ†ç‚¸ï¼Œæç›¸å¤·æ²‰å…¥å¤§æµ·ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´åï¼Œæè²èŠ±åœ¨ä¸€ä¸ªå¯’é…¸çš„è²èŠ±æ¥¼å†…é†’æ¥ï¼Œè¡¨ç°å‡ºä¸æç›¸å¤·æˆªç„¶ä¸åŒçš„æ€§æ ¼ã€‚ä»–ä»¥ç¥åŒ»çš„èº«ä»½åœ¨å°é•‡ä¸Šè¡ŒåŒ»ï¼Œä½†ç”Ÿæ´»è´«å›°ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>å°é•‡ä¸Šçš„çš®å½±æˆæ‘Šè®²è¿°æç›¸å¤·å’Œç¬›é£å£°çš„æ•…äº‹ï¼Œå­©å­ä»¬äº‰è®ºè°èµ¢äº†ã€‚é£ç«å ‚ç®¡äº‹å¸¦ç€äººæ¥æ‰¾æè²èŠ±ï¼Œè¦æ±‚ä»–æ•‘æ²»ä¸€ä¸ªâ€œæ­»äººâ€ã€‚</td></tr></table></div></td></tr><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__batch_meta__</th></tr><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>æç›¸å¤·å¹´å°‘æˆåï¼Œæˆä¸ºæ­¦æ—ç›Ÿä¸»ï¼Œå´åœ¨ä¸ç¬›é£å£°çš„å†³æˆ˜ä¸­é‡ä¼¤æ²‰æµ·ã€‚åå¹´åï¼Œæè²èŠ±åœ¨å°é•‡ä¸Šä»¥ç¥åŒ»èº«ä»½è¡ŒåŒ»ï¼Œç”Ÿæ´»è´«å›°ï¼Œè€Œå…³äºæç›¸å¤·çš„ä¼ è¯´ä»åœ¨æ°‘é—´æµä¼ ã€‚</td></tr></table></div></div>
</section>
<section id="explanation">
<h4>âœ¨ explanation è§£é‡Š<a class="headerlink" href="#explanation" title="Link to this heading">Â¶</a></h4>
<p>This example demonstrates the default behavior of the NestedAggregator operator. It takes a list of event descriptions and generates a summary that captures the key points from all the input texts. The output data includes the original event descriptions and an additional summary in the batch metadata, which provides a concise overview of the story. The summary is generated using the specified API model.
è¿™ä¸ªä¾‹å­å±•ç¤ºäº†NestedAggregatorç®—å­çš„é»˜è®¤è¡Œä¸ºã€‚å®ƒæ¥æ”¶ä¸€ç³»åˆ—äº‹ä»¶æè¿°ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ€»ç»“ï¼Œæ¦‚æ‹¬æ‰€æœ‰è¾“å…¥æ–‡æœ¬çš„å…³é”®ç‚¹ã€‚è¾“å‡ºæ•°æ®åŒ…æ‹¬åŸå§‹çš„äº‹ä»¶æè¿°å’Œåœ¨æ‰¹æ¬¡å…ƒæ•°æ®ä¸­æ·»åŠ çš„ä¸€ä¸ªæ€»ç»“ï¼Œè¯¥æ€»ç»“æä¾›äº†æ•…äº‹çš„ç®€è¦æ¦‚è¿°ã€‚æ€»ç»“æ˜¯é€šè¿‡æŒ‡å®šçš„APIæ¨¡å‹ç”Ÿæˆçš„ã€‚</p>
</section>
</section>
<section id="test-max-token-num-1">
<h3>test_max_token_num_1<a class="headerlink" href="#test-max-token-num-1" title="Link to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NestedAggregator</span><span class="p">(</span><span class="n">api_model</span><span class="o">=</span><span class="s1">&#39;qwen2.5-72b-instruct&#39;</span><span class="p">,</span> <span class="n">max_token_num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<section id="id1">
<h4>ğŸ“¥ input data è¾“å…¥æ•°æ®<a class="headerlink" href="#id1" title="Link to this heading">Â¶</a></h4>
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> empty</div><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__meta__</th></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´å‰ï¼Œæç›¸å¤·åäº”å²æˆ˜èƒœè¥¿åŸŸå¤©é­”æˆä¸ºå¤©ä¸‹ç¬¬ä¸€é«˜æ‰‹ï¼Œåä¸ƒå²å»ºç«‹å››é¡¾é—¨ï¼ŒäºŒåå²é—®é¼æ­¦æ—ç›Ÿä¸»ï¼Œæˆä¸ºä¼ å¥‡äººç‰©ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>æœ‰äººè§†æç›¸å¤·ä¸ºä¸­åŸæ­¦æ—çš„å¸Œæœ›ï¼Œä½†ä¹Ÿæœ‰äººä»¥æˆ˜èƒœä»–ä¸ºç›®æ ‡ï¼ŒåŒ…æ‹¬é­”æ•™é‡‘é¸³ç›Ÿç›Ÿä¸»ç¬›é£å£°ã€‚ç¬›é£å£°è®¾è®¡åŠ å®³æç›¸å¤·çš„å¸ˆå…„å•å­¤åˆ€ï¼Œå¼•å¾—æç›¸å¤·ä¸ä¹‹ä¸€æˆ˜ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åœ¨ä¸œæµ·çš„ä¸€è‰˜èˆ¹ä¸Šï¼Œæç›¸å¤·ç‹¬è‡ªä¸€äººå¯¹æŠ—é‡‘é¸³ç›Ÿçš„é«˜æ‰‹ï¼Œæœ€ç»ˆå‡»è´¥äº†å¤§éƒ¨åˆ†æ•Œäººã€‚ç¬›é£å£°çªç„¶å‡ºç°ï¼Œä¸¤äººæ¿€æˆ˜ï¼Œæç›¸å¤·åœ¨æˆ˜æ–—ä¸­ä¸­æ¯’ï¼Œæœ€ç»ˆè¢«ç¬›é£å£°é‡ä¼¤ï¼Œèˆ¹åªçˆ†ç‚¸ï¼Œæç›¸å¤·æ²‰å…¥å¤§æµ·ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´åï¼Œæè²èŠ±åœ¨ä¸€ä¸ªå¯’é…¸çš„è²èŠ±æ¥¼å†…é†’æ¥ï¼Œè¡¨ç°å‡ºä¸æç›¸å¤·æˆªç„¶ä¸åŒçš„æ€§æ ¼ã€‚ä»–ä»¥ç¥åŒ»çš„èº«ä»½åœ¨å°é•‡ä¸Šè¡ŒåŒ»ï¼Œä½†ç”Ÿæ´»è´«å›°ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>å°é•‡ä¸Šçš„çš®å½±æˆæ‘Šè®²è¿°æç›¸å¤·å’Œç¬›é£å£°çš„æ•…äº‹ï¼Œå­©å­ä»¬äº‰è®ºè°èµ¢äº†ã€‚é£ç«å ‚ç®¡äº‹å¸¦ç€äººæ¥æ‰¾æè²èŠ±ï¼Œè¦æ±‚ä»–æ•‘æ²»ä¸€ä¸ªâ€œæ­»äººâ€ã€‚</td></tr></table></div></td></tr></table></div></div>
</section>
<section id="id2">
<h4>ğŸ“¤ output data è¾“å‡ºæ•°æ®<a class="headerlink" href="#id2" title="Link to this heading">Â¶</a></h4>
<div class="sample-card" style="border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; background:#fafafa; box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div class="sample-header" style="background:#f8f9fa; padding:4px 8px; margin-bottom:6px; border-radius:3px; font-size:0.9em; color:#666; border-left:3px solid #007acc;"><strong>Sample 1:</strong> empty</div><div class='meta' style='margin:6px 0;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__meta__</th></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´å‰ï¼Œæç›¸å¤·åäº”å²æˆ˜èƒœè¥¿åŸŸå¤©é­”æˆä¸ºå¤©ä¸‹ç¬¬ä¸€é«˜æ‰‹ï¼Œåä¸ƒå²å»ºç«‹å››é¡¾é—¨ï¼ŒäºŒåå²é—®é¼æ­¦æ—ç›Ÿä¸»ï¼Œæˆä¸ºä¼ å¥‡äººç‰©ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>æœ‰äººè§†æç›¸å¤·ä¸ºä¸­åŸæ­¦æ—çš„å¸Œæœ›ï¼Œä½†ä¹Ÿæœ‰äººä»¥æˆ˜èƒœä»–ä¸ºç›®æ ‡ï¼ŒåŒ…æ‹¬é­”æ•™é‡‘é¸³ç›Ÿç›Ÿä¸»ç¬›é£å£°ã€‚ç¬›é£å£°è®¾è®¡åŠ å®³æç›¸å¤·çš„å¸ˆå…„å•å­¤åˆ€ï¼Œå¼•å¾—æç›¸å¤·ä¸ä¹‹ä¸€æˆ˜ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åœ¨ä¸œæµ·çš„ä¸€è‰˜èˆ¹ä¸Šï¼Œæç›¸å¤·ç‹¬è‡ªä¸€äººå¯¹æŠ—é‡‘é¸³ç›Ÿçš„é«˜æ‰‹ï¼Œæœ€ç»ˆå‡»è´¥äº†å¤§éƒ¨åˆ†æ•Œäººã€‚ç¬›é£å£°çªç„¶å‡ºç°ï¼Œä¸¤äººæ¿€æˆ˜ï¼Œæç›¸å¤·åœ¨æˆ˜æ–—ä¸­ä¸­æ¯’ï¼Œæœ€ç»ˆè¢«ç¬›é£å£°é‡ä¼¤ï¼Œèˆ¹åªçˆ†ç‚¸ï¼Œæç›¸å¤·æ²‰å…¥å¤§æµ·ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>åå¹´åï¼Œæè²èŠ±åœ¨ä¸€ä¸ªå¯’é…¸çš„è²èŠ±æ¥¼å†…é†’æ¥ï¼Œè¡¨ç°å‡ºä¸æç›¸å¤·æˆªç„¶ä¸åŒçš„æ€§æ ¼ã€‚ä»–ä»¥ç¥åŒ»çš„èº«ä»½åœ¨å°é•‡ä¸Šè¡ŒåŒ»ï¼Œä½†ç”Ÿæ´»è´«å›°ã€‚</td></tr></table></div></td></tr><tr><td colspan='2' style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; border-bottom:1px solid #e3e3e3;'><div style='margin:2px 0 6px 0; padding-left:8px;'><table class='meta-table' style='border-collapse:collapse; width:100%; border:1px solid #e3e3e3;'><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:36px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>å°é•‡ä¸Šçš„çš®å½±æˆæ‘Šè®²è¿°æç›¸å¤·å’Œç¬›é£å£°çš„æ•…äº‹ï¼Œå­©å­ä»¬äº‰è®ºè°èµ¢äº†ã€‚é£ç«å ‚ç®¡äº‹å¸¦ç€äººæ¥æ‰¾æè²èŠ±ï¼Œè¦æ±‚ä»–æ•‘æ²»ä¸€ä¸ªâ€œæ­»äººâ€ã€‚</td></tr></table></div></td></tr><tr><th colspan='2' style='text-align:left; vertical-align:top; padding:6px 8px; font-weight:600; border-bottom:1px solid #e3e3e3;'>__dj__batch_meta__</th></tr><tr><td style='text-align:left; vertical-align:top; padding:4px 8px; padding-left:22px; font-weight:500; color:#444; border-bottom:1px solid #e3e3e3; white-space:nowrap;'>event_description</td><td style='text-align:left; vertical-align:top; padding:4px 6px; padding-left:4px; border-bottom:1px solid #e3e3e3;'>æç›¸å¤·åäº”å²èƒœå¤©é­”ï¼Œåä¸ƒå²åˆ›å››é¡¾é—¨ï¼ŒäºŒåå²æˆæ­¦æ—ç›Ÿä¸»ï¼Œåè¢«ç¬›é£å£°é‡ä¼¤æ²‰æµ·ï¼Œåå¹´åä»¥æè²èŠ±ä¹‹ååœ¨è²èŠ±æ¥¼è‹é†’ï¼Œè¡ŒåŒ»åº¦æ—¥ã€‚å°é•‡çš®å½±æˆè®²è¿°å…¶æ•…äº‹å¼•å‘äº‰è®®ï¼Œæè²èŠ±è¢«è¯·å»æ•‘æ²»â€œæ­»äººâ€ã€‚</td></tr></table></div></div>
</section>
<section id="id3">
<h4>âœ¨ explanation è§£é‡Š<a class="headerlink" href="#id3" title="Link to this heading">Â¶</a></h4>
<p>This example demonstrates how the NestedAggregator behaves with extreme token limitations (max_token_num=2). The restrictive token limit forces the algorithm to process documents in smaller, more granular groups through its recursive summarization approach. This results in a more detailed, fact-dense summary that captures specific events and details (like â€œfifteen years old defeating demons,â€ â€œLotus Tower,â€ â€œshadow puppet show,â€ â€œtreating the deadâ€) rather than a high-level narrative overview. The token limit affects the intermediate processing steps, leading to different summarization patterns that preserve more granular information in the final output.
è¿™ä¸ªä¾‹å­å±•ç¤ºäº†NestedAggregatoråœ¨æç«¯tokené™åˆ¶ï¼ˆmax_token_num=2ï¼‰ä¸‹çš„è¡Œä¸ºã€‚é™åˆ¶æ€§çš„tokenè¿«ä½¿ç®—æ³•é€šè¿‡å…¶é€’å½’æ±‡æ€»æ–¹æ³•ä»¥æ›´å°ã€æ›´ç»†ç²’åº¦çš„ç»„æ¥å¤„ç†æ–‡æ¡£ã€‚è¿™å¯¼è‡´ç”Ÿæˆæ›´è¯¦ç»†ã€ä¿¡æ¯å¯†é›†çš„æ‘˜è¦ï¼Œæ•è·å…·ä½“äº‹ä»¶å’Œç»†èŠ‚ï¼ˆå¦‚â€åäº”å²èƒœå¤©é­”â€ã€â€è²èŠ±æ¥¼â€ã€â€çš®å½±æˆâ€ã€â€æ•‘æ²»æ­»äººâ€ï¼‰ï¼Œè€Œä¸æ˜¯é«˜å±‚æ¬¡çš„å™è¿°æ¦‚è¿°ã€‚tokené™åˆ¶å½±å“äº†ä¸­é—´å¤„ç†æ­¥éª¤ï¼Œå¯¼è‡´ä¸åŒçš„æ±‡æ€»æ¨¡å¼ï¼Œåœ¨æœ€ç»ˆè¾“å‡ºä¸­ä¿ç•™äº†æ›´å¤šç»†ç²’åº¦ä¿¡æ¯ã€‚</p>
</section>
</section>
</section>
<section id="related-links">
<h2>ğŸ”— related links ç›¸å…³é“¾æ¥<a class="headerlink" href="#related-links" title="Link to this heading">Â¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/modelscope/data-juicer/blob/main/data_juicer/ops/aggregator/nested_aggregator.py">source code æºä»£ç </a></p></li>
<li><p><a class="reference external" href="https://github.com/modelscope/data-juicer/blob/main/tests/ops/aggregator/test_nested_aggregator.py">unit test å•å…ƒæµ‹è¯•</a></p></li>
<li><p><a class="reference internal" href="../../Operators.html"><span class="std std-doc">Return operator list è¿”å›ç®—å­åˆ—è¡¨</span></a></p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Data-Juicer Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">nested_aggregator</a><ul>
<li><a class="reference internal" href="#parameter-configuration">ğŸ”§ Parameter Configuration å‚æ•°é…ç½®</a></li>
<li><a class="reference internal" href="#effect-demonstration">ğŸ“Š Effect demonstration æ•ˆæœæ¼”ç¤º</a><ul>
<li><a class="reference internal" href="#test-default-aggregator">test_default_aggregator</a><ul>
<li><a class="reference internal" href="#input-data">ğŸ“¥ input data è¾“å…¥æ•°æ®</a></li>
<li><a class="reference internal" href="#output-data">ğŸ“¤ output data è¾“å‡ºæ•°æ®</a></li>
<li><a class="reference internal" href="#explanation">âœ¨ explanation è§£é‡Š</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-max-token-num-1">test_max_token_num_1</a><ul>
<li><a class="reference internal" href="#id1">ğŸ“¥ input data è¾“å…¥æ•°æ®</a></li>
<li><a class="reference internal" href="#id2">ğŸ“¤ output data è¾“å‡ºæ•°æ®</a></li>
<li><a class="reference internal" href="#id3">âœ¨ explanation è§£é‡Š</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#related-links">ğŸ”— related links ç›¸å…³é“¾æ¥</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div>
<script src="../../../_static/documentation_options.js?v=a68a9277"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    </body>
</html>