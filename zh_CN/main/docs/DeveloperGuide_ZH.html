<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="ç´¢å¼•" href="../genindex.html" /><link rel="search" title="æœç´¢" href="../search.html" /><link rel="next" title="Data-Juicer åˆ†å¸ƒå¼æ•°æ®å¤„ç†" href="Distributed_ZH.html" /><link rel="prev" title="APIæœåŠ¡åŒ–" href="DJ_service_ZH.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>å¼€å‘è€…æŒ‡å— - data-juicer</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/sidebar-menu.css?v=dcc41d8a" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    


    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index_ZH.html"><div class="brand">data-juicer</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index_ZH.html">
  
  
  <span class="sidebar-brand-text">data-juicer</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="æœç´¢" name="q" aria-label="æœç´¢">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">æ•™ç¨‹</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial/DJ-Cookbook_ZH.html">DJ-Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial/Installation_ZH.html">å®‰è£…</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial/QuickStart_ZH.html">å¿«é€Ÿä¸Šæ‰‹</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">å¸®åŠ©æ–‡æ¡£</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Operators.html">Operator Schemas ç®—å­æè¦</a></li>
<li class="toctree-l1"><a class="reference internal" href="RecipeGallery_ZH.html">æ•°æ®èœè°±Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="DatasetCfg_ZH.html">æ•°æ®é›†é…ç½®æŒ‡å—</a></li>
<li class="toctree-l1"><a class="reference internal" href="BadDataExhibition_ZH.html">â€œåâ€æ•°æ®å±•è§ˆ</a></li>
<li class="toctree-l1"><a class="reference internal" href="DJ_SORA_ZH.html">DJ-SORA</a></li>
<li class="toctree-l1"><a class="reference internal" href="DJ_service_ZH.html">APIæœåŠ¡åŒ–</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">å¼€å‘è€…æŒ‡å—</a></li>
<li class="toctree-l1"><a class="reference internal" href="Distributed_ZH.html">Data-Juicer åˆ†å¸ƒå¼æ•°æ®å¤„ç†</a></li>
<li class="toctree-l1"><a class="reference internal" href="Sandbox_ZH.html">æ²™ç›’å®éªŒå®¤</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome_llm_data.html">Awesome Data-Model Co-Development of MLLMs </a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">demos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../demos/README_ZH.html">æ¼”ç¤º</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/auto_evaluation_helm/README_ZH.html">è‡ªåŠ¨åŒ–è¯„æµ‹ï¼šHELM è¯„æµ‹åŠå¯è§†åŒ–</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/role_playing_system_prompt/README_ZH.html">ä¸ºLLMæ„é€ è§’è‰²æ‰®æ¼”çš„system prompt</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">å·¥å…·</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/distributed_deduplication/README_ZH.html">åˆ†å¸ƒå¼æ¨¡ç³Šå»é‡å·¥å…·</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/evaluator/README_ZH.html">Auto Evaluation Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/evaluator/gpt_eval/README_ZH.html">GPT EVALï¼šä½¿ç”¨ OpenAI API è¯„æµ‹å¤§æ¨¡å‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/evaluator/recorder/README_ZH.html">Evaluation Results Recorder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/fmt_conversion/README_ZH.html">æ ¼å¼è½¬æ¢å·¥å…·</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/fmt_conversion/multimodal/README_ZH.html">å¤šæ¨¡æ€å·¥å…·</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/fmt_conversion/post_tuning_dialog/README_ZH.html">åå¾®è°ƒå·¥å…·</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/hpo/README_ZH.html">æ•°æ®èœè°±çš„è‡ªåŠ¨åŒ–è¶…å‚ä¼˜åŒ–</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/humanops/README.html">Label Studio Service Utility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/mm_eval/inception_metrics/README_ZH.html">è§†é¢‘ç”Ÿæˆæµ‹è¯„å·¥å…·</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/postprocess/README_ZH.html">Postprocess tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/preprocess/README_ZH.html">é¢„å¤„ç†å·¥å…·</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/quality_classifier/README_ZH.html">ç»™æ•°æ®æ‰“åˆ†</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ç¬¬ä¸‰æ–¹</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../thirdparty/LLM_ecosystems/README_ZH.html">å¤§è¯­è¨€æ¨¡å‹ç”Ÿæ€</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thirdparty/models/README_ZH.html">ç¬¬ä¸‰æ–¹æ¨¡å‹åº“</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../data_juicer.core.html">data_juicer.core package</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of data_juicer.core package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../data_juicer.core.data.html">data_juicer.core.data package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_juicer.core.executor.html">data_juicer.core.executor package</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../data_juicer.ops.html">data_juicer.ops package</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of data_juicer.ops package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../data_juicer.ops.aggregator.html">data_juicer.ops.aggregator package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_juicer.ops.common.html">data_juicer.ops.common package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_juicer.ops.deduplicator.html">data_juicer.ops.deduplicator package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_juicer.ops.filter.html">data_juicer.ops.filter package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_juicer.ops.grouper.html">data_juicer.ops.grouper package</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../data_juicer.ops.mapper.html">data_juicer.ops.mapper package</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of data_juicer.ops.mapper package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../data_juicer.ops.mapper.annotation.html">data_juicer.ops.mapper.annotation package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../data_juicer.ops.selector.html">data_juicer.ops.selector package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../data_juicer.ops.filter.html">data_juicer.ops.filter package</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../data_juicer.ops.mapper.html">data_juicer.ops.mapper package</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of data_juicer.ops.mapper package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../data_juicer.ops.mapper.annotation.html">data_juicer.ops.mapper.annotation package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../data_juicer.ops.deduplicator.html">data_juicer.ops.deduplicator package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_juicer.ops.selector.html">data_juicer.ops.selector package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_juicer.ops.common.html">data_juicer.ops.common package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_juicer.analysis.html">data_juicer.analysis package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_juicer.config.html">data_juicer.config package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_juicer.format.html">data_juicer.format package</a></li>
</ul>
</li>
</ul>

</div></div><div class="sidebar-bottom-menu">
    <div class="current-info">
        <span class="current-lang">zh-CN</span>|<span class="current-version">main</span>
    </div>
    <div class="dropdown-panel">
        
        <div class="section">
            <dt>Language</dt>
            <dd>
                
                <a href="../../../en/main/docs/DeveloperGuide.html"
                    >
                    English
                </a>
                
                <a href="../../../zh_CN/main/docs/DeveloperGuide_ZH.html"
                    >
                    ç®€ä½“ä¸­æ–‡
                </a>
                
            </dd>
        </div>
        

        
        <div class="section">
            <dt>Version</dt>
            <dd>
                    <a href="DeveloperGuide_ZH.html">main</a>
            </dd>
        </div>
        
    </div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/docs/DeveloperGuide_ZH.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="id1">
<h1>å¼€å‘è€…æŒ‡å—<a class="headerlink" href="#id1" title="Link to this heading">Â¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="#id1">å¼€å‘è€…æŒ‡å—</a></p>
<ul>
<li><p><a class="reference internal" href="#id2">1. ç¼–ç è§„èŒƒ</a></p></li>
<li><p><a class="reference internal" href="#id3">2. æ„å»ºè‡ªå·±çš„ç®—å­</a></p>
<ul>
<li><p><a class="reference internal" href="#id4">2.1 æ„å»ºç¤ºä¾‹</a></p>
<ul>
<li><p><a class="reference internal" href="#alpha">2.1.2 æä¾›ç®—å­åŸºæœ¬åŠŸèƒ½ï¼ˆalphaç‰ˆæœ¬ï¼‰</a></p></li>
<li><p><a class="reference internal" href="#beta">2.1.2 ä½¿ç®—å­æ›´å¯ç”¨ï¼ˆbetaç‰ˆæœ¬ï¼‰</a></p></li>
<li><p><a class="reference internal" href="#stable">2.1.3 ä½¿ç®—å­æ›´å¿«æ›´å®Œå¤‡ï¼ˆstableç‰ˆæœ¬ï¼‰</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#id5">3. æ„å»ºè‡ªå·±çš„æ•°æ®èœè°±å’Œé…ç½®</a></p>
<ul>
<li><p><a class="reference internal" href="#id6">3.1 ä¸°å¯Œçš„é…ç½®æºå’Œç±»å‹æç¤º</a></p></li>
<li><p><a class="reference internal" href="#id7">3.2 å±‚æ¬¡åŒ–çš„é…ç½®å’Œå¸®åŠ©</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id8">4. ä¾èµ–ç®¡ç†</a></p>
<ul>
<li><p><a class="reference internal" href="#uv">4.1 å®‰è£… uv</a></p></li>
<li><p><a class="reference internal" href="#id9">4.2 è™šæ‹Ÿç¯å¢ƒç®¡ç†</a></p></li>
<li><p><a class="reference internal" href="#id10">4.3 æ·»åŠ æ–°ä¾èµ–</a></p></li>
<li><p><a class="reference internal" href="#id11">4.4 å¼€å‘ç¯å¢ƒè®¾ç½®</a></p></li>
<li><p><a class="reference internal" href="#id12">4.5 å»¶è¿ŸåŠ è½½</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id13">5. æ–‡æ¡£è§„èŒƒ</a></p></li>
</ul>
</li>
</ul>
<section id="id2">
<h2>1. ç¼–ç è§„èŒƒ<a class="headerlink" href="#id2" title="Link to this heading">Â¶</a></h2>
<p>æˆ‘ä»¬å°†ç¼–ç è§„èŒƒå®šä¹‰åœ¨ <code class="docutils literal notranslate"><span class="pre">.pre-commit-config.yaml</span></code> ä¸­ã€‚åœ¨å‘ä»“åº“è´¡çŒ®ä»£ç ä¹‹å‰ï¼Œè¯·ä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">pre-commit</span></code> å·¥å…·å¯¹ä»£ç è¿›è¡Œè‡ªåŠ¨è§„èŒƒåŒ–ã€‚</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># ===========install pre-commit tool===========</span>
pip<span class="w"> </span>install<span class="w"> </span>pre-commit

<span class="nb">cd</span><span class="w"> </span>&lt;path_to_data_juicer&gt;
<span class="c1"># install pre-commit script for data_juicer</span>
pre-commit<span class="w"> </span>install


<span class="c1"># ===========check all files===========</span>
git<span class="w"> </span>add<span class="w"> </span>.
pre-commit<span class="w"> </span>run<span class="w"> </span>--all-files

<span class="c1"># commit after all checking are passed</span>
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;&lt;your_commit_message&gt;&quot;</span>
</pre></div>
</div>
<p><strong>æ³¨æ„</strong>ï¼šæˆ‘ä»¬åœ¨github workflowé…ç½®äº†pre-commitçš„æ£€æŸ¥ã€‚å¦‚æœæ‚¨çš„PRä¸­è¯¥æ£€æŸ¥æ²¡é€šè¿‡ï¼Œè¯·åœ¨æœ¬åœ°â‘ ç¡®ä¿pre-commit çš„ç›¸å…³ä¾èµ–ä¸é¡¹ç›®é…ç½®ä¸€è‡´ï¼ˆå¯é€šè¿‡<code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">clean</span></code>å’Œ<code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">install</span></code>å®Œæˆï¼‰ï¼›â‘¡pushå‰æ‰§è¡Œäº†<code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">run</span> <span class="pre">--all-files</span></code>.</p>
</section>
<section id="id3">
<h2>2. æ„å»ºè‡ªå·±çš„ç®—å­<a class="headerlink" href="#id3" title="Link to this heading">Â¶</a></h2>
<ul class="simple">
<li><p>Data-Juicer æ”¯æŒæ¯ä¸ªäººçµæ´»ã€ä¾¿æ·å®šä¹‰è‡ªå·±çš„ç®—å­ã€‚</p></li>
<li><p>åœ¨å®ç°æ–°çš„ç®—å­ä¹‹å‰ï¼Œè¯·å‚è€ƒå·²æœ‰ <a class="reference internal" href="Operators.html"><span class="std std-doc">ç®—å­æ± </span></a> ä»¥é¿å…ä¸å¿…è¦çš„é‡å¤ã€‚</p></li>
<li><p>æ ¹æ®å®ç°å®Œæ•´æ€§ï¼Œç®—å­ä¼šè¢«åˆ†ç±»ä¸º3ç±»ï¼š</p>
<ul>
<li><p><img alt="alpha" src="https://img.shields.io/badge/alpha-red?style=plastic" /> ç‰ˆæœ¬ï¼šä»…å®ç°äº†æœ€åŸºæœ¬çš„ç®—å­èƒ½åŠ›</p></li>
<li><p><img alt="beta" src="https://img.shields.io/badge/beta-yellow?style=plastic" /> ç‰ˆæœ¬ï¼šåœ¨ alpha ç‰ˆæœ¬åŸºç¡€ä¸Šä¸ºç®—å­æ·»åŠ äº†å•å…ƒæµ‹è¯•ï¼Œè¡¥å……åŸºç¡€æ–‡æ¡£æè¿°</p></li>
<li><p><img alt="stable" src="https://img.shields.io/badge/stable-green?style=plastic" /> ç‰ˆæœ¬ï¼šåœ¨ beta ç‰ˆæœ¬åŸºç¡€ä¸Šè¿›è¡Œäº†å„é¡¹ç®—å­ä¼˜åŒ–ï¼ˆå¦‚æ¨¡å‹ç®¡ç†ã€æ‰¹å¤„ç†ã€ç®—å­èåˆç­‰ï¼‰</p></li>
</ul>
</li>
<li><p>ğŸ“£ğŸ“£ğŸ“£ ç¤¾åŒºè´¡çŒ®è€…å¯åœ¨alphaçŠ¶æ€åå°±æç›¸åº”ç®—å­PRã€‚æ­¤åè¯¥è´¡çŒ®è€…å¯ä»¥ä¸Data-Juicerå›¢é˜Ÿä¸€èµ·åœ¨åç»­PRä¸­ï¼Œå°†å…¶æ¸è¿›å®Œå–„åˆ°betaå’Œstableç‰ˆæœ¬ã€‚æˆ‘ä»¬éå¸¸æ¬¢è¿å…±å»ºï¼Œå¹¶ä¼šé«˜äº®<a class="reference external" href="https://github.com/modelscope/data-juicer?tab=readme-ov-file#acknowledgement">è‡´è°¢</a>ï¼</p></li>
</ul>
<section id="id4">
<h3>2.1 æ„å»ºç¤ºä¾‹<a class="headerlink" href="#id4" title="Link to this heading">Â¶</a></h3>
<p>ä¸‹é¢ä»¥ &quot;TextLengthFilter&quot; çš„ç®—å­ï¼ˆè¿‡æ»¤ä»…åŒ…å«é¢„æœŸæ–‡æœ¬é•¿åº¦çš„æ ·æœ¬è¯­æ–™ï¼‰ä¸ºä¾‹ï¼Œå±•ç¤ºç›¸åº”å¼€å‘æ„å»ºè¿‡ç¨‹ã€‚</p>
<section id="alpha">
<h4>2.1.2 æä¾›ç®—å­åŸºæœ¬åŠŸèƒ½ï¼ˆalphaç‰ˆæœ¬ï¼‰<a class="headerlink" href="#alpha" title="Link to this heading">Â¶</a></h4>
<ol class="arabic simple">
<li><p>(<img alt="alpha" src="https://img.shields.io/badge/alpha-red?style=plastic" />ï¼Œå¯é€‰) å¦‚æœè¯¥ç®—å­å®šä¹‰äº†æŸä¸ªç»Ÿè®¡å˜é‡ï¼Œé‚£ä¹ˆè¯·åœ¨ <code class="docutils literal notranslate"><span class="pre">data_juicer/utils/constant.py</span></code> æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„<code class="docutils literal notranslate"><span class="pre">StatsKeys</span></code>å±æ€§æ¥ç»Ÿä¸€ä¿å­˜ç®¡ç†ã€‚</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">StatsKeys</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="o">...</span>              <span class="c1"># other keys</span>
    <span class="n">text_len</span> <span class="o">=</span> <span class="s1">&#39;text_len&#39;</span>
</pre></div>
</div>
<ol class="arabic" start="2">
<li><p>(<img alt="alpha" src="https://img.shields.io/badge/alpha-red?style=plastic" />) åœ¨ <code class="docutils literal notranslate"><span class="pre">data_juicer/ops/filter/</span></code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç®—å­æ–‡ä»¶ <code class="docutils literal notranslate"><span class="pre">text_length_filter.py</span></code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<ul class="simple">
<li><p>å› ä¸ºå®ƒæ˜¯ä¸€ä¸ª Filter ç®—å­ï¼Œæ‰€ä»¥éœ€è¦ç»§æ‰¿ <code class="docutils literal notranslate"><span class="pre">base_op.py</span></code> ä¸­çš„ <code class="docutils literal notranslate"><span class="pre">Filter</span></code> åŸºç±»ï¼Œå¹¶ç”¨ <code class="docutils literal notranslate"><span class="pre">&#64;OPERATORS.register_module(xx_op)</span></code> è£…é¥°å™¨æ ‡è®°ï¼Œä»¥å®ç°è‡ªåŠ¨æ³¨å†Œã€‚</p></li>
<li><p>ä¸ºäº†æ–¹ä¾¿å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰å•æ ·æœ¬å¤„ç†çš„æ–¹å¼å®ç°ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³• <code class="docutils literal notranslate"><span class="pre">compute_stats_single</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">process_single</span></code>ï¼Œå®ƒä»¬çš„è¾“å…¥è¾“å‡ºå‡ä¸ºå•ä¸ªæ ·æœ¬çš„å­—å…¸ç»“æ„ã€‚</p></li>
<li><p>ã€è¿›é˜¶ã€‘å¦‚æœä½ æ¯”è¾ƒç†Ÿæ‚‰ Data-Juicer ä¸­çš„batchåŒ–å¤„ç†ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡è¦†å†™ <code class="docutils literal notranslate"><span class="pre">compute_stats_batched</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">process_batched</span></code> æ–¹æ³•ç›´æ¥å®ç°å®ƒä»¬çš„batchåŒ–ç‰ˆæœ¬ï¼Œå®ƒçš„å¤„ç†ä¼šæ¯”å•æ ·æœ¬ç‰ˆæœ¬ç¨å¿«ä¸€äº›ã€‚å®ƒä»¬çš„è¾“å…¥å’Œè¾“å‡ºåˆ™æ˜¯æŒ‰åˆ—å­˜å‚¨çš„å­—å…¸ç»“æ„ï¼Œå…¶ä¸­åŒ…æ‹¬å¤šä¸ªæ ·æœ¬ ï¼ˆè¯¦è§ä¸‹æ–¹ 2.1.3 å°èŠ‚ï¼‰ã€‚</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">jsonargparse.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">PositiveInt</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">data_juicer.utils.constant</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fields</span><span class="p">,</span> <span class="n">StatsKeys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">..base_op</span><span class="w"> </span><span class="kn">import</span> <span class="n">OPERATORS</span><span class="p">,</span> <span class="n">Filter</span>


<span class="nd">@OPERATORS</span><span class="o">.</span><span class="n">register_module</span><span class="p">(</span><span class="s1">&#39;text_length_filter&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TextLengthFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter to keep samples with total text length within a specific</span>
<span class="sd">    range.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">min_len</span><span class="p">:</span> <span class="n">PositiveInt</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                <span class="n">max_len</span><span class="p">:</span> <span class="n">PositiveInt</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization method.</span>

<span class="sd">        :param min_len: The min text length in the filtering. samples</span>
<span class="sd">            will be filtered if their text length is below this</span>
<span class="sd">            parameter.</span>
<span class="sd">        :param max_len: The max text length in the filtering. samples</span>
<span class="sd">            will be filtered if their text length exceeds this</span>
<span class="sd">            parameter.</span>
<span class="sd">        :param args: extra args</span>
<span class="sd">        :param kwargs: extra args</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_len</span> <span class="o">=</span> <span class="n">min_len</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span> <span class="o">=</span> <span class="n">max_len</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_stats_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
        <span class="c1"># check if it&#39;s computed already</span>
        <span class="k">if</span> <span class="n">StatsKeys</span><span class="o">.</span><span class="n">text_len</span> <span class="ow">in</span> <span class="n">sample</span><span class="p">[</span><span class="n">Fields</span><span class="o">.</span><span class="n">stats</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">sample</span>

        <span class="n">sample</span><span class="p">[</span><span class="n">Fields</span><span class="o">.</span><span class="n">stats</span><span class="p">][</span><span class="n">StatsKeys</span><span class="o">.</span><span class="n">text_len</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">text_key</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">sample</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_len</span> <span class="o">&lt;=</span> <span class="n">sample</span><span class="p">[</span><span class="n">Fields</span><span class="o">.</span><span class="n">stats</span><span class="p">][</span><span class="n">StatsKeys</span><span class="o">.</span><span class="n">text_len</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
</li>
<li><p>(<img alt="alpha" src="https://img.shields.io/badge/alpha-red?style=plastic" />) å®ç°åï¼Œå°†å…¶æ·»åŠ åˆ° <code class="docutils literal notranslate"><span class="pre">data_juicer/ops/filter</span></code> ç›®å½•ä¸‹ <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> æ–‡ä»¶ä¸­çš„ç®—å­å­—å…¸ä¸­ï¼š</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="o">...</span><span class="p">,</span>              <span class="c1"># other OPs</span>
               <span class="n">text_length_filter</span><span class="p">)</span>  <span class="c1"># import this new OP module</span>
<span class="c1"># other OPs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">text_length_filter</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextLengthFilter</span>  <span class="c1"># import this new OP class</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># other Ops</span>
    <span class="n">text_length_filter</span><span class="p">,</span>  <span class="c1"># add this new Op to __all__</span>
<span class="p">]</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>(<img alt="alpha" src="https://img.shields.io/badge/alpha-red?style=plastic" />) ç®—å­æœ‰<code class="docutils literal notranslate"><span class="pre">environments/science_requires.txt</span></code>ä¸­åˆ—ä¸¾çš„åŒ…ä¾èµ–æ—¶ï¼Œéœ€è¦åœ¨<code class="docutils literal notranslate"><span class="pre">data_juicer/utils/auto_install_mapping.py</span></code>é‡Œçš„<code class="docutils literal notranslate"><span class="pre">OPS_TO_PKG</span></code>ä¸­æ·»åŠ å¯¹åº”çš„ä¾èµ–åŒ…ï¼Œä»¥æ”¯æŒç®—å­ç²’åº¦çš„ä¾èµ–å®‰è£…ã€‚</p></li>
<li><p>å…¨éƒ¨å®Œæˆï¼ç°åœ¨æ‚¨å¯ä»¥åœ¨è‡ªå·±çš„é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨æ–°æ·»åŠ çš„ç®—å­ï¼š</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># other configs</span>
<span class="nn">...</span>

<span class="c1"># process configs</span>
<span class="nt">process</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">text_length_filter</span><span class="p">:</span><span class="w">  </span><span class="c1"># add this op to your process list and set the parameters</span>
<span class="w">      </span><span class="nt">min_len</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">      </span><span class="nt">max_len</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
</pre></div>
</div>
</section>
<section id="beta">
<h4>2.1.2 ä½¿ç®—å­æ›´å¯ç”¨ï¼ˆbetaç‰ˆæœ¬ï¼‰<a class="headerlink" href="#beta" title="Link to this heading">Â¶</a></h4>
<ol class="arabic simple" start="6">
<li><p>ï¼ˆ<img alt="beta" src="https://img.shields.io/badge/beta-yellow?style=plastic" /> å¼ºçƒˆæ¨èï¼‰ä¸ºäº†å¢å¼ºä»£ç é²æ£’æ€§ã€éªŒè¯æ­£ç¡®æ€§å’Œç›´è§‚å±•ç¤ºå¦‚ä½•ä½¿ç”¨å…¶åŠŸèƒ½ï¼Œæœ€å¥½ä¸ºæ–°æ·»åŠ çš„ç®—å­è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚å¯¹äºä¸Šé¢çš„ <code class="docutils literal notranslate"><span class="pre">TextLengthFilter</span></code> ç®—å­ï¼Œåœ¨ <code class="docutils literal notranslate"><span class="pre">tests/ops/filter/</span></code> ä¸­å®ç°å¦‚ <code class="docutils literal notranslate"><span class="pre">test_text_length_filter.py</span></code> çš„æµ‹è¯•æ–‡ä»¶ï¼š</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">data_juicer.ops.filter.text_length_filter</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextLengthFilter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">data_juicer.utils.unittest_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataJuicerTestCaseBase</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TextLengthFilterTest</span><span class="p">(</span><span class="n">DataJuicerTestCaseBase</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_func1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_func2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_func3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
        
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<ol class="arabic">
<li><p>ï¼ˆ<img alt="beta" src="https://img.shields.io/badge/beta-yellow?style=plastic" /> å¼ºçƒˆæ¨èï¼‰ä¸ºäº†æ–¹ä¾¿å…¶ä»–ç”¨æˆ·ç†è§£å’Œä½¿ç”¨ï¼Œæœ€å¥½å°†æ–°å¢çš„ç®—å­ä¿¡æ¯æ›´æ–°åˆ°ç›¸åº”çš„æ–‡æ¡£ä¸­ï¼Œå…·ä½“åŒ…æ‹¬å¦‚ä¸‹ä¸¤ä¸ªåŸºæœ¬åŠ¨ä½œï¼š</p>
<ol class="arabic simple">
<li><p>è¯·åœ¨ç®—å­åŸºç±»çš„doc stringä¸­è¡¥å……åŸºç¡€ä¿¡æ¯ï¼Œç¡®ä¿å…¶å®Œæ•´å¯è¯»ï¼ˆåŒ…æ‹¬ç®—å­åŸºæœ¬åŠŸèƒ½æè¿°ã€å…¥å‚ã€å‡ºå‚ç­‰ï¼‰ã€‚æ— éœ€ç”¨æˆ·éº»çƒ¦åœ°å¤šå¤„æ’°å†™ï¼Œæˆ‘ä»¬çš„<code class="docutils literal notranslate"><span class="pre">pre-commit</span></code>å’Œsphinxæ„å»ºè„šæœ¬ä¼šè‡ªåŠ¨æŠ½å–doc stringå½¢æˆç®—å­æ± æ–‡æ¡£å’ŒAPIæ–‡æ¡£ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">configs/config_all.yaml</span></code>ï¼šè¯¥å…¨é›†é…ç½®æ–‡ä»¶ä¿å­˜äº†æ‰€æœ‰ç®—å­åŠå‚æ•°çš„ä¸€ä¸ªåˆ—è¡¨ï¼Œä½œä¸ºä¸€äº›è‡ªåŠ¨åŒ–ç‰¹æ€§çš„ä¿¡æ¯æ¥æºä»¥åŠç”¨æˆ·å‚è€ƒå¯ç”¨ç®—å­çš„ä¸€ä¸ªé‡è¦æ–‡æ¡£ä¹‹ä¸€ã€‚å› æ­¤ï¼Œåœ¨æ–°å¢ç®—å­åï¼Œè¯·å°†å…¶ä¹Ÿæ·»åŠ åˆ°è¯¥æ–‡æ¡£processåˆ—è¡¨é‡Œï¼ˆæŒ‰ç®—å­ç±»å‹åˆ†ç»„å¹¶æŒ‰å­—æ¯åºæ’åºï¼‰ï¼š</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">...</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">stopwords_filter</span><span class="p">:</span><span class="w">                                       </span><span class="c1"># filter text with stopword ratio smaller than a specific min value</span>
<span class="w">    </span><span class="nt">lang</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">en</span><span class="w">                                                </span><span class="c1"># consider stopwords in what language</span>
<span class="w">    </span><span class="nt">tokenization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">                                     </span><span class="c1"># whether to use model to tokenize documents</span>
<span class="w">    </span><span class="nt">min_ratio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.3</span><span class="w">                                          </span><span class="c1"># the min ratio to filter text</span>
<span class="w">    </span><span class="nt">stopwords_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./assets</span><span class="w">                                 </span><span class="c1"># directory to store stopwords dictionaries</span>
<span class="w">    </span><span class="nt">use_words_aug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">                                    </span><span class="c1"># whether to augment words, especially for Chinese and Vietnamese</span>
<span class="w">    </span><span class="nt">words_aug_group_sizes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">]</span><span class="w">                              </span><span class="c1"># the group size of words to augment</span>
<span class="w">    </span><span class="nt">words_aug_join_char</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">                                 </span><span class="c1"># the join char between words to augment</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">text_length_filter</span><span class="p">:</span><span class="w">                                     </span><span class="c1"># filter text with length out of specific range</span>
<span class="w">    </span><span class="nt">min_len</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w">                                             </span><span class="c1"># the min length of filter range</span>
<span class="w">    </span><span class="nt">max_len</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span><span class="w">                                          </span><span class="c1"># the max length of filter range</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">token_num_filter</span><span class="p">:</span><span class="w">                                       </span><span class="c1"># filter text with total token number out of specific range</span>
<span class="w">    </span><span class="nt">hf_tokenizer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EleutherAI/pythia-6.9b-deduped</span><span class="w">            </span><span class="c1"># name of used Hugging Face tokenizer</span>
<span class="w">    </span><span class="nt">min_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w">                                             </span><span class="c1"># the min number of filter range</span>
<span class="w">    </span><span class="nt">max_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span><span class="w">                                          </span><span class="c1"># the max number of filter range</span>
<span class="nn">...</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="stable">
<h4>2.1.3 ä½¿ç®—å­æ›´å¿«æ›´å®Œå¤‡ï¼ˆstableç‰ˆæœ¬ï¼‰<a class="headerlink" href="#stable" title="Link to this heading">Â¶</a></h4>
<ul>
<li><p>(<img alt="stable" src="https://img.shields.io/badge/stable-green?style=plastic" />) å¦‚æœåœ¨ç®—å­ä¸­ä½¿ç”¨äº† Hugging Face æ¨¡å‹ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åˆ©ç”¨ GPU åŠ é€Ÿã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œè¯·åœ¨ç®—å­çš„æ„é€ å‡½æ•°ä¸­å£°æ˜ <code class="docutils literal notranslate"><span class="pre">_accelerator</span> <span class="pre">=</span> <span class="pre">'cuda'</span></code>ï¼Œå¹¶ç¡®ä¿ <code class="docutils literal notranslate"><span class="pre">compute_stats_single/batched</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">process_single/batched</span></code> æ–¹æ³•æ¥å—ä¸€ä¸ªé¢å¤–çš„ä½ç½®å‚æ•° <code class="docutils literal notranslate"><span class="pre">rank</span></code>ã€‚</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ... (same as above)</span>

<span class="nd">@OPERATORS</span><span class="o">.</span><span class="n">register_module</span><span class="p">(</span><span class="s1">&#39;text_length_filter&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TextLengthFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>

    <span class="n">_accelerator</span> <span class="o">=</span> <span class="s1">&#39;cuda&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">min_len</span><span class="p">:</span> <span class="n">PositiveInt</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                <span class="n">max_len</span><span class="p">:</span> <span class="n">PositiveInt</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># ... (same as above)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_stats_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># ... (same as above)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># ... (same as above)</span>
</pre></div>
</div>
</li>
<li><p>(<img alt="stable" src="https://img.shields.io/badge/stable-green?style=plastic" />) å¦‚æœç®—å­æ‰¹é‡å¤„ç†æ•°æ®ï¼Œè¾“å…¥ä¸æ˜¯ä¸€ä¸ªæ ·æœ¬è€Œæ˜¯ä¸€ä¸ªbatchï¼Œæˆ–è€…ä½ æƒ³åœ¨å•æ ·æœ¬å®ç°ä¸Šç›´æ¥æ¿€æ´»batchåŒ–å¤„ç†ï¼Œéœ€è¦å£°æ˜<code class="docutils literal notranslate"><span class="pre">_batched_op</span> <span class="pre">=</span> <span class="pre">True</span></code>ã€‚
- å¯¹äºå•æ ·æœ¬å®ç°ä¸­åŸæ¥çš„ <code class="docutils literal notranslate"><span class="pre">compute_stats_single</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">process_single</span></code> æ–¹æ³•ï¼Œä½ å¯ä»¥ä¿æŒå®ƒä»¬ä¸å˜ï¼ŒData-Juicer ä¼šè°ƒç”¨é»˜è®¤çš„batchåŒ–å¤„ç†ç‰ˆæœ¬ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨æ‹†åˆ†å•ä¸ªæ ·æœ¬ä»¥è°ƒç”¨å•æ ·æœ¬ç‰ˆæœ¬çš„ä¸¤ä¸ªæ–¹æ³•æ¥æ”¯æŒbatchåŒ–å¤„ç†ã€‚ä½ ä¹Ÿå¯ä»¥è‡ªè¡Œå®ç°æ›´é«˜æ•ˆçš„batchåŒ–çš„ç‰ˆæœ¬ã€‚</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ... (import some other libraries)</span>
<span class="n">OP_NAME</span> <span class="o">=</span> <span class="s1">&#39;image_diffusion_mapper&#39;</span>
<span class="nd">@OPERATORS</span><span class="o">.</span><span class="n">register_module</span><span class="p">(</span><span class="n">OP_NAME</span><span class="p">)</span>
<span class="nd">@LOADED_IMAGES</span><span class="o">.</span><span class="n">register_module</span><span class="p">(</span><span class="n">OP_NAME</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ImageDiffusionMapper</span><span class="p">(</span><span class="n">Mapper</span><span class="p">):</span>
    <span class="n">_batched_op</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="c1"># ... (OP parameters)</span>
             <span class="o">*</span><span class="n">args</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_batched</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">):</span>
        <span class="c1"># ... (some codes)</span>
</pre></div>
</div>
</li>
<li><p>(<img alt="stable" src="https://img.shields.io/badge/stable-green?style=plastic" />) åœ¨mapperç®—å­ä¸­ï¼Œæˆ‘ä»¬æä¾›äº†äº§ç”Ÿé¢å¤–æ•°æ®çš„å­˜å‚¨è·¯å¾„ç”Ÿæˆæ¥å£ï¼Œé¿å…å‡ºç°è¿›ç¨‹å†²çªå’Œæ•°æ®è¦†ç›–çš„æƒ…å†µã€‚ç”Ÿæˆçš„å­˜å‚¨è·¯å¾„æ ¼å¼ä¸º<code class="docutils literal notranslate"><span class="pre">{ORIGINAL_DATAPATH}/__dj__produced_data__/{OP_NAME}/{ORIGINAL_FILENAME}__dj_hash_#{HASH_VALUE}#.{EXT}</span></code>ï¼Œå…¶ä¸­<code class="docutils literal notranslate"><span class="pre">HASH_VALUE</span></code>æ˜¯ç®—å­åˆå§‹åŒ–å‚æ•°ã€æ¯ä¸ªæ ·æœ¬ä¸­ç›¸å…³å‚æ•°ã€è¿›ç¨‹IDå’Œæ—¶é—´æˆ³çš„å“ˆå¸Œå€¼ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œå¯ä»¥åœ¨OPç±»åˆå§‹åŒ–å¼€å¤´è°ƒç”¨<code class="docutils literal notranslate"><span class="pre">self.remove_extra_parameters(locals())</span></code>è·å–ç®—å­åˆå§‹åŒ–å‚æ•°ï¼ŒåŒæ—¶å¯ä»¥è°ƒç”¨<code class="docutils literal notranslate"><span class="pre">self.add_parameters</span></code>æ·»åŠ æ¯ä¸ªæ ·æœ¬ä¸ç”Ÿæˆé¢å¤–æ•°æ®ç›¸å…³çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼Œåˆ©ç”¨diffusionæ¨¡å‹å¯¹å›¾åƒè¿›è¡Œå¢å¼ºçš„ç®—å­ï¼š</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ... (import some library)</span>
<span class="n">OP_NAME</span> <span class="o">=</span> <span class="s1">&#39;image_diffusion_mapper&#39;</span>
<span class="nd">@OPERATORS</span><span class="o">.</span><span class="n">register_module</span><span class="p">(</span><span class="n">OP_NAME</span><span class="p">)</span>
<span class="nd">@LOADED_IMAGES</span><span class="o">.</span><span class="n">register_module</span><span class="p">(</span><span class="n">OP_NAME</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ImageDiffusionMapper</span><span class="p">(</span><span class="n">Mapper</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="c1"># ... (OP parameters)</span>
             <span class="o">*</span><span class="n">args</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_extra_parameters</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
        <span class="c1"># ... (some codes)</span>
        <span class="c1"># captions[index] is the prompt for diffusion model</span>
        <span class="n">related_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_parameters</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_init_parameters</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="n">captions</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="n">new_image_path</span> <span class="o">=</span> <span class="n">transfer_filename</span><span class="p">(</span>
                <span class="n">origin_image_path</span><span class="p">,</span> <span class="n">OP_NAME</span><span class="p">,</span> <span class="o">**</span><span class="n">related_parameters</span><span class="p">)</span>
        <span class="c1"># ... (some codes)</span>
</pre></div>
</div>
<p>é’ˆå¯¹ä¸€ä¸ªæ•°æ®æºè¡ç”Ÿå‡ºå¤šä¸ªé¢å¤–æ•°æ®çš„æƒ…å†µï¼Œæˆ‘ä»¬å…è®¸åœ¨ç”Ÿæˆçš„å­˜å‚¨è·¯å¾„åé¢å†åŠ åç¼€ã€‚æ¯”å¦‚ï¼Œæ ¹æ®å…³é”®å¸§å°†è§†é¢‘æ‹†åˆ†æˆå¤šä¸ªè§†é¢‘ï¼š</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ... (import some library)</span>
<span class="n">OP_NAME</span> <span class="o">=</span> <span class="s1">&#39;video_split_by_key_frame_mapper&#39;</span>
<span class="nd">@OPERATORS</span><span class="o">.</span><span class="n">register_module</span><span class="p">(</span><span class="n">OP_NAME</span><span class="p">)</span>
<span class="nd">@LOADED_VIDEOS</span><span class="o">.</span><span class="n">register_module</span><span class="p">(</span><span class="n">OP_NAME</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VideoSplitByKeyFrameMapper</span><span class="p">(</span><span class="n">Mapper</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="c1"># ... (OP parameters)</span>
             <span class="o">*</span><span class="n">args</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_extra_parameters</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
        <span class="c1"># ... (some codes)</span>
        <span class="n">split_video_path</span> <span class="o">=</span> <span class="n">transfer_filename</span><span class="p">(</span>
                    <span class="n">original_video_path</span><span class="p">,</span> <span class="n">OP_NAME</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_parameters</span><span class="p">)</span>
        <span class="n">split_video_path</span> <span class="o">=</span> <span class="n">add_suffix_to_filename</span><span class="p">(</span><span class="n">split_video_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># ... (some codes)</span>
</pre></div>
</div>
</li>
</ul>
<p>ï¼ˆ<img alt="stable" src="https://img.shields.io/badge/stable-green?style=plastic" /> å¯é€‰ï¼‰<strong>ä½¿æ–°ç®—å­å¯ä»¥è¿›è¡Œç®—å­èåˆ</strong></p>
<ul class="simple">
<li><p>å¦‚æœæˆ‘ä»¬çš„æ–°ç®—å­ä¸­çš„éƒ¨åˆ†ä¸­é—´å˜é‡çš„è®¡ç®—è¿‡ç¨‹ä¸å·²æœ‰çš„ç®—å­é‡å¤ï¼Œé‚£ä¹ˆå¯ä»¥å°†å…¶æ·»åŠ åˆ°å¯èåˆç®—å­ä¸­ï¼Œä»¥åœ¨æ•°æ®å¤„ç†æ—¶åˆ©ç”¨ç®—å­èåˆè¿›è¡ŒåŠ é€Ÿã€‚ï¼ˆå¦‚<code class="docutils literal notranslate"><span class="pre">words_num_filter</span></code>ä¸<code class="docutils literal notranslate"><span class="pre">word_repetition_filter</span></code>éƒ½éœ€è¦å¯¹è¾“å…¥æ–‡æœ¬è¿›è¡Œåˆ†è¯ï¼‰</p></li>
<li><p>å½“ç®—å­èåˆï¼ˆOP Fusionï¼‰åŠŸèƒ½å¼€å¯æ—¶ï¼Œè¿™äº›é‡å¤çš„è®¡ç®—è¿‡ç¨‹å’Œä¸­é—´å˜é‡æ˜¯å¯ä»¥åœ¨ç®—å­ä¹‹é—´çš„<code class="docutils literal notranslate"><span class="pre">context</span></code>ä¸­å…±äº«çš„ï¼Œä»è€Œå¯ä»¥å‡å°‘é‡å¤è®¡ç®—ã€‚</p></li>
<li><p>å¯é€šè¿‡å¦‚ä¸‹æ­¥éª¤ä½¿åŒ…å«å…±æœ‰ä¸­é—´å˜é‡çš„ç®—å­å¯è¿›è¡Œç®—å­èåˆï¼ˆä»¥<code class="docutils literal notranslate"><span class="pre">words_num_filter</span></code>ç®—å­ä¸ºä¾‹ï¼‰ã€‚</p></li>
</ul>
<ol class="arabic simple">
<li><p>ï¼ˆå¯é€‰ï¼‰å¦‚æœæ–°ç®—å­ä¸­äº§ç”Ÿäº†æ–°çš„ä¸­é—´å˜é‡ï¼Œéœ€è¦åœ¨<code class="docutils literal notranslate"><span class="pre">utils/constant.py</span></code>ä¸­çš„<code class="docutils literal notranslate"><span class="pre">InterVars</span></code>ç±»ä¸­æ·»åŠ æ–°çš„ä¸­é—´å˜é‡åç§°ã€‚é€šå¸¸éœ€è¦åœ¨åç§°å‰åŠ ä¸Š<code class="docutils literal notranslate"><span class="pre">DEFAULT_PREFIX</span></code>å‰ç¼€ã€‚</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">InterVars</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1"># text</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">DEFAULT_PREFIX</span> <span class="o">+</span> <span class="s1">&#39;lines&#39;</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">DEFAULT_PREFIX</span> <span class="o">+</span> <span class="s1">&#39;words&#39;</span>  <span class="c1"># åœ¨è¿™é‡Œæ·»åŠ æ–°çš„ä¸­é—´å˜é‡</span>
    <span class="o">...</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>ï¼ˆå¯é€‰ï¼‰ç¬¬1æ­¥ä¸­æ·»åŠ çš„æ–°çš„ä¸­é—´å˜é‡è¿˜éœ€åœ¨<code class="docutils literal notranslate"><span class="pre">ops/op_fusion.py</span></code>ä¸­ä¸ºå…¶å®šä¹‰ä¸€ä¸ªæ³¨å†Œç»„ï¼Œå¹¶æ·»åŠ åˆ°ä¿å­˜äº†æ‰€æœ‰æ³¨å†Œç»„çš„åˆ—è¡¨ä¸­ï¼Œæ–¹ä¾¿ç®—å­èåˆæ¨¡å—è¿½è¸ªæ¶‰åŠåˆ°è¿™äº›ä¸­é—´å˜é‡çš„ç®—å­ã€‚</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="c1"># Type of intermediate vars</span>
<span class="c1"># text</span>
<span class="n">INTER_LINES</span> <span class="o">=</span> <span class="n">Registry</span><span class="p">(</span><span class="n">InterVars</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
<span class="n">INTER_WORDS</span> <span class="o">=</span> <span class="n">Registry</span><span class="p">(</span><span class="n">InterVars</span><span class="o">.</span><span class="n">words</span><span class="p">)</span>  <span class="c1"># ä¸ºæ–°çš„ä¸­é—´å˜é‡å®šä¹‰æ³¨å†Œç»„</span>

<span class="c1"># images</span>
<span class="n">LOADED_IMAGES</span> <span class="o">=</span> <span class="n">Registry</span><span class="p">(</span><span class="n">InterVars</span><span class="o">.</span><span class="n">loaded_images</span><span class="p">)</span>

<span class="c1"># all</span>
<span class="n">ALL_INTER_VARS</span> <span class="o">=</span> <span class="p">[</span><span class="n">INTER_LINES</span><span class="p">,</span> <span class="n">INTER_WORDS</span><span class="p">,</span> <span class="n">LOADED_IMAGES</span><span class="p">]</span>  <span class="c1"># å¹¶æ·»åŠ åˆ°æ³¨å†Œç»„åˆ—è¡¨ä¸­</span>
<span class="o">...</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>åœ¨æ¶‰åŠåˆ°è¯¥ä¸­é—´å˜é‡çš„ç®—å­å‰ï¼Œå°†è¯¥ç®—å­æ³¨å†Œåˆ°ä¸­é—´å˜é‡å¯¹åº”çš„æ³¨å†Œç»„ä¸­ï¼Œè¡¨ç¤ºè¯¥ç®—å­ä¸­å¯èƒ½å¯¹è¯¥ä¸­é—´å˜é‡è¿›è¡Œäº†è®¡ç®—ä¸ä½¿ç”¨ã€‚</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="nd">@OPERATORS</span><span class="o">.</span><span class="n">register_module</span><span class="p">(</span><span class="n">OP_NAME</span><span class="p">)</span>
<span class="nd">@INTER_WORDS</span><span class="o">.</span><span class="n">register_module</span><span class="p">(</span><span class="n">OP_NAME</span><span class="p">)</span>  <span class="c1"># å°†è¯¥ç®—å­æ³¨å†Œåˆ°æ³¨å†Œç»„ä¸­</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WordsNumFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
<span class="o">...</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>åœ¨ç®—å­è®¡ç®—è¯¥ä¸­é—´å˜é‡çš„è¿‡ç¨‹ä¸­ï¼Œå¯å°†è®¡ç®—é€»è¾‘ä¿®æ”¹ä¸ºï¼š</p>
<ol class="arabic simple">
<li><p>å¦‚æœ<code class="docutils literal notranslate"><span class="pre">context</span></code>å‚æ•°ä¸ºTrueï¼Œåˆ™è¡¨ç¤ºå·²å¼€å¯äº†ç®—å­èåˆï¼Œä¼˜å…ˆä»<code class="docutils literal notranslate"><span class="pre">context</span></code>ä¸­è·å–å‰åºç®—å­å·²ç»è®¡ç®—è¿‡çš„è¯¥ä¸­é—´å˜é‡çš„å€¼</p></li>
<li><p>å¦‚æœä¸­é—´å˜é‡åœ¨<code class="docutils literal notranslate"><span class="pre">context</span></code>ä¸­ä¸å­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºåœ¨è¯¥ç®—å­ä¸­é¦–æ¬¡å¯¹è¯¥ä¸­é—´å˜é‡è¿›è¡Œè®¡ç®—ï¼Œåœ¨è®¡ç®—å®Œæˆåï¼Œå®šä¹‰ä¸€ä¸ªå”¯ä¸€çš„keyå¹¶å°†å…¶å­˜æ”¾åˆ°<code class="docutils literal notranslate"><span class="pre">context</span></code>ä¸­ï¼Œä»¥ä¾›åç»­ç®—å­ä½¿ç”¨</p></li>
<li><p>å¦‚æœ<code class="docutils literal notranslate"><span class="pre">context</span></code>å‚æ•°ä¸ºFalseï¼Œåˆ™æŒ‰ç…§æ­£å¸¸è®¡ç®—æµç¨‹è¿›è¡Œ</p></li>
</ol>
</li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ä¿®æ”¹è®¡ç®—é€»è¾‘å‰</span>
<span class="o">...</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_key</span><span class="p">)</span>
<span class="n">words</span> <span class="o">=</span> <span class="n">get_words_from_document</span><span class="p">(</span>
    <span class="n">sample</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">text_key</span><span class="p">],</span>
    <span class="n">token_func</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">encode_as_pieces</span> <span class="k">if</span> <span class="n">tokenizer</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
<span class="o">...</span>        

<span class="c1"># ä¿®æ”¹è®¡ç®—é€»è¾‘å</span>
<span class="o">...</span>
<span class="n">words_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">InterVars</span><span class="o">.</span><span class="n">words</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_key</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="k">if</span> <span class="n">context</span> <span class="ow">and</span> <span class="n">words_key</span> <span class="ow">in</span> <span class="n">sample</span><span class="p">[</span><span class="n">Fields</span><span class="o">.</span><span class="n">context</span><span class="p">]:</span>
    <span class="c1"># ç›´æ¥ä½¿ç”¨contextä¸­å·²æœ‰çš„ä¸­é—´å˜é‡å€¼</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="n">Fields</span><span class="o">.</span><span class="n">context</span><span class="p">][</span><span class="n">words_key</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># æ­£å¸¸è®¡ç®—æµç¨‹</span>
    <span class="n">tokenizer</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_key</span><span class="p">)</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">get_words_from_document</span><span class="p">(</span>
        <span class="n">sample</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">text_key</span><span class="p">],</span>
        <span class="n">token_func</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">encode_as_pieces</span> <span class="k">if</span> <span class="n">tokenizer</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
        <span class="c1"># ç¬¬ä¸€æ¬¡è®¡ç®—è¯¥ä¸­é—´å˜é‡åï¼Œæ”¾å…¥contextä¾›åç»­ç®—å­ä½¿ç”¨</span>
        <span class="n">sample</span><span class="p">[</span><span class="n">Fields</span><span class="o">.</span><span class="n">context</span><span class="p">][</span><span class="n">words_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span>
<span class="o">...</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>éšç€ç®—å­æ•°é‡çš„å¢åŠ ï¼ŒData-Juicerçš„ä¾èµ–ä¹Ÿä¸æ–­å¢å¤šã€‚ä¸ºäº†é˜²æ­¢Data-Juicerçš„ä¾èµ–è¶Šæ¥è¶Šé‡ï¼Œæˆ‘ä»¬ä¸ºç®—å­é¢å¤–å¢åŠ çš„ä¾èµ–æä¾›äº†ä¸€å¥—å»¶è¿ŸåŠ è½½åŠ ä¸Šä½¿ç”¨æ—¶å®‰è£…ä¾èµ–çš„ç­–ç•¥ã€‚<code class="docutils literal notranslate"><span class="pre">LazyLoader</span></code>ä¼šæ£€æŸ¥åŠ è½½çš„moduleå¯¹åº”çš„packageæœ‰æ²¡æœ‰éƒ½å®‰è£…ï¼Œæ²¡æœ‰çš„è¯ä¼šåŠ¨æ€è‡ªåŠ¨å®‰è£…ã€‚å¦‚ä¸‹æ ·ä¾‹ï¼š</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ... (import some library)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">data_juicer.utils.lazy_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">LazyLoader</span>

<span class="c1"># lazy import</span>
<span class="n">torch</span> <span class="o">=</span> <span class="n">LazyLoader</span><span class="p">(</span><span class="s1">&#39;torch&#39;</span><span class="p">)</span>
<span class="n">transformers</span> <span class="o">=</span> <span class="n">LazyLoader</span><span class="p">(</span><span class="s1">&#39;transformers&#39;</span><span class="p">)</span>
<span class="n">nltk</span> <span class="o">=</span> <span class="n">LazyLoader</span><span class="p">(</span><span class="s1">&#39;nltk&#39;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PerplexityFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="c1"># ... (OP parameters)</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># auto install before init</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">LazyLoader</span><span class="o">.</span><span class="n">check_packages</span><span class="p">([</span><span class="s1">&#39;fasttext-wheel&#39;</span><span class="p">])</span>
        <span class="c1"># ... (some codes)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
        <span class="c1"># ... (some codes)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>è‡³æ­¤ï¼Œè¯¥ç®—å­å·²ç»èƒ½å¤Ÿåœ¨ç®—å­èåˆåŠŸèƒ½å¼€å¯åï¼Œè‡ªåŠ¨åœ°ä¸å…¶ä»–ç®—å­è¿›è¡Œèåˆå¹¶å…±äº«å…±æœ‰çš„ä¸­é—´å˜é‡ï¼Œå‡å°‘é‡å¤è®¡ç®—ï¼ŒåŠ å¿«æ•´ä½“çš„æ•°æ®å¤„ç†é€Ÿåº¦</p></li>
</ul>
</section>
</section>
</section>
<section id="id5">
<h2>3. æ„å»ºè‡ªå·±çš„æ•°æ®èœè°±å’Œé…ç½®<a class="headerlink" href="#id5" title="Link to this heading">Â¶</a></h2>
<ul class="simple">
<li><p>æˆ‘ä»¬æä¾›åŸºäº <a class="reference external" href="https://github.com/omni-us/jsonargparse/">jsonargparse</a> çš„ç®€å•é…ç½®ä»¥é™ä½æ ·æ¿ä»£ç çš„æˆæœ¬ã€‚</p></li>
<li><p>æˆ‘ä»¬æä¾›å¤§é‡çš„ç¤ºä¾‹æ€§èœè°±ä»¥ä¾›å‚é˜…å¤ç”¨å’Œæ‰©å±•ï¼Œ<a class="reference internal" href="RecipeGallery_ZH.html"><span class="std std-doc">æ•°æ®èœè°±Gallery</span></a>ã€‚</p></li>
<li><p>ğŸ“£ğŸ“£ğŸ“£ ç¤¾åŒºè´¡çŒ®è€…å¯æPRåœ¨<em>æ•°æ®èœè°±Gallery</em>ä¸­æ·»åŠ è‡ªå®šä¹‰çš„æ•°æ®èœè°±ï¼Œä¿ƒè¿›ä¼ æ’­ã€å¤ç”¨å’Œç›¸å…³æŠ€æœ¯æ¼”è¿›ã€‚æˆ‘ä»¬éå¸¸æ¬¢è¿å…±å»ºï¼Œå¹¶ä¼šé«˜äº®<a class="reference external" href="https://github.com/modelscope/data-juicer?tab=readme-ov-file#acknowledgement">è‡´è°¢</a>ï¼</p></li>
</ul>
<section id="id6">
<h3>3.1 ä¸°å¯Œçš„é…ç½®æºå’Œç±»å‹æç¤º<a class="headerlink" href="#id6" title="Link to this heading">Â¶</a></h3>
<ul class="simple">
<li><p>å…¨å±€é…ç½®å¯¹è±¡å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆå§‹åŒ–</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># core.executor.py</span>
<span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">init_configs</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>å…¶ä¸­å¯ä»¥æŒ‡å®šå’Œæ··åˆæ¥è‡ªä¸åŒæ¥æºçš„å‡½æ•°å‚æ•°ï¼ŒåŒ…æ‹¬</p>
<ol class="arabic simple">
<li><p><em>ç¡¬ç¼–ç é»˜è®¤å€¼</em> å°†é…ç½®æ³¨å†Œåˆ°è§£æå™¨ä¸­æˆ–åœ¨ç±»çš„ <code class="docutils literal notranslate"><span class="pre">__init__</span></code> å‡½æ•°ä¸­æŒ‡å®š</p></li>
<li><p>json æ ¼å¼çš„é»˜è®¤<em>é…ç½®æ–‡ä»¶</em>ï¼ˆyaml æˆ– jsonnet è¶…é›†ï¼‰</p></li>
<li><p><em>ç¯å¢ƒå˜é‡</em></p></li>
<li><p><em>POSIX-style å‘½ä»¤è¡Œå‚æ•°</em>ï¼Œ ä¾‹å¦‚ <code class="docutils literal notranslate"><span class="pre">--project_name</span> <span class="pre">my_data_demo</span></code> æˆ– <code class="docutils literal notranslate"><span class="pre">--project_name=my_data_demo</span></code>ï¼ŒåŒ…å«é…ç½®æ–‡ä»¶</p></li>
</ol>
</li>
<li><p>æœ€ç»ˆè§£æçš„å€¼æ˜¯æ¥è‡ªè¿™äº›æ¥æºçš„æ··åˆã€‚ å¹¶ä¸”è¦†ç›–é¡ºåºä¸ä¸Šé¢çš„æ•°å­—ç›¸åŒã€‚</p></li>
</ul>
<p>æ­¤å¤–ï¼Œè¿˜æ”¯æŒè®¸å¤šå‚æ•°ç±»å‹å’Œç›¸åº”çš„éªŒè¯ã€‚
åŒ…å« Pythonå†…ç½®ç±»å‹ã€æ¥è‡ª <a class="reference external" href="https://docs.python.org/3/library/typing.html">Lib/typing</a> çš„ç±»å‹ï¼Œä»¥åŠæ¥è‡ª jsonargparse çš„ <a class="reference external" href="https://jsonargparse.readthedocs.io/en/stable/#type-hints">æ‰©å±•ç±»å‹</a>ï¼Œä¾‹å¦‚å…·æœ‰è‡ªå®šä¹‰é™åˆ¶çš„ <code class="docutils literal notranslate"><span class="pre">restricted</span> <span class="pre">types</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">Paths</span></code>ã€‚</p>
</section>
<section id="id7">
<h3>3.2 å±‚æ¬¡åŒ–çš„é…ç½®å’Œå¸®åŠ©<a class="headerlink" href="#id7" title="Link to this heading">Â¶</a></h3>
<ul class="simple">
<li><p>æ‚¨å¯ä»¥åœ¨å‚æ•°åç§°ä¸­è‡ªç”±ä½¿ç”¨ç‚¹ç¬¦å·æ¥å®šä¹‰å±‚æ¬¡ç»“æ„ï¼Œ ä¾‹å¦‚ <code class="docutils literal notranslate"><span class="pre">maximum_line_length_filter.min</span></code>.
æ›´é‡è¦çš„æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è‡ªåŠ¨æ³¨å†Œå·²å®ç°çš„è¿ç®—ç¬¦çš„ docstringã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰çš„ç»“æ„é…ç½®å§‹ç»ˆä¸ä»£ç åŒæ­¥ã€‚</p></li>
<li><p>æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œè„šæœ¬æ¥è·å–å±‚æ¬¡åŒ–çš„å¸®åŠ©ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python tools/process_data.py --help

usage: process_data.py [-h] [--config CONFIG] [--print_config[=flags]] [--project_name PROJECT_NAME] [--dataset_path DATASET_PATH] [--dataset_dir DATASET_DIR] [--export_path EXPORT_PATH] [--process PROCESS]
                            [--np NP] [--text_kes TEXT_KEYS] [--document_deduplicator CONFIG] [--document_deduplicator.hash_method HASH_METHOD] [--document_deduplicator.lowercase LOWERCASE]
                            [--document_deduplicator.ignore_non_character IGNORE_NON_CHARACTER] [--language_id_score_filter CONFIG] [--language_id_score_filter.lang LANG] [--words_num_filter CONFIG] [--words_num_filter.min MIN] [--words_num_filter.max MAX]
                            [--alphanumeric_filter CONFIG] [--alphanumeric_filter.min MIN] [--alphanumeric_filter.max MAX] [--average_line_length_filter CONFIG] [--average_line_length_filter.min MIN] [--average_line_length_filter.max MAX]
                            [--maximum_line_length_filter CONFIG] [--maximum_line_length_filter.min MIN] [--maximum_line_length_filter.max MAX] [--text_length_filter CONFIG] [--text_length_filter.min MIN] [--text_length_filter.max MAX]
                            [--remove_comments_mapper CONFIG] [--remove_comments_mapper.type TYPE] [--remove_comments_mapper.inline INLINE] [--remove_comments_mapper.multiline MULTILINE] [--remove_header_mapper CONFIG]
                            [--remove_header_mapper.before_section BEFORE_SECTION]

optional arguments:
  -h, --help            Show this help message and exit.
  --config CONFIG       Path to a configuration file.
  --print_config[=flags]
                        Print the configuration after applying all other arguments and exit. The optional flags customizes the output and are one or more keywords separated by comma. The supported flags are: comments, skip_default, skip_null.
  --project_name PROJECT_NAME
                        name of your data process project. (type: str, default: null)
  --dataset_path DATASET_PATH
                        path to your dataset file, relative with respect to the config file&#39;s location (type: Path_fr, default: null)
  --dataset_dir DATASET_DIR
                        path to your dataset(s) within a directory, relative with respect to the config file&#39;s location (type: Path_drw, default: null)
  --export_path EXPORT_PATH
                        path to the output processed dataset, relative with respect to the config file&#39;s location (type: Path_fc, default: null)
  --process PROCESS, --process+ PROCESS
                        a list of several process operators with their arguments (type: List[Dict], default: null)
  --np NP               number of subprocess to process your dataset. (type: PositiveInt, default: null)

&lt;class &#39;data_juicer.ops.filter.alphanumeric_filter.AlphanumericFilter&#39;&gt;:
  --alphanumeric_filter CONFIG
                        Path to a configuration file.
  --alphanumeric_filter.min MIN
                        the min filter rate in alphanumeric op. (type: ClosedUnitInterval, default: 0.0)
  --alphanumeric_filter.max MAX
                        the max filter rate in alphanumeric op. (type: ClosedUnitInterval, default: 0.25)

&lt;class &#39;data_juicer.ops.filter.text_length_filter.TextLengthFilter&#39;&gt;:
  --text_length_filter CONFIG
                        Path to a configuration file.
  --text_length_filter.min MIN
                        min text length in the filtering (type: int, default: 10)
  --text_length_filter.max MAX
                        max text length in the filtering (type: int, default: 10000)

......

</pre></div>
</div>
</section>
</section>
<section id="id8">
<h2>4. ä¾èµ–ç®¡ç†<a class="headerlink" href="#id8" title="Link to this heading">Â¶</a></h2>
<p>Data-Juicer ä½¿ç”¨åŸºäº <code class="docutils literal notranslate"><span class="pre">uv</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> çš„ç°ä»£ä¾èµ–ç®¡ç†ç³»ç»Ÿã€‚ä¾èµ–é€šè¿‡æ ‡å‡†çš„ Python æ‰“åŒ…æ ¼å¼ (PEP 621) è¿›è¡Œç®¡ç†ï¼Œå¹¶ä½¿ç”¨å»¶è¿ŸåŠ è½½ç³»ç»ŸæŒ‰éœ€å®‰è£…ã€‚</p>
<section id="uv">
<h3>4.1 å®‰è£… uv<a class="headerlink" href="#uv" title="Link to this heading">Â¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">uv</span></code> æ˜¯ä¸€ä¸ªå¿«é€Ÿçš„ Python åŒ…å®‰è£…å™¨å’Œè§£æå™¨ï¼Œç”¨äºæ›¿ä»£ pipã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®‰è£…ï¼š</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ä½¿ç”¨ curl å®‰è£…</span>
curl<span class="w"> </span>-LsSf<span class="w"> </span>https://astral.sh/uv/install.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh

<span class="c1"># æˆ–ä½¿ç”¨ pip å®‰è£…</span>
pip<span class="w"> </span>install<span class="w"> </span>uv
</pre></div>
</div>
<p>å®‰è£…å®Œæˆåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">--version</span></code> éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸã€‚</p>
</section>
<section id="id9">
<h3>4.2 è™šæ‹Ÿç¯å¢ƒç®¡ç†<a class="headerlink" href="#id9" title="Link to this heading">Â¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">uv</span></code> æä¾›äº†è™šæ‹Ÿç¯å¢ƒç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥æ›¿ä»£ <code class="docutils literal notranslate"><span class="pre">venv</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code>ã€‚ä»¥ä¸‹æ˜¯å¸¸ç”¨å‘½ä»¤ï¼š</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># åˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒ</span>
uv<span class="w"> </span>venv

<span class="c1"># åˆ›å»ºæŒ‡å®š Python ç‰ˆæœ¬çš„è™šæ‹Ÿç¯å¢ƒ</span>
uv<span class="w"> </span>venv<span class="w"> </span>--python<span class="w"> </span><span class="m">3</span>.10

<span class="c1"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>
<span class="c1"># åœ¨ Unix/macOS ä¸Š</span>
<span class="nb">source</span><span class="w"> </span>.venv/bin/activate
<span class="c1"># åœ¨ Windows ä¸Š</span>
.venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate

<span class="c1"># åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…æœ€å°ä¾èµ–</span>
uv<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
</pre></div>
</div>
</section>
<section id="id10">
<h3>4.3 æ·»åŠ æ–°ä¾èµ–<a class="headerlink" href="#id10" title="Link to this heading">Â¶</a></h3>
<p>æ·»åŠ æ–°ä¾èµ–çš„æ–¹æ³•ï¼š</p>
<ol class="arabic simple">
<li><p>å°†ä¾èµ–æ·»åŠ åˆ° <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> çš„ç›¸åº”éƒ¨åˆ†ï¼š</p>
<ul class="simple">
<li><p>æ ¸å¿ƒä¾èµ–æ”¾åœ¨ <code class="docutils literal notranslate"><span class="pre">[project.dependencies]</span></code> ä¸­</p></li>
<li><p>å¯é€‰ä¾èµ–æ”¾åœ¨ <code class="docutils literal notranslate"><span class="pre">[project.optional-dependencies]</span></code> çš„ç›¸åº”ç»„ä¸­ï¼ˆ genericã€devã€audioã€videoï¼Œetc.ï¼‰</p></li>
</ul>
</li>
<li><p>å»¶è¿ŸåŠ è½½ç³»ç»Ÿä¼šåœ¨é¦–æ¬¡ä½¿ç”¨æ—¶è‡ªåŠ¨å¤„ç†ä¾èµ–å®‰è£…ã€‚</p></li>
</ol>
<p>ç¤ºä¾‹ï¼š</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[project.dependencies]</span>
<span class="c1"># æ ¸å¿ƒä¾èµ–</span>
<span class="n">numpy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&gt;=1.26.4,&lt;2.0.0&quot;</span>

<span class="k">[project.optional-dependencies]</span>
<span class="n">generic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;torch&gt;=1.11.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;transformers&gt;=4.47.0,&lt;4.48.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="err">...</span>
<span class="err">]</span>
</pre></div>
</div>
</section>
<section id="id11">
<h3>4.4 å¼€å‘ç¯å¢ƒè®¾ç½®<a class="headerlink" href="#id11" title="Link to this heading">Â¶</a></h3>
<ol class="arabic simple">
<li><p>å®‰è£…æ‰€æœ‰ä¾èµ–ï¼š</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>uv<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;.[all]&quot;</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>æˆ–å®‰è£…ç‰¹å®šç»„ï¼š</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>uv<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;.[generic]&quot;</span><span class="w">      </span><span class="c1"># é€šç”¨ä¾èµ–</span>
uv<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;.[dev]&quot;</span><span class="w">          </span><span class="c1"># å¼€å‘å·¥å…·</span>
uv<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;.[ai_services]&quot;</span><span class="w">  </span><span class="c1"># æœåŠ¡ä¾èµ–</span>
</pre></div>
</div>
</section>
<section id="id12">
<h3>4.5 å»¶è¿ŸåŠ è½½<a class="headerlink" href="#id12" title="Link to this heading">Â¶</a></h3>
<p>å»¶è¿ŸåŠ è½½ç³»ç»Ÿåœ¨é¦–æ¬¡ä½¿ç”¨æ—¶è‡ªåŠ¨å®‰è£…ä¾èµ–ã€‚è¿™æ„å‘³ç€ï¼š</p>
<ul class="simple">
<li><p>åˆå§‹å®‰è£…æ›´å¿«</p></li>
<li><p>åªå®‰è£…å¿…éœ€çš„ä¾èµ–</p></li>
<li><p>ä¾èµ–æŒ‰éœ€å®‰è£…</p></li>
<li><p>ä¼˜å…ˆä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">uv</span></code> è¿›è¡Œå¿«é€Ÿå®‰è£…</p></li>
</ul>
</section>
</section>
<section id="id13">
<h2>5. æ–‡æ¡£è§„èŒƒ<a class="headerlink" href="#id13" title="Link to this heading">Â¶</a></h2>
<p>æˆ‘ä»¬ä½¿ç”¨ Sphinx è¿›è¡Œæ–‡æ¡£ç®¡ç†ã€‚ä¸ºä¿è¯å¼€å‘æ–‡æ¡£é¡ºåˆ©é›†æˆåˆ° Sphinx æ–‡æ¡£ç³»ç»Ÿä¸­ï¼Œè¯·åœ¨ç¼–å†™æ—¶æ³¨æ„ä»¥ä¸‹è§„èŒƒï¼š</p>
<ol class="arabic simple">
<li><p>æ ‡é¢˜å±‚çº§</p>
<ul class="simple">
<li><p>ä¸€çº§æ ‡é¢˜ï¼ˆ<code class="docutils literal notranslate"><span class="pre">#</span></code>ï¼‰ï¼šæ¯ä¸ªæ–‡æ¡£<strong>å¿…é¡»ä¸”åªèƒ½</strong>åŒ…å«ä¸€ä¸ªä¸€çº§æ ‡é¢˜ï¼Œä½œä¸ºæ–‡æ¡£çš„æ•´ä½“æ ‡é¢˜ã€‚</p></li>
<li><p>ç¡®ä¿æ ‡é¢˜å±‚çº§ç»“æ„æ­£ç¡®ï¼Œä¸è¦è·³çº§ä½¿ç”¨æ ‡é¢˜ã€‚ä¾‹å¦‚ï¼Œä¸€çº§æ ‡é¢˜ä¸‹åº”è¯¥æ˜¯äºŒçº§æ ‡é¢˜ï¼Œè€Œä¸æ˜¯ç›´æ¥è·³åˆ°ä¸‰çº§æ ‡é¢˜ã€‚</p></li>
</ul>
</li>
<li><p>æ–‡ä»¶å‘½åè§„èŒƒ</p>
<ul class="simple">
<li><p>ä¸­æ–‡æ–‡æ¡£ï¼šä¸­æ–‡ Markdown æ–‡ä»¶çš„å‘½åå¿…é¡»ä»¥ <code class="docutils literal notranslate"><span class="pre">_ZH</span></code> ç»“å°¾ã€‚ä¾‹å¦‚ï¼š<code class="docutils literal notranslate"><span class="pre">README_ZH.md</span></code></p></li>
</ul>
</li>
</ol>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="Distributed_ZH.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Data-Juicer åˆ†å¸ƒå¼æ•°æ®å¤„ç†</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="DJ_service_ZH.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">APIæœåŠ¡åŒ–</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Data-Juicer Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">å¼€å‘è€…æŒ‡å—</a><ul>
<li><a class="reference internal" href="#id2">1. ç¼–ç è§„èŒƒ</a></li>
<li><a class="reference internal" href="#id3">2. æ„å»ºè‡ªå·±çš„ç®—å­</a><ul>
<li><a class="reference internal" href="#id4">2.1 æ„å»ºç¤ºä¾‹</a><ul>
<li><a class="reference internal" href="#alpha">2.1.2 æä¾›ç®—å­åŸºæœ¬åŠŸèƒ½ï¼ˆalphaç‰ˆæœ¬ï¼‰</a></li>
<li><a class="reference internal" href="#beta">2.1.2 ä½¿ç®—å­æ›´å¯ç”¨ï¼ˆbetaç‰ˆæœ¬ï¼‰</a></li>
<li><a class="reference internal" href="#stable">2.1.3 ä½¿ç®—å­æ›´å¿«æ›´å®Œå¤‡ï¼ˆstableç‰ˆæœ¬ï¼‰</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id5">3. æ„å»ºè‡ªå·±çš„æ•°æ®èœè°±å’Œé…ç½®</a><ul>
<li><a class="reference internal" href="#id6">3.1 ä¸°å¯Œçš„é…ç½®æºå’Œç±»å‹æç¤º</a></li>
<li><a class="reference internal" href="#id7">3.2 å±‚æ¬¡åŒ–çš„é…ç½®å’Œå¸®åŠ©</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8">4. ä¾èµ–ç®¡ç†</a><ul>
<li><a class="reference internal" href="#uv">4.1 å®‰è£… uv</a></li>
<li><a class="reference internal" href="#id9">4.2 è™šæ‹Ÿç¯å¢ƒç®¡ç†</a></li>
<li><a class="reference internal" href="#id10">4.3 æ·»åŠ æ–°ä¾èµ–</a></li>
<li><a class="reference internal" href="#id11">4.4 å¼€å‘ç¯å¢ƒè®¾ç½®</a></li>
<li><a class="reference internal" href="#id12">4.5 å»¶è¿ŸåŠ è½½</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id13">5. æ–‡æ¡£è§„èŒƒ</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div>
<script src="../_static/documentation_options.js?v=2491dde2"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/translations.js?v=beaddf03"></script>
    </body>
</html>