# DataJuicer å®¹é”™å¤„ç†ä¸æ£€æŸ¥ç‚¹å’Œäº‹ä»¶æ—¥å¿—è®°å½•

æœ¬ç›®å½•åŒ…å«å…·æœ‰å…¨é¢æ£€æŸ¥ç‚¹ã€åˆ†åŒºå’Œäº‹ä»¶æ—¥å¿—è®°å½•åŠŸèƒ½çš„å®¹é”™ã€å¯æ¢å¤ DataJuicer å¤„ç†çš„å®ç°ã€‚

## ğŸš€ å·²å®ç°åŠŸèƒ½

### âœ… æ ¸å¿ƒåŠŸèƒ½
- **ä½œä¸šç‰¹å®šç›®å½•éš”ç¦»**: æ¯ä¸ªä½œä¸šéƒ½æœ‰è‡ªå·±ä¸“ç”¨çš„ç›®å½•ç»“æ„
- **çµæ´»å­˜å‚¨æ¶æ„**: äº‹ä»¶æ—¥å¿—ï¼ˆå¿«é€Ÿå­˜å‚¨ï¼‰å’Œæ£€æŸ¥ç‚¹ï¼ˆå¤§å®¹é‡å­˜å‚¨ï¼‰çš„ç‹¬ç«‹å­˜å‚¨è·¯å¾„
- **å¯é…ç½®æ£€æŸ¥ç‚¹ç­–ç•¥**: å¤šç§æ£€æŸ¥ç‚¹é¢‘ç‡å’Œç­–ç•¥
- **Spark é£æ ¼äº‹ä»¶æ—¥å¿—è®°å½•**: ç”¨äºå¯æ¢å¤æ€§çš„ JSONL æ ¼å¼å…¨é¢äº‹ä»¶è·Ÿè¸ª
- **ä½œä¸šæ¢å¤åŠŸèƒ½**: ä»æœ€åä¸€ä¸ªæ£€æŸ¥ç‚¹æ¢å¤å¤±è´¥æˆ–ä¸­æ–­çš„ä½œä¸š
- **å…¨é¢ä½œä¸šç®¡ç†**: ä½œä¸šæ‘˜è¦ã€å…ƒæ•°æ®è·Ÿè¸ªå’Œæ¢å¤å‘½ä»¤

### âœ… æ£€æŸ¥ç‚¹ç­–ç•¥
- `EVERY_OP`: æ¯ä¸ªæ“ä½œåæ£€æŸ¥ç‚¹ï¼ˆæœ€å®¹é”™ï¼Œè¾ƒæ…¢ï¼‰
- `EVERY_PARTITION`: ä»…åœ¨åˆ†åŒºå®Œæˆæ—¶æ£€æŸ¥ç‚¹ï¼ˆå¹³è¡¡ï¼‰
- `EVERY_N_OPS`: æ¯ N ä¸ªæ“ä½œåæ£€æŸ¥ç‚¹ï¼ˆå¯é…ç½®ï¼‰
- `MANUAL`: ä»…åœ¨æŒ‡å®šæ“ä½œåæ£€æŸ¥ç‚¹
- `DISABLED`: å®Œå…¨ç¦ç”¨æ£€æŸ¥ç‚¹

### âœ… äº‹ä»¶æ—¥å¿—è®°å½•
- **äººç±»å¯è¯»æ—¥å¿—**: åŸºäº Loguru çš„æ—¥å¿—è®°å½•ï¼Œç”¨äºè°ƒè¯•å’Œç›‘æ§
- **æœºå™¨å¯è¯»æ—¥å¿—**: JSONL æ ¼å¼ï¼Œç”¨äºç¨‹åºåŒ–åˆ†æå’Œæ¢å¤
- **å…¨é¢äº‹ä»¶ç±»å‹**: ä½œä¸šå¼€å§‹/å®Œæˆ/å¤±è´¥ã€åˆ†åŒºäº‹ä»¶ã€æ“ä½œäº‹ä»¶ã€æ£€æŸ¥ç‚¹äº‹ä»¶
- **å®æ—¶ç›‘æ§**: å®æ—¶äº‹ä»¶æµå’ŒçŠ¶æ€æŠ¥å‘Š

### âœ… ä½œä¸šç®¡ç†
- **æœ‰æ„ä¹‰çš„ä½œä¸š ID**: æ ¼å¼ï¼š`{YYYYMMDD}_{HHMMSS}_{config_name}_{unique_suffix}`
- **ä½œä¸šæ‘˜è¦æ–‡ä»¶**: æ¯ä¸ªä½œä¸šè¿è¡Œçš„å…¨é¢å…ƒæ•°æ®
- **æ¢å¤å‘½ä»¤**: è‡ªåŠ¨ç”Ÿæˆæ¢å¤ä½œä¸šçš„ç¡®åˆ‡å‘½ä»¤
- **ä½œä¸šéªŒè¯**: éªŒè¯ä½œä¸šæ¢å¤å‚æ•°å’Œç°æœ‰çŠ¶æ€

## ğŸ“ ç›®å½•ç»“æ„

```
{work_dir}/
â”œâ”€â”€ {job_id}/                    # ä½œä¸šç‰¹å®šç›®å½•
â”‚   â”œâ”€â”€ job_summary.json         # ä½œä¸šå…ƒæ•°æ®å’Œæ¢å¤ä¿¡æ¯
â”‚   â”œâ”€â”€ metadata/                # ä½œä¸šå…ƒæ•°æ®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ dataset_mapping.json
â”‚   â”‚   â””â”€â”€ final_mapping_report.json
â”‚   â”œâ”€â”€ partitions/              # è¾“å…¥æ•°æ®åˆ†åŒº
â”‚   â”œâ”€â”€ intermediate/            # ä¸­é—´å¤„ç†ç»“æœ
â”‚   â””â”€â”€ results/                 # æœ€ç»ˆå¤„ç†ç»“æœ
â”œâ”€â”€ {event_log_dir}/{job_id}/    # çµæ´»äº‹ä»¶æ—¥å¿—å­˜å‚¨
â”‚   â””â”€â”€ event_logs/
â”‚       â”œâ”€â”€ events.jsonl         # æœºå™¨å¯è¯»äº‹ä»¶
â”‚       â””â”€â”€ events.log           # äººç±»å¯è¯»æ—¥å¿—
â””â”€â”€ {checkpoint_dir}/{job_id}/   # çµæ´»æ£€æŸ¥ç‚¹å­˜å‚¨
    â”œâ”€â”€ checkpoint_*.json        # æ£€æŸ¥ç‚¹å…ƒæ•°æ®
    â””â”€â”€ partition_*_*.parquet    # åˆ†åŒºæ£€æŸ¥ç‚¹
```

## ğŸ› ï¸ é…ç½®

### é…ç½®ç»“æ„

é…ç½®ä½¿ç”¨**é€»è¾‘åµŒå¥—ç»“æ„**ï¼ŒæŒ‰å…³æ³¨ç‚¹åˆ†ç»„ç›¸å…³è®¾ç½®ï¼š

#### æ–°çš„é€»è¾‘ç»“æ„ï¼ˆæ¨èï¼‰
```yaml
# åˆ†åŒºé…ç½®
partition:
  size: 1000  # æ¯ä¸ªåˆ†åŒºçš„æ ·æœ¬æ•°
  max_size_mb: 64  # åˆ†åŒºæœ€å¤§å¤§å°ï¼ˆMBï¼‰

# å®¹é”™é…ç½®
fault_tolerance:
  enabled: true
  max_retries: 3
  retry_backoff: "exponential"  # exponential, linear, fixed

# ä¸­é—´å­˜å‚¨é…ç½®ï¼ˆæ ¼å¼ã€å‹ç¼©å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼‰
intermediate_storage:
  # æ–‡ä»¶æ ¼å¼å’Œå‹ç¼©
  format: "parquet"  # parquet, arrow, jsonl
  compression: "snappy"  # snappy, gzip, none
  use_arrow_batches: true
  arrow_batch_size: 500
  arrow_memory_mapping: false
  
  # æ–‡ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†
  preserve_intermediate_data: true  # ä¿ç•™ä¸´æ—¶æ–‡ä»¶ç”¨äºè°ƒè¯•/æ¢å¤
  cleanup_temp_files: true
  cleanup_on_success: false
  retention_policy: "keep_all"  # keep_all, keep_failed_only, cleanup_all
  max_retention_days: 7
```

#### ä¼ ç»Ÿæ‰å¹³ç»“æ„ï¼ˆä»æ”¯æŒï¼‰
```yaml
# ä¼ ç»Ÿæ‰å¹³é…ç½®ï¼ˆä»æœ‰æ•ˆï¼‰
partition_size: 1000
max_partition_size_mb: 64
enable_fault_tolerance: true
max_retries: 3
preserve_intermediate_data: true
storage_format: "parquet"
use_arrow_batches: true
arrow_batch_size: 500
arrow_memory_mapping: false
```

**æ³¨æ„**: ç³»ç»Ÿé¦–å…ˆä»æ–°çš„åµŒå¥—éƒ¨åˆ†è¯»å–ï¼Œå¦‚æœæœªæ‰¾åˆ°åˆ™å›é€€åˆ°ä¼ ç»Ÿæ‰å¹³é…ç½®ã€‚

### é…ç½®éƒ¨åˆ†è¯´æ˜

#### `partition` - åˆ†åŒºå’Œå®¹é”™
æ§åˆ¶æ•°æ®é›†å¦‚ä½•åˆ†å‰²ä»¥åŠå¦‚ä½•å¤„ç†æ•…éšœï¼š
- **è‡ªåŠ¨é…ç½®**ï¼ˆæ¨èï¼‰ï¼š
  - `auto_configure`: æ ¹æ®æ•°æ®æ¨¡æ€å¯ç”¨è‡ªåŠ¨åˆ†åŒºå¤§å°ä¼˜åŒ–
- **æ‰‹åŠ¨åˆ†åŒº**ï¼ˆå½“ `auto_configure: false` æ—¶ï¼‰ï¼š
  - `size`: æ¯ä¸ªåˆ†åŒºçš„æ ·æœ¬æ•°
    - **50-100**: è°ƒè¯•ã€å¿«é€Ÿè¿­ä»£ã€å°æ•°æ®é›†
    - **100-300**: ç”Ÿäº§ã€å®¹é”™å’Œæ•ˆç‡çš„è‰¯å¥½å¹³è¡¡ â­
    - **300-500**: å…·æœ‰ç¨³å®šå¤„ç†çš„å¤§æ•°æ®é›†
    - **500+**: ä»…é€‚ç”¨äºæ•…éšœé£é™©æœ€å°çš„å¤§æ•°æ®é›†
  - `max_size_mb`: åˆ†åŒºæœ€å¤§å¤§å°ï¼ˆMBï¼‰
- **å®¹é”™**ï¼š
  - `enable_fault_tolerance`: å¯ç”¨/ç¦ç”¨é‡è¯•é€»è¾‘
  - `max_retries`: æ¯ä¸ªåˆ†åŒºçš„æœ€å¤§é‡è¯•æ¬¡æ•°
  - `retry_backoff`: é‡è¯•ç­–ç•¥ï¼ˆ`exponential`ã€`linear`ã€`fixed`ï¼‰

#### `intermediate_storage` - ä¸­é—´æ•°æ®ç®¡ç†
æ§åˆ¶ä¸­é—´æ•°æ®çš„æ–‡ä»¶æ ¼å¼ã€å‹ç¼©å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š
- **æ–‡ä»¶æ ¼å¼å’Œå‹ç¼©**ï¼š
  - `format`: å­˜å‚¨æ ¼å¼ï¼ˆ`parquet`ã€`arrow`ã€`jsonl`ï¼‰
  - `compression`: å‹ç¼©ç®—æ³•ï¼ˆ`snappy`ã€`gzip`ã€`none`ï¼‰
  - `use_arrow_batches`: ä½¿ç”¨ Arrow æ‰¹å¤„ç†
  - `arrow_batch_size`: Arrow æ‰¹å¤§å°
  - `arrow_memory_mapping`: å¯ç”¨å†…å­˜æ˜ å°„
- **æ–‡ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼š
  - `preserve_intermediate_data`: ä¿ç•™ä¸´æ—¶æ–‡ä»¶ç”¨äºè°ƒè¯•
  - `cleanup_temp_files`: å¯ç”¨è‡ªåŠ¨æ¸…ç†
  - `cleanup_on_success`: å³ä½¿æˆåŠŸå®Œæˆä¹Ÿæ¸…ç†
  - `retention_policy`: æ–‡ä»¶ä¿ç•™ç­–ç•¥ï¼ˆ`keep_all`ã€`keep_failed_only`ã€`cleanup_all`ï¼‰
  - `max_retention_days`: X å¤©åè‡ªåŠ¨æ¸…ç†

### åŸºæœ¬é…ç½®
```yaml
# å¯ç”¨å®¹é”™å¤„ç†
executor_type: ray_partitioned

# ä½œä¸šç®¡ç†
job_id: my_experiment_001  # å¯é€‰ï¼šå¦‚æœæœªæä¾›åˆ™è‡ªåŠ¨ç”Ÿæˆ

# æ£€æŸ¥ç‚¹é…ç½®
checkpoint:
  enabled: true
  strategy: every_op  # every_op, every_partition, every_n_ops, manual, disabled
  n_ops: 2            # ç”¨äº every_n_ops ç­–ç•¥
  op_names:           # ç”¨äº manual ç­–ç•¥
    - clean_links_mapper
    - whitespace_normalization_mapper

# äº‹ä»¶æ—¥å¿—è®°å½•é…ç½®
event_logging:
  enabled: true
  max_log_size_mb: 100
  backup_count: 5

# çµæ´»å­˜å‚¨è·¯å¾„
event_log_dir: /tmp/fast_event_logs      # äº‹ä»¶æ—¥å¿—çš„å¿«é€Ÿå­˜å‚¨
checkpoint_dir: /tmp/large_checkpoints   # æ£€æŸ¥ç‚¹çš„å¤§å®¹é‡å­˜å‚¨

# åˆ†åŒºé…ç½®
partition:
  # åŸºæœ¬åˆ†åŒºè®¾ç½®
  # æ¨èåˆ†åŒºå¤§å°ï¼š
  # - 50-100: ç”¨äºè°ƒè¯•ã€å¿«é€Ÿè¿­ä»£ã€å°æ•°æ®é›†
  # - 100-300: ç”¨äºç”Ÿäº§ã€å®¹é”™å’Œæ•ˆç‡çš„è‰¯å¥½å¹³è¡¡
  # - 300-500: ç”¨äºå…·æœ‰ç¨³å®šå¤„ç†çš„å¤§æ•°æ®é›†
  # - 500+: ä»…é€‚ç”¨äºæ•…éšœé£é™©æœ€å°çš„å¤§æ•°æ®é›†
  size: 200  # æ¯ä¸ªåˆ†åŒºçš„æ ·æœ¬æ•°ï¼ˆè¾ƒå°ä»¥è·å¾—æ›´å¥½çš„å®¹é”™æ€§ï¼‰
  max_size_mb: 32  # åˆ†åŒºæœ€å¤§å¤§å°ï¼ˆMBï¼‰ï¼ˆå‡å°‘ä»¥åŠ å¿«å¤„ç†é€Ÿåº¦ï¼‰
  
  # å®¹é”™è®¾ç½®
  enable_fault_tolerance: true
  max_retries: 3
  retry_backoff: "exponential"  # exponential, linear, fixed

# ä¸­é—´å­˜å‚¨é…ç½®ï¼ˆæ ¼å¼ã€å‹ç¼©å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼‰
intermediate_storage:
  # æ–‡ä»¶æ ¼å¼å’Œå‹ç¼©
  format: "parquet"  # parquet, arrow, jsonl
  compression: "snappy"  # snappy, gzip, none
  use_arrow_batches: true
  arrow_batch_size: 500
  arrow_memory_mapping: false
  
  # æ–‡ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†
  preserve_intermediate_data: true  # ä¿ç•™ä¸´æ—¶æ–‡ä»¶ç”¨äºè°ƒè¯•/æ¢å¤
  cleanup_temp_files: true
  cleanup_on_success: false
  retention_policy: "keep_all"  # keep_all, keep_failed_only, cleanup_all
  max_retention_days: 7
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ç”¨æ³•
```bash
# ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ä½œä¸š ID è¿è¡Œ
dj-process --config configs/demo/checkpoint_config_example.yaml

# ä½¿ç”¨è‡ªå®šä¹‰ä½œä¸š ID è¿è¡Œ
dj-process --config configs/demo/checkpoint_config_example.yaml --job_id my_experiment_001
```

### 2. æ¢å¤ä½œä¸š
```bash
# ä½¿ç”¨ä½œä¸š ID æ¢å¤
dj-process --config configs/demo/checkpoint_config_example.yaml --job_id my_experiment_001
```

### 3. ä¸åŒçš„æ£€æŸ¥ç‚¹ç­–ç•¥
```bash
# æ¯ä¸ªåˆ†åŒºæ£€æŸ¥ç‚¹
dj-process --config configs/demo/checkpoint_config_example.yaml --job_id partition_test --checkpoint.strategy every_partition

# æ¯ 3 ä¸ªæ“ä½œæ£€æŸ¥ç‚¹
dj-process --config configs/demo/checkpoint_config_example.yaml --job_id n_ops_test --checkpoint.strategy every_n_ops --checkpoint.n_ops 3

# æ‰‹åŠ¨æ£€æŸ¥ç‚¹
dj-process --config configs/demo/checkpoint_config_example.yaml --job_id manual_test --checkpoint.strategy manual --checkpoint.op_names clean_links_mapper,whitespace_normalization_mapper
```

### 4. è¿è¡Œç»¼åˆæ¼”ç¤º
```bash
# è¿è¡Œå±•ç¤ºæ‰€æœ‰åŠŸèƒ½çš„å®Œæ•´æ¼”ç¤º
python demos/partition_and_checkpoint/run_comprehensive_demo.py
```

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹ä½œä¸šä¿¡æ¯
```bash
# æ£€æŸ¥ä½œä¸šæ‘˜è¦
cat ./outputs/demo-checkpoint-strategies/{job_id}/job_summary.json

# æŸ¥çœ‹äº‹ä»¶æ—¥å¿—
cat /tmp/fast_event_logs/{job_id}/event_logs/events.jsonl

# æŸ¥çœ‹äººç±»å¯è¯»æ—¥å¿—
cat /tmp/fast_event_logs/{job_id}/event_logs/events.log
```

### åˆ—å‡ºå¯ç”¨ä½œä¸š
```bash
# åˆ—å‡ºæ‰€æœ‰ä½œä¸šç›®å½•
ls -la ./outputs/demo-checkpoint-strategies/
```

### æ£€æŸ¥çµæ´»å­˜å‚¨
```bash
# æ£€æŸ¥å¿«é€Ÿå­˜å‚¨ä¸­çš„äº‹ä»¶æ—¥å¿—
ls -la /tmp/fast_event_logs/

# æ£€æŸ¥å¤§å®¹é‡å­˜å‚¨ä¸­çš„æ£€æŸ¥ç‚¹
ls -la /tmp/large_checkpoints/
```

## ğŸ“ˆ ä½œä¸šç®¡ç†å·¥å…·

DataJuicer æä¾›å…¨é¢çš„ä½œä¸šç®¡ç†å·¥å…·ï¼Œç”¨äºç›‘æ§è¿›åº¦å’Œåœæ­¢æ­£åœ¨è¿è¡Œçš„ä½œä¸šã€‚è¿™äº›å·¥å…·ä½äº `data_juicer/utils/job/` ä¸­ï¼Œæä¾›å‘½ä»¤è¡Œå’Œç¨‹åºåŒ–æ¥å£ã€‚

### ğŸ“Š ä½œä¸šè¿›åº¦ç›‘æ§å™¨

ä¸€ä¸ªå…¨é¢çš„å·¥å…·ï¼Œç”¨äºç›‘æ§å’Œæ˜¾ç¤º DataJuicer ä½œä¸šçš„è¿›åº¦ä¿¡æ¯ã€‚æ˜¾ç¤ºåˆ†åŒºçŠ¶æ€ã€æ“ä½œè¿›åº¦ã€æ£€æŸ¥ç‚¹å’Œæ•´ä½“ä½œä¸šæŒ‡æ ‡ã€‚

#### åŠŸèƒ½ç‰¹æ€§

- **å®æ—¶è¿›åº¦è·Ÿè¸ª**: ç›‘æ§å…·æœ‰åˆ†åŒºçº§è¯¦ç»†ä¿¡æ¯çš„ä½œä¸šè¿›åº¦
- **æ“ä½œæ€§èƒ½**: æŸ¥çœ‹è¯¦ç»†çš„æ“ä½œæŒ‡æ ‡ï¼ŒåŒ…æ‹¬ååé‡å’Œæ•°æ®å‡å°‘
- **æ£€æŸ¥ç‚¹ç›‘æ§**: è·Ÿè¸ªæ£€æŸ¥ç‚¹ä¿å­˜å’Œæ¢å¤ç‚¹
- **ç›‘è§†æ¨¡å¼**: è¿ç»­ç›‘æ§ä½œä¸šï¼Œè‡ªåŠ¨æ›´æ–°
- **ç¨‹åºåŒ–è®¿é—®**: ä½œä¸º Python å‡½æ•°ä½¿ç”¨ï¼Œé›†æˆåˆ°å…¶ä»–å·¥å…·ä¸­

#### å‘½ä»¤è¡Œç”¨æ³•

##### åŸºæœ¬ç”¨æ³•
```bash
# æ˜¾ç¤ºä½œä¸šçš„åŸºæœ¬è¿›åº¦
python -m data_juicer.utils.job.monitor 20250728_233517_510abf

# æ˜¾ç¤ºè¯¦ç»†è¿›åº¦å’Œæ“ä½œæŒ‡æ ‡
python -m data_juicer.utils.job.monitor 20250728_233517_510abf --detailed

# ç›‘è§†æ¨¡å¼ - æ¯ 10 ç§’è¿ç»­æ›´æ–°è¿›åº¦
python -m data_juicer.utils.job.monitor 20250728_233517_510abf --watch

# ç›‘è§†æ¨¡å¼ï¼Œè‡ªå®šä¹‰æ›´æ–°é—´éš”ï¼ˆ30 ç§’ï¼‰
python -m data_juicer.utils.job.monitor 20250728_233517_510abf --watch --interval 30

# ä½¿ç”¨è‡ªå®šä¹‰åŸºç¡€ç›®å½•
python -m data_juicer.utils.job.monitor 20250728_233517_510abf --base-dir /custom/path
```

##### å‘½ä»¤è¡Œé€‰é¡¹
- `job_id`: è¦ç›‘æ§çš„ä½œä¸š IDï¼ˆå¿…éœ€ï¼‰
- `--base-dir`: åŒ…å«ä½œä¸šè¾“å‡ºçš„åŸºç¡€ç›®å½•ï¼ˆé»˜è®¤ï¼š`outputs/partition-checkpoint-eventlog`ï¼‰
- `--detailed`: æ˜¾ç¤ºè¯¦ç»†çš„æ“ä½œä¿¡æ¯
- `--watch`: ç›‘è§†æ¨¡å¼ - è¿ç»­æ›´æ–°è¿›åº¦
- `--interval`: ç›‘è§†æ¨¡å¼çš„æ›´æ–°é—´éš”ï¼ˆç§’ï¼‰ï¼ˆé»˜è®¤ï¼š10ï¼‰

#### Python API

##### åŸºæœ¬å‡½æ•°ç”¨æ³•
```python
from data_juicer.utils.job.monitor import show_job_progress

# æ˜¾ç¤ºè¿›åº¦å¹¶è·å–æ•°æ®
data = show_job_progress("20250728_233517_510abf")

# æ˜¾ç¤ºè¯¦ç»†è¿›åº¦
data = show_job_progress("20250728_233517_510abf", detailed=True)

# ä½¿ç”¨è‡ªå®šä¹‰åŸºç¡€ç›®å½•
data = show_job_progress("20250728_233517_510abf", base_dir="/custom/path")
```

##### åŸºäºç±»çš„ç”¨æ³•
```python
from data_juicer.utils.job.monitor import JobProgressMonitor

# åˆ›å»ºç›‘æ§å™¨å®ä¾‹
monitor = JobProgressMonitor("20250728_233517_510abf")

# æ˜¾ç¤ºè¿›åº¦
monitor.display_progress(detailed=True)

# è·å–è¿›åº¦æ•°æ®ä½œä¸ºå­—å…¸
data = monitor.get_progress_data()

# è®¿é—®ç‰¹å®šä¿¡æ¯
job_status = data['overall_progress']['job_status']
progress_percentage = data['overall_progress']['progress_percentage']
partition_status = data['partition_status']
```

### ğŸ›‘ ä½œä¸šåœæ­¢å™¨

ä¸€ä¸ªå·¥å…·ï¼Œé€šè¿‡è¯»å–äº‹ä»¶æ—¥å¿—æ¥æŸ¥æ‰¾è¿›ç¨‹å’Œçº¿ç¨‹ IDï¼Œç„¶åç»ˆæ­¢è¿™äº›ç‰¹å®šçš„è¿›ç¨‹å’Œçº¿ç¨‹æ¥åœæ­¢æ­£åœ¨è¿è¡Œçš„ DataJuicer ä½œä¸šã€‚

#### åŠŸèƒ½ç‰¹æ€§

- **ç²¾ç¡®è¿›ç¨‹ç»ˆæ­¢**: ä½¿ç”¨äº‹ä»¶æ—¥å¿—è¯†åˆ«è¦ç»ˆæ­¢çš„ç¡®åˆ‡è¿›ç¨‹å’Œçº¿ç¨‹
- **ä¼˜é›…å…³é—­**: é¦–å…ˆå‘é€ SIGTERM è¿›è¡Œä¼˜é›…å…³é—­ï¼Œç„¶ååœ¨éœ€è¦æ—¶å‘é€ SIGKILL
- **å®‰å…¨æ£€æŸ¥**: åœ¨åœæ­¢å‰éªŒè¯ä½œä¸šå­˜åœ¨æ€§å’Œè¿è¡ŒçŠ¶æ€
- **å…¨é¢æ—¥å¿—è®°å½•**: ç»ˆæ­¢è¿‡ç¨‹çš„è¯¦ç»†æ—¥å¿—è®°å½•
- **ç¨‹åºåŒ–è®¿é—®**: å¯ä»¥ä½œä¸º Python å‡½æ•°æˆ–å‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨

#### å‘½ä»¤è¡Œç”¨æ³•

##### åŸºæœ¬ç”¨æ³•
```bash
# ä¼˜é›…åœ°åœæ­¢ä½œä¸šï¼ˆSIGTERMï¼‰
python -m data_juicer.utils.job.stopper 20250728_233517_510abf

# å¼ºåˆ¶åœæ­¢ä½œä¸šï¼ˆSIGKILLï¼‰
python -m data_juicer.utils.job.stopper 20250728_233517_510abf --force

# ä½¿ç”¨è‡ªå®šä¹‰è¶…æ—¶åœæ­¢ï¼ˆ60 ç§’ï¼‰
python -m data_juicer.utils.job.stopper 20250728_233517_510abf --timeout 60

# ä½¿ç”¨è‡ªå®šä¹‰åŸºç¡€ç›®å½•
python -m data_juicer.utils.job.stopper 20250728_233517_510abf --base-dir /custom/path

# åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ä½œä¸š
python -m data_juicer.utils.job.stopper --list
```

##### å‘½ä»¤è¡Œé€‰é¡¹
- `job_id`: è¦åœæ­¢çš„ä½œä¸š IDï¼ˆå¿…éœ€ï¼Œé™¤éä½¿ç”¨ --listï¼‰
- `--base-dir`: åŒ…å«ä½œä¸šè¾“å‡ºçš„åŸºç¡€ç›®å½•ï¼ˆé»˜è®¤ï¼š`outputs/partition-checkpoint-eventlog`ï¼‰
- `--force`: ä½¿ç”¨ SIGKILL å¼ºåˆ¶æ€æ­»è€Œä¸æ˜¯ä¼˜é›…çš„ SIGTERM
- `--timeout`: ä¼˜é›…å…³é—­çš„è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼ˆé»˜è®¤ï¼š30ï¼‰
- `--list`: åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ä½œä¸šè€Œä¸æ˜¯åœæ­¢ä¸€ä¸ª

#### Python API

##### åŸºæœ¬å‡½æ•°ç”¨æ³•
```python
from data_juicer.utils.job.stopper import stop_job

# ä¼˜é›…åœ°åœæ­¢ä½œä¸š
result = stop_job("20250728_233517_510abf")

# å¼ºåˆ¶åœæ­¢ä½œä¸š
result = stop_job("20250728_233517_510abf", force=True)

# ä½¿ç”¨è‡ªå®šä¹‰è¶…æ—¶åœæ­¢
result = stop_job("20250728_233517_510abf", timeout=60)

# ä½¿ç”¨è‡ªå®šä¹‰åŸºç¡€ç›®å½•
result = stop_job("20250728_233517_510abf", base_dir="/custom/path")
```

##### åŸºäºç±»çš„ç”¨æ³•
```python
from data_juicer.utils.job.stopper import JobStopper

# åˆ›å»ºåœæ­¢å™¨å®ä¾‹
stopper = JobStopper("20250728_233517_510abf")

# åœæ­¢ä½œä¸š
result = stopper.stop_job(force=False, timeout=30)

# æ£€æŸ¥ä½œä¸šæ˜¯å¦æ­£åœ¨è¿è¡Œ
is_running = stopper.is_job_running()

# è·å–ä½œä¸šæ‘˜è¦
summary = stopper.get_job_summary()
```

### ğŸ”§ é€šç”¨å·¥å…·

ç›‘æ§å™¨å’Œåœæ­¢å™¨å·¥å…·éƒ½é€šè¿‡ `data_juicer.utils.job.common` å…±äº«é€šç”¨åŠŸèƒ½ï¼š

```python
from data_juicer.utils.job.common import JobUtils, list_running_jobs

# åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ä½œä¸š
running_jobs = list_running_jobs()

# åˆ›å»ºä½œä¸šå·¥å…·å®ä¾‹
job_utils = JobUtils("20250728_233517_510abf")

# åŠ è½½ä½œä¸šæ‘˜è¦
summary = job_utils.load_job_summary()

# åŠ è½½äº‹ä»¶æ—¥å¿—
events = job_utils.load_event_logs()

# è·å–åˆ†åŒºçŠ¶æ€
partition_status = job_utils.get_partition_status()
```

### è¾“å‡ºä¿¡æ¯

#### ä½œä¸šæ¦‚è§ˆ
- ä½œä¸šçŠ¶æ€ï¼ˆå·²å®Œæˆã€å¤„ç†ä¸­ã€å¤±è´¥ç­‰ï¼‰
- æ•°æ®é›†è·¯å¾„å’Œå¤§å°
- åˆ†åŒºé…ç½®
- å¼€å§‹æ—¶é—´å’ŒæŒç»­æ—¶é—´

#### æ•´ä½“è¿›åº¦
- è¿›åº¦ç™¾åˆ†æ¯”
- åˆ†åŒºå®ŒæˆçŠ¶æ€
- æ ·æœ¬å¤„ç†è®¡æ•°
- ä¼°è®¡å‰©ä½™æ—¶é—´ï¼ˆå¯¹äºè¿è¡Œä¸­çš„ä½œä¸šï¼‰

#### åˆ†åŒºçŠ¶æ€
- å¸¦æœ‰è§†è§‰æŒ‡ç¤ºå™¨çš„å•ä¸ªåˆ†åŒºçŠ¶æ€
- æ¯ä¸ªåˆ†åŒºçš„æ ·æœ¬è®¡æ•°
- å½“å‰æ“ä½œï¼ˆå¦‚æœæ­£åœ¨å¤„ç†ï¼‰
- å·²å®Œæˆæ“ä½œçš„æ•°é‡
- å·²ä¿å­˜æ£€æŸ¥ç‚¹çš„æ•°é‡

#### æ“ä½œè¯¦æƒ…ï¼ˆä½¿ç”¨ --detailed æ ‡å¿—ï¼‰
- æ¯ä¸ªåˆ†åŒºçš„æ“ä½œæ€§èƒ½
- æŒç»­æ—¶é—´ã€ååé‡å’Œæ•°æ®å‡å°‘æŒ‡æ ‡
- æ“ä½œå®Œæˆé¡ºåº

#### æ£€æŸ¥ç‚¹æ‘˜è¦
- å·²ä¿å­˜æ£€æŸ¥ç‚¹çš„æ€»æ•°
- æŒ‰åˆ†åŒºå’Œæ“ä½œçš„æ£€æŸ¥ç‚¹è¯¦æƒ…
- æ—¶é—´æˆ³ä¿¡æ¯

### ç¤ºä¾‹è¾“å‡º

```
================================================================================
DataJuicer ä½œä¸šè¿›åº¦ç›‘æ§å™¨
ä½œä¸š ID: 20250728_233517_510abf
================================================================================

ğŸ“Š ä½œä¸šæ¦‚è§ˆ
   çŠ¶æ€: å·²å®Œæˆ
   æ•°æ®é›†: /Users/yilei.z/Downloads/c4-train.00000-of-01024.jsonl
   æ€»æ ·æœ¬æ•°: 356,317
   åˆ†åŒºå¤§å°: 50,000 æ ·æœ¬
   å¼€å§‹æ—¶é—´: 2025-07-28 16:35:18
   æŒç»­æ—¶é—´: 441.1 ç§’

ğŸ¯ æ•´ä½“è¿›åº¦
   è¿›åº¦: 100.0% (8/8 åˆ†åŒº)
   çŠ¶æ€: 8 å·²å®Œæˆ, 0 å¤„ç†ä¸­, 0 å¤±è´¥
   æ ·æœ¬: 356,317/356,317

ğŸ“¦ åˆ†åŒºçŠ¶æ€
   åˆ†åŒº  0: âœ… å·²å®Œæˆ
              æ ·æœ¬: 44,539
              å·²å®Œæˆ: 8 ä¸ªæ“ä½œ
              æ£€æŸ¥ç‚¹: 2 ä¸ªå·²ä¿å­˜
   åˆ†åŒº  1: âœ… å·²å®Œæˆ
              æ ·æœ¬: 44,540
              å·²å®Œæˆ: 8 ä¸ªæ“ä½œ
              æ£€æŸ¥ç‚¹: 2 ä¸ªå·²ä¿å­˜
   ...

ğŸ’¾ æ£€æŸ¥ç‚¹æ‘˜è¦
   æ€»æ£€æŸ¥ç‚¹: 16
```

### é›†æˆç¤ºä¾‹

#### ç›‘æ§å¤šä¸ªä½œä¸š
```python
from data_juicer.utils.job.monitor import show_job_progress

job_ids = ["job1", "job2", "job3"]
for job_id in job_ids:
    try:
        data = show_job_progress(job_id)
        print(f"ä½œä¸š {job_id}: {data['overall_progress']['progress_percentage']:.1f}%")
    except FileNotFoundError:
        print(f"ä½œä¸š {job_id}: æœªæ‰¾åˆ°")
```

#### è‡ªå®šä¹‰ç›‘æ§è„šæœ¬
```python
from data_juicer.utils.job.monitor import JobProgressMonitor
import time

def monitor_job_until_completion(job_id, check_interval=30):
    monitor = JobProgressMonitor(job_id)
    
    while True:
        data = monitor.get_progress_data()
        status = data['overall_progress']['job_status']
        
        if status == 'completed':
            print(f"ä½œä¸š {job_id} å·²å®Œæˆï¼")
            break
        elif status == 'failed':
            print(f"ä½œä¸š {job_id} å¤±è´¥ï¼")
            break
        
        print(f"ä½œä¸š {job_id} ä»åœ¨è¿è¡Œ... {data['overall_progress']['progress_percentage']:.1f}%")
        time.sleep(check_interval)
```

#### ä½œä¸šç®¡ç†å·¥ä½œæµ
```python
from data_juicer.utils.job.monitor import show_job_progress
from data_juicer.utils.job.stopper import stop_job
from data_juicer.utils.job.common import list_running_jobs

# åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ä½œä¸š
running_jobs = list_running_jobs()
print(f"å‘ç° {len(running_jobs)} ä¸ªæ­£åœ¨è¿è¡Œçš„ä½œä¸š")

# ç›‘æ§å¹¶å¯èƒ½åœæ­¢ä½œä¸š
for job_info in running_jobs:
    job_id = job_info['job_id']
    
    # æ£€æŸ¥è¿›åº¦
    try:
        data = show_job_progress(job_id)
        progress = data['overall_progress']['progress_percentage']
        
        # åœæ­¢å¡ä½çš„ä½œä¸šï¼ˆ1å°æ—¶åè¿›åº¦ä»å°‘äº10%ï¼‰
        if progress < 10 and data['overall_progress']['elapsed_time_seconds'] > 3600:
            print(f"åœæ­¢å¡ä½çš„ä½œä¸š {job_id}ï¼ˆè¿›åº¦: {progress:.1f}%ï¼‰")
            stop_job(job_id, force=True)
        else:
            print(f"ä½œä¸š {job_id}: {progress:.1f}% å®Œæˆ")
            
    except Exception as e:
        print(f"ç›‘æ§ä½œä¸š {job_id} æ—¶å‡ºé”™: {e}")
```

## ğŸ¤– è‡ªåŠ¨é…ç½®ç³»ç»Ÿ

### **æŒ‰æ¨¡æ€æ™ºèƒ½åˆ†åŒºå¤§å°è°ƒæ•´**

DataJuicer ç°åœ¨åŒ…å«ä¸€ä¸ªæ™ºèƒ½è‡ªåŠ¨é…ç½®ç³»ç»Ÿï¼Œå¯ä»¥æ ¹æ®æ‚¨çš„æ•°æ®ç‰¹å¾è‡ªåŠ¨ç¡®å®šæœ€ä½³åˆ†åŒºå¤§å°ï¼š

#### **å·¥ä½œåŸç†**

1. **æ¨¡æ€æ£€æµ‹**: åˆ†ææ‚¨çš„æ•°æ®é›†ä»¥æ£€æµ‹ä¸»è¦æ¨¡æ€ï¼ˆæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ã€å¤šæ¨¡æ€ï¼‰
2. **æ•°æ®é›†åˆ†æ**: æ£€æŸ¥æ ·æœ¬ç‰¹å¾ï¼ˆæ–‡æœ¬é•¿åº¦ã€åª’ä½“æ•°é‡ã€æ–‡ä»¶å¤§å°ï¼‰
3. **ç®¡é“å¤æ‚æ€§**: è€ƒè™‘å¤„ç†æ“ä½œçš„å¤æ‚æ€§
4. **èµ„æºä¼˜åŒ–**: è°ƒæ•´åˆ†åŒºå¤§å°ä»¥è·å¾—æœ€ä½³å†…å­˜ä½¿ç”¨å’Œå®¹é”™æ€§

#### **æ¨¡æ€ç‰¹å®šä¼˜åŒ–**

| æ¨¡æ€ | é»˜è®¤å¤§å° | æœ€å¤§å¤§å° | å†…å­˜å€æ•° | ä½¿ç”¨åœºæ™¯ |
|------|----------|----------|----------|----------|
| **æ–‡æœ¬** | 200 æ ·æœ¬ | 1000 | 1.0x | é«˜æ•ˆå¤„ç†ï¼Œä½å†…å­˜ |
| **å›¾åƒ** | 50 æ ·æœ¬ | 200 | 5.0x | ä¸­ç­‰å†…å­˜ï¼Œå›¾åƒå¤„ç† |
| **éŸ³é¢‘** | 30 æ ·æœ¬ | 100 | 8.0x | é«˜å†…å­˜ï¼ŒéŸ³é¢‘å¤„ç† |
| **è§†é¢‘** | 10 æ ·æœ¬ | 50 | 20.0x | æé«˜å†…å­˜ï¼Œå¤æ‚å¤„ç† |
| **å¤šæ¨¡æ€** | 20 æ ·æœ¬ | 100 | 10.0x | å¤šç§æ¨¡æ€ï¼Œä¸­ç­‰å¤æ‚æ€§ |

#### **å¯ç”¨è‡ªåŠ¨é…ç½®**

```yaml
partition:
  auto_configure: true  # å¯ç”¨è‡ªåŠ¨ä¼˜åŒ–
  # å½“ auto_configure ä¸º true æ—¶å¿½ç•¥æ‰‹åŠ¨è®¾ç½®
  size: 200
  max_size_mb: 32
```

#### **æ‰‹åŠ¨è¦†ç›–**

```yaml
partition:
  auto_configure: false  # ç¦ç”¨è‡ªåŠ¨é…ç½®
  size: 100  # ä½¿ç”¨æ‚¨è‡ªå·±çš„åˆ†åŒºå¤§å°
  max_size_mb: 64
```

## ğŸ“Š åˆ†åŒºå¤§å°æŒ‡å—

### **ä¸ºä»€ä¹ˆè¾ƒå°çš„åˆ†åŒºæ›´å¥½**

**å®¹é”™æ€§**: è¾ƒå°çš„åˆ†åŒºæ„å‘³ç€è¾ƒå°çš„æ•…éšœå•å…ƒã€‚å¦‚æœåˆ†åŒºå¤±è´¥ï¼Œæ‚¨æŸå¤±çš„å·¥ä½œæ›´å°‘ã€‚

**æ¢å¤é€Ÿåº¦**: å¤±è´¥çš„åˆ†åŒºå¯ä»¥æ›´å¿«åœ°é‡è¯•ï¼Œå‡å°‘æ€»ä½“ä½œä¸šæ—¶é—´ã€‚

**è¿›åº¦å¯è§æ€§**: æ›´ç»†ç²’åº¦çš„è¿›åº¦è·Ÿè¸ªå’Œæ›´å¿«çš„åé¦ˆã€‚

**å†…å­˜æ•ˆç‡**: æ¯ä¸ªåˆ†åŒºæ›´ä½çš„å†…å­˜ä½¿ç”¨ï¼Œæ›´é€‚åˆèµ„æºå—é™çš„ç¯å¢ƒã€‚

**è°ƒè¯•**: æ›´å®¹æ˜“éš”ç¦»å’Œè°ƒè¯•è¾ƒå°å—ä¸­çš„é—®é¢˜ã€‚

### **åˆ†åŒºå¤§å°å»ºè®®**

| ä½¿ç”¨åœºæ™¯ | åˆ†åŒºå¤§å° | ä½•æ—¶ä½¿ç”¨ |
|----------|----------|----------|
| **è°ƒè¯•** | 50-100 æ ·æœ¬ | å¿«é€Ÿè¿­ä»£ã€æµ‹è¯•ã€å°æ•°æ®é›† |
| **ç”Ÿäº§** â­ | 100-300 æ ·æœ¬ | å¤§å¤šæ•°ç”¨ä¾‹ï¼Œè‰¯å¥½å¹³è¡¡ |
| **å¤§æ•°æ®é›†** | 300-500 æ ·æœ¬ | ç¨³å®šå¤„ç†ï¼Œå¤§æ•°æ®é›† |
| **è¶…å¤§** | 500+ æ ·æœ¬ | ä»…åœ¨æ•…éšœé£é™©æœ€å°æ—¶ |

### **éœ€è¦è€ƒè™‘çš„å› ç´ **

- **æ•°æ®é›†å¤§å°**: è¾ƒå¤§çš„æ•°æ®é›†å¯ä»¥ä½¿ç”¨è¾ƒå¤§çš„åˆ†åŒº
- **å¤„ç†å¤æ‚æ€§**: å¤æ‚æ“ä½œå—ç›Šäºè¾ƒå°çš„åˆ†åŒº
- **æ•…éšœç‡**: è¾ƒé«˜çš„æ•…éšœç‡éœ€è¦è¾ƒå°çš„åˆ†åŒº
- **å†…å­˜çº¦æŸ**: æœ‰é™çš„å†…å­˜éœ€è¦è¾ƒå°çš„åˆ†åŒº
- **æ—¶é—´æ•æ„Ÿæ€§**: æ›´å¿«çš„åé¦ˆéœ€è¦è¾ƒå°çš„åˆ†åŒº

## ğŸ”§ å®ç°ç»†èŠ‚

### æ ¸å¿ƒç»„ä»¶

1. **`EventLoggingMixin`** (`data_juicer/core/executor/event_logging_mixin.py`)
   - ä¸ºæ‰§è¡Œå™¨æä¾›äº‹ä»¶æ—¥å¿—è®°å½•åŠŸèƒ½
   - ç®¡ç†ä½œä¸šç‰¹å®šç›®å½•å’Œçµæ´»å­˜å‚¨
   - å¤„ç†ä½œä¸šæ‘˜è¦åˆ›å»ºå’ŒéªŒè¯
   - å®ç° Spark é£æ ¼äº‹ä»¶æ—¥å¿—è®°å½•æ¨¡å¼

2. **`PartitionedRayExecutor`** (`data_juicer/core/executor/ray_executor_partitioned.py`)
   - ä½¿ç”¨åˆ†åŒºå’Œå®¹é”™æ‰©å±• Ray æ‰§è¡Œå™¨
   - å®ç°å¯é…ç½®æ£€æŸ¥ç‚¹ç­–ç•¥
   - ä¸ EventLoggingMixin é›†æˆä»¥è¿›è¡Œå…¨é¢æ—¥å¿—è®°å½•
   - å¤„ç†ä»æ£€æŸ¥ç‚¹æ¢å¤ä½œä¸š

3. **é…ç½®é›†æˆ** (`data_juicer/config/config.py`)
   - æ·»åŠ äº†ä½œä¸šç®¡ç†çš„å‘½ä»¤è¡Œå‚æ•°
   - æ·»åŠ äº†æ£€æŸ¥ç‚¹é…ç½®é€‰é¡¹
   - æ·»åŠ äº†çµæ´»å­˜å‚¨è·¯å¾„é…ç½®

### äº‹ä»¶ç±»å‹
- `JOB_START`, `JOB_COMPLETE`, `JOB_FAILED`
- `PARTITION_START`, `PARTITION_COMPLETE`, `PARTITION_FAILED`
- `OP_START`, `OP_COMPLETE`, `OP_FAILED`
- `CHECKPOINT_SAVE`, `CHECKPOINT_LOAD`
- `PROCESSING_START`, `PROCESSING_COMPLETE`, `PROCESSING_ERROR`
- `RESOURCE_USAGE`, `PERFORMANCE_METRIC`
- `WARNING`, `INFO`, `DEBUG`

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. å¤§æ•°æ®é›†å¤„ç†
- å¤„ç†å¯¹äºå†…å­˜æ¥è¯´å¤ªå¤§çš„æ•°æ®é›†
- å…·æœ‰å®¹é”™çš„è‡ªåŠ¨åˆ†åŒº
- æ•…éšœåæ¢å¤å¤„ç†

### 2. å®éªŒå·¥ä½œæµ
- ä½¿ç”¨æœ‰æ„ä¹‰çš„ä½œä¸š ID è·Ÿè¸ªä¸åŒå®éªŒ
- æ¯”è¾ƒä¸åŒé…ç½®çš„ç»“æœ
- ç»´æŠ¤å®éªŒå†å²å’Œå¯é‡ç°æ€§

### 3. ç”Ÿäº§ç®¡é“
- å¼ºå¤§çš„é”™è¯¯å¤„ç†å’Œæ¢å¤
- å…¨é¢ç›‘æ§å’Œæ—¥å¿—è®°å½•
- ä¸åŒæ€§èƒ½è¦æ±‚çš„çµæ´»å­˜å‚¨

### 4. ç ”ç©¶å’Œå¼€å‘
- å…·æœ‰æ£€æŸ¥ç‚¹æ¢å¤çš„è¿­ä»£å¼€å‘
- ç”¨äºåˆ†æçš„è¯¦ç»†äº‹ä»¶æ—¥å¿—è®°å½•
- ä¸åŒåœºæ™¯çš„å¯é…ç½®æ£€æŸ¥ç‚¹

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ä½œä¸šæ¢å¤å¤±è´¥**
   - æ£€æŸ¥ä½œä¸šæ‘˜è¦æ˜¯å¦å­˜åœ¨ï¼š`ls -la ./outputs/{work_dir}/{job_id}/job_summary.json`
   - éªŒè¯æ£€æŸ¥ç‚¹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š`ls -la /tmp/large_checkpoints/{job_id}/`

2. **æ‰¾ä¸åˆ°äº‹ä»¶æ—¥å¿—**
   - æ£€æŸ¥çµæ´»å­˜å‚¨è·¯å¾„ï¼š`ls -la /tmp/fast_event_logs/{job_id}/`
   - éªŒè¯é…ç½®ä¸­æ˜¯å¦å¯ç”¨äº†äº‹ä»¶æ—¥å¿—è®°å½•

3. **æ£€æŸ¥ç‚¹ä¸å·¥ä½œ**
   - éªŒè¯é…ç½®ä¸­çš„æ£€æŸ¥ç‚¹ç­–ç•¥
   - æ£€æŸ¥æ£€æŸ¥ç‚¹ç›®å½•æ˜¯å¦å¯å†™
   - ç¡®ä¿ checkpoint.enabled ä¸º true

4. **æ€§èƒ½é—®é¢˜**
   - æ ¹æ®å¯ç”¨å†…å­˜è°ƒæ•´åˆ†åŒºå¤§å°
   - è€ƒè™‘ä¸åŒçš„æ£€æŸ¥ç‚¹ç­–ç•¥
   - ä½¿ç”¨é€‚å½“çš„å­˜å‚¨æ ¼å¼ï¼ˆå¤§æ•°æ®é›†ä½¿ç”¨ parquetï¼‰

### è°ƒè¯•å‘½ä»¤
```bash
# æ£€æŸ¥ Ray é›†ç¾¤çŠ¶æ€
ray status

# æŸ¥çœ‹ Ray ä»ªè¡¨æ¿
open http://localhost:8265

# æ£€æŸ¥ DataJuicer æ—¥å¿—
tail -f /tmp/fast_event_logs/{job_id}/event_logs/events.log
```

## ğŸ“Š ç†è§£ä¸­é—´æ•°æ®

### ä»€ä¹ˆæ˜¯ä¸­é—´æ•°æ®ï¼Ÿ

ä¸­é—´æ•°æ®æ˜¯æŒ‡åœ¨å¤„ç†ç®¡é“æœŸé—´ç”Ÿæˆçš„ä¸´æ—¶ç»“æœï¼Œå­˜åœ¨äºæ“ä½œä¹‹é—´å’Œæœ€ç»ˆè¾“å‡ºä¹‹å‰ã€‚åœ¨ DataJuicer çš„åˆ†åŒºå¤„ç†ä¸­ï¼Œè¿™åŒ…æ‹¬ï¼š

1. **åˆ†åŒºçº§ä¸­é—´æ•°æ®**: åˆ†åŒºå†…æ¯ä¸ªæ“ä½œåçš„ç»“æœ
2. **æ“ä½œçº§ä¸­é—´æ•°æ®**: æ“ä½œä¹‹é—´å­˜åœ¨çš„æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œåœ¨ `clean_links_mapper` ä¹‹åä½†åœ¨ `whitespace_normalization_mapper` ä¹‹å‰ï¼‰
3. **æ£€æŸ¥ç‚¹ä¸­é—´æ•°æ®**: æ£€æŸ¥ç‚¹æœŸé—´åˆ›å»ºçš„ä¸´æ—¶æ–‡ä»¶

### ä½•æ—¶ä¿ç•™ä¸­é—´æ•°æ®

**å½“æ‚¨éœ€è¦ä»¥ä¸‹åŠŸèƒ½æ—¶å¯ç”¨ `preserve_intermediate_data: true`ï¼š**
- **è°ƒè¯•**: æ£€æŸ¥æ¯ä¸ªæ“ä½œåæ•°æ®çš„æ ·è²Œ
- **æ¢å¤**: å¦‚æœä½œä¸šå¤±è´¥ï¼ŒæŸ¥çœ‹ç¡®åˆ‡å¤±è´¥ä½ç½®å’Œæ•°æ®æ ·è²Œ
- **åˆ†æ**: äº†è§£æ¯ä¸ªæ“ä½œå¦‚ä½•è½¬æ¢æ•°æ®
- **å¼€å‘**: é€šè¿‡è¯¦ç»†æ£€æŸ¥è¿­ä»£å¤„ç†ç®¡é“

**å½“æ‚¨æƒ³è¦ä»¥ä¸‹åŠŸèƒ½æ—¶ç¦ç”¨ `preserve_intermediate_data: false`ï¼š**
- **æ€§èƒ½**: æ›´å¿«çš„å¤„ç†ï¼Œæ›´å°‘çš„ç£ç›˜ I/O
- **å­˜å‚¨æ•ˆç‡**: å‡å°‘ç£ç›˜ç©ºé—´ä½¿ç”¨
- **ç”Ÿäº§**: æ— ä¸´æ—¶æ–‡ä»¶ç´¯ç§¯çš„æ¸…æ´å¤„ç†

### å¸¦æœ‰ä¸­é—´æ•°æ®çš„ç›®å½•ç»“æ„ç¤ºä¾‹

```
{job_dir}/intermediate/
â”œâ”€â”€ partition_000000/
â”‚   â”œâ”€â”€ op_000_clean_links_mapper.parquet      # clean_links_mapper ä¹‹å
â”‚   â”œâ”€â”€ op_001_clean_email_mapper.parquet      # clean_email_mapper ä¹‹å
â”‚   â”œâ”€â”€ op_002_whitespace_normalization_mapper.parquet
â”‚   â””â”€â”€ op_003_fix_unicode_mapper.parquet      # fix_unicode_mapper ä¹‹å
â””â”€â”€ partition_000001/
    â”œâ”€â”€ op_000_clean_links_mapper.parquet
    â””â”€â”€ ...
```

## ğŸ“ˆ æ€§èƒ½è€ƒè™‘

### æ£€æŸ¥ç‚¹å¼€é”€
- `EVERY_OP`: æœ€é«˜å¼€é”€ï¼Œæœ€å¤§å®¹é”™æ€§
- `EVERY_PARTITION`: å¹³è¡¡çš„å¼€é”€å’Œå®¹é”™æ€§
- `EVERY_N_OPS`: å¯é…ç½®å¼€é”€
- `MANUAL`: æœ€å°å¼€é”€ï¼Œéœ€è¦ä»”ç»†è§„åˆ’

### å­˜å‚¨å»ºè®®
- **äº‹ä»¶æ—¥å¿—**: ä½¿ç”¨å¿«é€Ÿå­˜å‚¨ï¼ˆSSDï¼‰è¿›è¡Œå®æ—¶ç›‘æ§
- **æ£€æŸ¥ç‚¹**: ä½¿ç”¨å¤§å®¹é‡å­˜å‚¨ï¼ˆHDD/ç½‘ç»œå­˜å‚¨ï¼‰ä»¥æé«˜æˆæœ¬æ•ˆç‡
- **åˆ†åŒº**: ä½¿ç”¨æœ¬åœ°å­˜å‚¨ä»¥æé«˜å¤„ç†é€Ÿåº¦

### å†…å­˜ç®¡ç†
- æ ¹æ®å¯ç”¨å†…å­˜è°ƒæ•´ `partition_size`
- ä½¿ç”¨ `max_partition_size_mb` é™åˆ¶åˆ†åŒºå¤§å°
- è€ƒè™‘ `preserve_intermediate_data` ç”¨äºè°ƒè¯•ä¸æ€§èƒ½

## ğŸ‰ æˆåŠŸæŒ‡æ ‡

å®ç°æˆåŠŸå±•ç¤ºäº†ï¼š
- âœ… **å®¹é”™æ€§**: ä½œä¸šå¯ä»¥åœ¨æ•…éšœåæ¢å¤
- âœ… **å¯æ‰©å±•æ€§**: é€šè¿‡åˆ†åŒºå¤„ç†å¤§æ•°æ®é›†
- âœ… **å¯è§‚å¯Ÿæ€§**: å…¨é¢æ—¥å¿—è®°å½•å’Œç›‘æ§
- âœ… **çµæ´»æ€§**: å¯é…ç½®æ£€æŸ¥ç‚¹å’Œå­˜å‚¨
- âœ… **å¯ç”¨æ€§**: å…·æœ‰æœ‰æ„ä¹‰çš„ä½œä¸š ID çš„ç®€å•å‘½ä»¤è¡Œç•Œé¢
- âœ… **æ€§èƒ½**: ä»æ£€æŸ¥ç‚¹å¿«é€Ÿæ¢å¤
- âœ… **å¯é æ€§**: å¼ºå¤§çš„é”™è¯¯å¤„ç†å’ŒéªŒè¯

## ğŸ”® æœªæ¥å¢å¼º

æœªæ¥å¼€å‘çš„æ½œåœ¨é¢†åŸŸï¼š
- **åˆ†å¸ƒå¼æ£€æŸ¥ç‚¹**: å¤šèŠ‚ç‚¹æ£€æŸ¥ç‚¹åè°ƒ
- **å¢é‡æ£€æŸ¥ç‚¹**: ä»…ä¿å­˜æ›´æ”¹çš„æ•°æ®
- **æ£€æŸ¥ç‚¹å‹ç¼©**: å‡å°‘å­˜å‚¨è¦æ±‚
- **é«˜çº§ç›‘æ§**: ç”¨äºä½œä¸šç›‘æ§çš„åŸºäº Web çš„ä»ªè¡¨æ¿
- **æ£€æŸ¥ç‚¹ç‰ˆæœ¬æ§åˆ¶**: æ”¯æŒå¤šä¸ªæ£€æŸ¥ç‚¹ç‰ˆæœ¬
- **ä¸å¤–éƒ¨ç³»ç»Ÿé›†æˆ**: äº‘å­˜å‚¨ã€ç›‘æ§ç³»ç»Ÿ 